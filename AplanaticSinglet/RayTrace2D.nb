(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.1' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    296228,       7320]
NotebookOptionsPosition[    265937,       6713]
NotebookOutlinePosition[    266415,       6731]
CellTagsIndexPosition[    266372,       6728]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["RayTrace2D", "Title",
 CellChangeTimes->{{3.81742394143079*^9, 
  3.8174239480551777`*^9}},ExpressionUUID->"bd77d8b9-ddd6-4352-84b5-\
e011fe087a9e"],

Cell["\<\
Takatoshi Yamada@Ayase corporation
e - mail : takatoshi.yamada@ayasecorporation.com
web cite : https : // www.ayasecorporation.com\
\>", "Author",
 CellChangeTimes->{{3.817423896747398*^9, 3.8174239195219517`*^9}, {
  3.817432359469095*^9, 
  3.8174323600612993`*^9}},ExpressionUUID->"4663285c-c5a1-4b3e-8f0e-\
e482112a9b72"]
}, Open  ]],

Cell[CellGroupData[{

Cell["definitions", "Title",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796954741858514*^9, 
  3.7969547446367683`*^9}},ExpressionUUID->"c632e24e-bfbf-4861-addf-\
2a3ce16d7c98"],

Cell[BoxData[
 RowBox[{
  RowBox[{"BeginPackage", "[", "\"\<AplanaticSinglet`RayTrace2D`\>\"", "]"}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.797739639320718*^9, 3.797739666197934*^9}, {
   3.798145551600141*^9, 3.798145551947646*^9}, 3.801281107568869*^9, 
   3.818462001349478*^9, 3.818716625288015*^9, 
   3.818716664850552*^9},ExpressionUUID->"c4dad22a-e253-45c3-a9f6-\
f6357ff3ab9d"],

Cell[BoxData[
 RowBox[{
  RowBox[{
  "RayTrace2DVersion", "=", 
   "\"\<RayTrace2D 0.1A20210318 copyright by Takatoshi Yamada @Ayase \
corp.\>\""}], ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797040353105895*^9, 3.797040482844741*^9}, {
  3.799464952390545*^9, 3.799464962019672*^9}, {3.799465001858508*^9, 
  3.799465023211528*^9}, {3.800164541931929*^9, 3.8001645586152153`*^9}, {
  3.802398613921288*^9, 3.802398630570698*^9}, {3.802398930162579*^9, 
  3.802398933932508*^9}, {3.825380378672595*^9, 
  3.8253804099520683`*^9}},ExpressionUUID->"e5ad6f70-fbf9-4ccb-8ca1-\
50d1ac2b0e77"],

Cell[BoxData[
 RowBox[{
  RowBox[{
  "RayTrace2DDescription", "=", 
   "\"\<RayTrace2D package is for 2dimensional ray trace i.e., ray trace in \
meridional plane.\>\""}], ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797040353105895*^9, 3.797040482844741*^9}, {
  3.799464952390545*^9, 3.799464962019672*^9}, {3.799465001858508*^9, 
  3.799465023211528*^9}, {3.800164541931929*^9, 3.8001645586152153`*^9}, {
  3.802398613921288*^9, 3.802398630570698*^9}, {3.8023988374051743`*^9, 
  3.802398867128796*^9}, {3.802398906820402*^9, 
  3.8023989231982594`*^9}},ExpressionUUID->"d9576c46-463c-492d-b034-\
3bcacbafe45f"],

Cell[BoxData[
 RowBox[{
  RowBox[{
  "RayTrace2DUsage", "=", 
   "\"\<Needs[\\\"AplanaticSinglet`RayTrace2D`\\\"]\n\
createSurface[s1,sphericalShape[0.6],{0.,0}];\n\
createSurface[q1,quadraticShape[0.6,-2.5,{-1,1}],{0.,0}];\n\
createSurface[s2,sphericalShape[-0.3],{0,0.5}];\n\
createSurface[s3,planeShape[],{0,3}];\ncreateConstantMedium[bk7,1.51768];\n\
createOptics[op,{atmosphere,q1,bk7,s2,atmosphere,s3}];\n\
rinp=Table[raySet[{h,-0.3},{Sin[0Degree],Cos[0Degree]}],{h,-0.8,0.8,0.01}];\n\
rs=Map[traceRay[op][#,0.00055]&,rinp];\n\
With[{dom={-0.8,0.8}},Show[surfaceGraphics[q1,dom],surfaceGraphics[s2,dom],\
Graphics[{Thin,Map[rayLineToDraw[#,4]&,thinOutFromBothSide[rs,12]]}],\
PlotRange\[Rule]All,Ticks\[Rule]None]]\>\""}], ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797040353105895*^9, 3.797040482844741*^9}, {
   3.799464952390545*^9, 3.799464962019672*^9}, {3.799465001858508*^9, 
   3.7994650263509293`*^9}, {3.8004270579525747`*^9, 3.800427058874507*^9}, 
   3.801281190106447*^9, 
   3.818463042021411*^9},ExpressionUUID->"4289103f-0ce8-4a3d-abdf-\
bc5006c7d7b1"],

Cell[CellGroupData[{

Cell["usage messages", "Section",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797038752561654*^9, 
  3.797038760521872*^9}},ExpressionUUID->"749bde2e-b94f-47db-927e-\
e7866659b9ce"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"RayTrace2D", "::", "usage"}], "=", 
   "\"\<RayTrace2D package is for two dimensional strict ray tracing.\>\""}], 
  ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797040353105895*^9, 3.797040482844741*^9}, {
   3.799464952390545*^9, 3.799464962019672*^9}, 3.799465012715131*^9, 
   3.8004235917141857`*^9},ExpressionUUID->"7ed7ac50-c244-465e-bea1-\
6d337dd93afe"],

Cell[CellGroupData[{

Cell["mediums", "Subsection",
 CellChangeTimes->{{3.80273592781273*^9, 
  3.802735931195691*^9}},ExpressionUUID->"29e93e61-28e6-424d-9cac-\
d6669b0acbaa"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"mediumQ", "::", "usage"}], "=", 
   "\"\<mediumQ[sym_] returns true if sym is a medium symbol.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"createMedium", "::", "usage"}], "=", 
   "\"\<createMedium[mediumSymbol_Symbol,rindexFunction_Function,opt___] \
creates medium symbol. The createMedium function can accept symbol with no \
Attributes or mediumSymbol[___] style expression.\>\""}], ";"}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797039944612196*^9, 3.79703996596587*^9}, {
  3.7970400474975777`*^9, 3.797040082341237*^9}, {3.800419170587515*^9, 
  3.8004191707779293`*^9}, {3.806809993026203*^9, 
  3.8068100069319763`*^9}},ExpressionUUID->"de006e79-6ee6-4893-bb29-\
2950294a7c3f"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"createConstantMedium", "::", "usage"}], "=", 
   "\"\<createConstantMedium[mediumSymbol_,rindex_?NumberQ,opt___]\>\""}], 
  ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797039996858774*^9, 3.7970400042384567`*^9}, {
   3.800334212767396*^9, 3.8003343128809223`*^9}, 
   3.806809784123204*^9},ExpressionUUID->"ed56e84a-9522-4cd3-a682-\
b832b2b3ff1a"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"lambdaDomain", "::", "usage"}], "=", 
   "\"\<mediumNameSymbol[lambdaDomain] returns valid range of \
wavelength\>\""}], ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797039996858774*^9, 3.7970400042384567`*^9}, {
  3.800334212767396*^9, 
  3.800334314016811*^9}},ExpressionUUID->"afd1100e-db76-449d-9e2b-\
05d0a957ffc7"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"mediumName", "::", "usage"}], "=", 
   "\"\<mediumNameSymbol[mediumName] returns printable name if it is \
set.\>\""}], ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797039996858774*^9, 3.7970400042384567`*^9}, {
  3.800334212767396*^9, 
  3.800334314016811*^9}},ExpressionUUID->"182fa958-ac10-4d7b-b771-\
0408f5a15993"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"refractiveIndexValue", "::", "usage"}], "=", 
   "\"\<refractiveIndexValue[medium_?mediumQ,lambda_?NumberQ] returns idnex \
value with wavelength in milli meters.\>\""}], ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797039984506513*^9, 3.797039986768262*^9}, {
  3.797040018719037*^9, 3.797040038689116*^9}},
 CellLabel->"In[6]:=",ExpressionUUID->"1b58d1b7-7bfa-4c72-9aba-560c2525886e"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"atmosphere", "::", "usage"}], "=", 
   "\"\<atmosphere is medium symbol for ideal vacuum, refractive index is \
exactly 1. DO NOT use vauum or air if you want result of ray trace compatible \
with Zemax. The definition of 'vacuum' in Zemax is different from general \
physical meaning i.e., electromagnetic field in free space.\>\""}], 
  ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797040093209732*^9, 3.7970401126484137`*^9}, {
  3.798168398200426*^9, 3.798168404711783*^9}, {3.800427057954344*^9, 
  3.800427057956079*^9}, {3.8004284747883043`*^9, 3.800428554647992*^9}, {
  3.800428586329805*^9, 3.800428732285366*^9}, {3.800428778191826*^9, 
  3.800428855840829*^9}},ExpressionUUID->"9fc6fcef-d93d-4100-b278-\
caf02a32383a"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"createMediumsFromAGFFile", "::", "usage"}], "=", 
   "\"\<createMediumsFromAGFFile[path_String] reads Zemax AGF format file and \
create mediums in the file and returns catalogName string. Medium symbols are \
all changed to lower case and '-' or '_' etc. to '$' character because \
symbols should follow the Mathematica input syntax.\>\""}], ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797040093209732*^9, 3.7970401126484137`*^9}, {
  3.798168398200426*^9, 3.798168437834138*^9}, {3.7981691939774323`*^9, 
  3.798169350312003*^9}, {3.7981710978830214`*^9, 3.798171234644236*^9}, {
  3.823224230854807*^9, 
  3.823224295002081*^9}},ExpressionUUID->"fb179b2d-5116-47bb-8b4a-\
6ab16626c866"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"createMediumsFromAGFString", "::", "usage"}], "=", 
   "\"\<createMediumsFromAGFString[agfString_String,catalogname_String] \
creates  mediums in the string and returns catalogName string. Medium symbols \
are all changed to lower case and '-' or '_' etc. to '$' character because \
symbols should follow the Mathematica input syntax.\>\""}], ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797040093209732*^9, 3.7970401126484137`*^9}, {
  3.798168398200426*^9, 3.798168437834138*^9}, {3.7981691939774323`*^9, 
  3.798169350312003*^9}, {3.7981710978830214`*^9, 3.798171234644236*^9}, {
  3.823224230854807*^9, 
  3.823224305345529*^9}},ExpressionUUID->"98ca9263-8ef0-49a5-87cb-\
8868eb01fe45"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"mediumCatalog", "::", "usage"}], "=", 
   "\"\<mediumCatalog[] returns list of medium catalogNamess already read. \
mediumCatalog[catalogName_String] returns list of medium names. \
mediumCatalog[mediumName_String] returns a symbol for medium with \
'mediumName'.\>\""}], ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797040093209732*^9, 3.7970401126484137`*^9}, {
  3.798168398200426*^9, 3.798168437834138*^9}, {3.7981691939774323`*^9, 
  3.798169350312003*^9}},ExpressionUUID->"3fb01604-87bf-480b-babe-\
cc47d6424521"]
}, Open  ]],

Cell[CellGroupData[{

Cell["rays", "Subsection",
 CellChangeTimes->{{3.8027359457897387`*^9, 
  3.8027359473696337`*^9}},ExpressionUUID->"c69d0597-cfb7-4847-aec9-\
43e1ab6ff9ac"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ray", "::", "usage"}], "=", 
   "\"\<ray is a container symbol of ray a component ray[___].\>\""}], 
  ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797040127590591*^9, 3.797040152744472*^9}, {
  3.79704027738957*^9, 3.797040309835432*^9}},
 CellLabel->"In[8]:=",ExpressionUUID->"96f18801-102b-4424-bd87-bc54036b20ae"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"stoppedRay", "::", "usage"}], "=", 
   "\"\<stoppedRay is a container symbol a ray that can not be traced.\>\""}],
   ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797040261627597*^9, 3.797040330705859*^9}},
 CellLabel->"In[9]:=",ExpressionUUID->"4a6a612c-7df6-4acf-b2cb-b4908d65cc43"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"raySet", "::", "usage"}], "=", 
   "\"\<raySet[{y0_,z0_},{yd_,zd_},opt___] or \
raySet[{y0_,z0_},angleToAxis_?NumericQ,refractiveIndex_?NumericQ,opt___] \
create ray object. It can be called to create initial object.\>\""}], 
  ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.79704017140912*^9, 3.797040231184409*^9}, {
  3.800064712937529*^9, 3.8000647440220013`*^9}, {3.800064779213622*^9, 
  3.80006486749543*^9}, {3.8253879393935347`*^9, 3.825387965829863*^9}, {
  3.825388006610093*^9, 3.825388051545252*^9}, {3.825388858947961*^9, 
  3.825388867320928*^9}},ExpressionUUID->"7e4c78bf-97d6-45f7-ba3e-\
334870141e92"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"appendRayOption", "::", "usage"}], "=", 
   "\"\<appendRayOption[ray[__],opt___] appends new option 'opt'to a \
ray.\>\""}], ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.79704017140912*^9, 3.797040231184409*^9}, {
  3.800064712937529*^9, 3.8000647440220013`*^9}, {3.800064779213622*^9, 
  3.80006486749543*^9}, {3.8253879393935347`*^9, 3.825387965829863*^9}, {
  3.825388006610093*^9, 3.825388051545252*^9}, {3.825388858947961*^9, 
  3.8253888954480133`*^9}},ExpressionUUID->"db02f791-25b7-4f76-888e-\
39ac40f10600"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"markRayAsDomainDefinedMarginal", "::", "usage"}], "=", 
   "\"\<markRayAsDomainDefinedMarginal[r_ray] returns a ray object marked as \
a marginal ray. A surface reached by this ray redefine its domain for the ray \
as a marginal.\>\""}], ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.79704017140912*^9, 3.797040231184409*^9}, {
  3.800064712937529*^9, 3.8000647440220013`*^9}, {3.800064779213622*^9, 
  3.80006486749543*^9}, {3.8001368275302973`*^9, 
  3.800136845779904*^9}},ExpressionUUID->"fc264c2e-b98a-494e-91f8-\
fc951a454c46"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"raySetAsDomainDefinedMarginal", "::", "usage"}], "=", 
   "\"\<raySetAsDomainDefinedMarginal[{y0_,z0_},{yd_,zd_},opt___] returns a \
ray object marked as a marginal ray. A surface reached by this ray redefine \
its domain for the ray as a marginal.\>\""}], ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.79704017140912*^9, 3.797040231184409*^9}, {
  3.800064712937529*^9, 3.8000647440220013`*^9}, {3.800064779213622*^9, 
  3.80006486749543*^9}, {3.8001368275302973`*^9, 3.800136830005377*^9}, {
  3.806784552081094*^9, 
  3.806784553804607*^9}},ExpressionUUID->"d2b01480-9537-4e08-bff0-\
d728977c4184"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"origin", "::", "usage"}], "=", "\"\<origin[ray[___]]\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"direction", "::", "usage"}], "=", 
   "\"\<direction[ray[org_,dir_,___]]:=dir\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"raySequence", "::", "usage"}], "=", 
   "\"\<container object of rays.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"raySegmentCount", "::", "usage"}], "=", 
   "\"\<raySegmentCount[rs_raySequence] returns number of ray \
segments.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"sequenceOfRays", "::", "usage"}], "=", 
   "\"\<sequenceOfRays[rs_raySequence] returns a list of ray segments \
excluding stopped ray.\>\""}], ";"}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.79705924151676*^9, 3.797059286322352*^9}, {
  3.797059339577773*^9, 3.797059362737874*^9}, {3.7981456664461727`*^9, 
  3.798145717228228*^9}, {3.798145788949967*^9, 3.798145790368209*^9}, {
  3.8004237492056828`*^9, 
  3.800423793586816*^9}},ExpressionUUID->"165e07b4-4c00-4df0-8afb-\
5c8c38b64208"]
}, Open  ]],

Cell[CellGroupData[{

Cell["raySequence", "Subsection",
 CellChangeTimes->{{3.8027359608307753`*^9, 
  3.802735967682046*^9}},ExpressionUUID->"e98d8979-8eee-4bdb-ab3b-\
bc5c9b8d9456"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"rayLineToDraw", "::", "usage"}], "=", 
   "\"\<rayLineToDraw[raySequence[___]] returns Line[] object for Graphics. \
rayLineToDraw[raySequence[___],count_] line with rays upto \
'count'.rayLineToDraw[raySequence[___],{from_,upto_}] rays line with 'from' \
to 'upto' rays.\>\""}], ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.7970594608682823`*^9, 3.797059495693681*^9}, {
  3.798146215818027*^9, 
  3.798146323068552*^9}},ExpressionUUID->"53a847b4-8e1d-4216-91d1-\
dd862b5b5b63"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"opticalPathDifference", "::", "usage"}], "=", 
   "\"\<opticalPathDifference[{raySequence[__]...}] returns list of OPD with \
input ray height.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"opticalPathLengthForHeight", "::", "usage"}], "=", 
   "\"\<opticalPathLengthForHeight[rs_raySequence]\>\""}], ";"}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797059512406136*^9, 3.7970595631436577`*^9}, {
  3.7977431275639467`*^9, 
  3.797743164535172*^9}},ExpressionUUID->"39fe73b2-507a-4b86-97ae-\
11d00f126200"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"logitudinalAberPositionReversed", "::", "usage"}], "=", 
   "\"\<logitudinalAberPositionReversed[raySequence[__]] returns list of \
{_,_} to draw lateral aberration.\>\""}], ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797059593961254*^9, 3.797059656291305*^9}, {
  3.802660644581704*^9, 3.802660656314357*^9}, {3.80266081520214*^9, 
  3.802660884277355*^9}},ExpressionUUID->"872ae007-0a80-4034-a3e9-\
ac7fc920c3ae"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"longitudinalSphericalAberration", "::", "usage"}], "=", 
   "\"\<longitudinalSphericalAberration[rs:{__raySequence},op_?opticsQ] \
returns two-dimensional coordinates of longitudinal spherical aberration to \
draw longitudinal spherical aberration plot.\>\""}], ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797059593961254*^9, 3.797059656291305*^9}, {
   3.802660644581704*^9, 3.802660656314357*^9}, {3.80266081520214*^9, 
   3.802660884277355*^9}, 
   3.802661549242132*^9},ExpressionUUID->"2dd9ef8b-560f-4519-b437-\
1b67dbdaad80"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"oscValueReversed", "::", "usage"}], "=", 
   "\"\<oscValueReversed[raySequence[__],f_] returns OSC with focal length \
'f'.\>\""}], ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797059666146237*^9, 3.797059699219597*^9}, {
  3.802661058196218*^9, 
  3.802661152031494*^9}},ExpressionUUID->"f784cd6c-7841-4478-b0f1-\
251f4b68bb37"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"offenceAgainstSineCondition", "::", "usage"}], "=", 
   "\"\<offenceAgainstSineCondition[rs:{__raySequence},f_] returns \
two-dimensional coordinates of offence against the sine condition to draw OSC \
plot. The function requires focal length 'f'. For finite conjugate, \
offenceAgainstSineCondition[rs:{__raySequence},{dop_,dpi_}] can be called. \
The function requires paraxial distance from object to principal plane in \
object side 'dop' and paraxial distance from principal plane in image side to \
image 'dpi'.\>\""}], ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797059666146237*^9, 3.797059699219597*^9}, {
  3.802661058196218*^9, 3.802661152031494*^9}, {3.802669546322385*^9, 
  3.8026696193146973`*^9}, {3.802669684094079*^9, 3.802669684160369*^9}, {
  3.803867328414835*^9, 3.803867359735689*^9}, {3.803867395896524*^9, 
  3.803867520205419*^9}},ExpressionUUID->"b3e89b1b-bc61-40a8-9ce7-\
719599d88014"]
}, Open  ]],

Cell[CellGroupData[{

Cell["shapes,surfaces,optics", "Subsection",
 CellChangeTimes->{{3.8027359843437777`*^9, 
  3.80273599868684*^9}},ExpressionUUID->"e5aad225-da8f-49f6-8c9d-\
9fe2de85d907"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"unfoldInterpolation", "::", "usage"}], "=", 
   "\"\<unfoldInterpolation[if_InterpolatingFunction] is for surface shape \
interpolation function to enhance domain {0,maxHeight} to \
{-maxHeight,maxHeight}.\>\""}], ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797040810434348*^9, 3.797040876643735*^9}},
 CellLabel->"In[18]:=",ExpressionUUID->"093125e7-13da-4c61-863d-044d62c8cfa8"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"opticsTags", "=", 
   RowBox[{"{", 
    RowBox[{"surfaces", ",", "mediums"}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"surfaceTags", "=", 
   RowBox[{"{", 
    RowBox[{"shape", ",", "origin"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"shapes", "=", 
   RowBox[{"{", 
    RowBox[{
    "plane", ",", "perfectThinLens", ",", "spherical", ",", "quadratic", ",", 
     "parametric"}], "}"}]}], ";"}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.79705971762227*^9, 3.7970597831993732`*^9}, {
  3.79842984929786*^9, 3.798429889189743*^9}, {3.79843002351079*^9, 
  3.798430025972878*^9}, {3.799527849683737*^9, 3.7995278970514383`*^9}, {
  3.799528038361298*^9, 3.799528096760586*^9}, {3.7995281345149183`*^9, 
  3.7995281387389793`*^9}},ExpressionUUID->"79fa3684-ba6c-4a0d-a033-\
e0518e378172"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"shapeQ", "::", "usage"}], "=", 
   "\"\<shapeQ[s_Symbol] returns True if symbol 's' is a shape symbol.\>\""}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"surfaceQ", "::", "usage"}], "=", 
   "\"\<suraceQ[s_Symbol] returns True if symbol 's' is a surface \
symbol.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"opticsQ", "::", "usage"}], "=", 
   "\"\<opticsQ[s_Symbol] returns True if symbol 's' is an optics \
symbol.\>\""}], ";"}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.79705971762227*^9, 3.7970597831993732`*^9}, {
   3.79842984929786*^9, 3.798429889189743*^9}, {3.79843002351079*^9, 
   3.798430025972878*^9}, {3.799527849683737*^9, 3.7995278970514383`*^9}, {
   3.799528038361298*^9, 3.79952804484214*^9}, 3.7995280794988813`*^9, {
   3.800419082239243*^9, 
   3.800419139130245*^9}},ExpressionUUID->"b43507d1-1883-4d8d-bbb8-\
15f858e3c0fa"],

Cell[CellGroupData[{

Cell["shapes", "Subsubsection",
 CellChangeTimes->{{3.802736007361022*^9, 
  3.802736009621627*^9}},ExpressionUUID->"241440ec-7a7a-44dc-9eff-\
c7703d929456"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"planeShape", "::", "usage"}], "=", 
   "\"\<planeShape[] returns a plane shape object at z=0\>\""}], 
  ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.79705971762227*^9, 3.7970597831993732`*^9}, {
  3.79842984929786*^9, 3.798429889189743*^9}, {3.79843002351079*^9, 
  3.798430025972878*^9}},ExpressionUUID->"2e5d30e6-cbcf-4187-ae84-\
17088012ab61"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"perfectThinLensShape", "::", "usage"}], "=", 
   "\"\<perfectThinLensShape[f_] returns a perfect thin lens with focal \
length 'f'.\>\""}], ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.79705971762227*^9, 3.7970597831993732`*^9}, {
   3.79842984929786*^9, 3.798429889189743*^9}, 
   3.79843002351079*^9},ExpressionUUID->"7a6878be-b83f-4ac6-9ed8-\
7ecbfff85e31"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"sphericalShape", "::", "usage"}], "=", 
   "\"\<sphericalShape[curv_] or sphericalShape[curv_,dom:{_,_}] returns \
spherical shape object \>\""}], ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797059786470533*^9, 3.797059843153565*^9}, {
  3.797115739769105*^9, 3.797115740047079*^9}},
 CellLabel->"In[21]:=",ExpressionUUID->"cbe6f618-aade-4667-aaf8-3b9bb29d8ac0"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"quadraticShape", "::", "usage"}], "=", 
   "\"\<quadraticShape[curv_,conic_,dom:{_,_}] or \
quadraticShape[curv_,conic_] returns quadratic shape object'\>\""}], 
  ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797738454648529*^9, 3.797738458450632*^9}, {
  3.797738513161401*^9, 3.797738545113377*^9}, {3.7984024035105352`*^9, 
  3.798402409662768*^9}},ExpressionUUID->"a12c7a7f-70ec-469c-a889-\
21281dbff1e9"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"parametricShape", "::", "usage"}], "=", 
   "\"\<parametricShape[f_Function,dom:{_,_}] or \
parametricShape[f_InterpolatingFunction] returns parametric shape \
object.\>\""}], ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.7977385592210913`*^9, 
  3.797738618083411*^9}},ExpressionUUID->"f31221cf-eab1-4ecb-a18a-\
2f5fac191af5"]
}, Open  ]],

Cell[CellGroupData[{

Cell["surfaces", "Subsubsection",
 CellChangeTimes->{{3.8027360185770397`*^9, 
  3.802736021322404*^9}},ExpressionUUID->"d4ef99d5-643c-40bc-87c5-\
810a2407d6b2"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"createSurface", "::", "usage"}], "=", 
   "\"\<createSurface[surfaceSymbol_,surfaceShape_,position:{_,_},opt___] \
assigns surface object to the symbol 'surfaceSymbol'. createSurface can \
accept symbol with no Attributes or surfaceSymbol[___] style \
expression.\>\""}], ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797738699233403*^9, 3.797738743143641*^9}, {
  3.7977388134351387`*^9, 3.797738816518022*^9}, {3.8005077713742332`*^9, 
  3.8005078132012177`*^9}, {3.8005148936460743`*^9, 3.800514928540681*^9}, {
  3.8068098016466627`*^9, 3.8068098108297157`*^9}, {3.806809859355928*^9, 
  3.806809976297279*^9}},ExpressionUUID->"2ef3d792-4fb7-4e36-9c01-\
9a75fc0a52ef"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"surfaceComment", "::", "usage"}], "=", 
   "\"\<surfaceComment is an option of createSurface and set comment string. \
To read it evaluate surfaceSymbol[surfaceComment].\>\""}], ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797738699233403*^9, 3.797738743143641*^9}, {
  3.7977388134351387`*^9, 3.797738816518022*^9}, {3.8005077713742332`*^9, 
  3.8005078132012177`*^9}, {3.8005148936460743`*^9, 
  3.800514969467855*^9}},ExpressionUUID->"bf3c9abe-d342-485b-94f6-\
69fdb4a99e6a"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"attachAttributeToSurface", "::", "usage"}], "=", 
   "\"\<attachAttributeToSurface[surfaceSymbol_?surfaceQ,attributeSymbol_\
Symbol,attributeValue_] set an attriburte to a surface. The attribute can be \
accessed surfaceSymbol[attributeSymbol].\>\""}], ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797738699233403*^9, 3.797738743143641*^9}, {
   3.7977388134351387`*^9, 3.797738816518022*^9}, {3.8005077713742332`*^9, 
   3.8005078132012177`*^9}, {3.8005161673894653`*^9, 3.800516194233562*^9}, {
   3.8005206425607758`*^9, 3.800520682041614*^9}, {3.800562319142768*^9, 
   3.800562440795611*^9}, {3.800562478049142*^9, 3.8005624931794987`*^9}, {
   3.8005625616972446`*^9, 3.800562579672426*^9}, 3.802653957110209*^9, {
   3.802654029317596*^9, 3.8026541323352413`*^9}, {3.8026563997645187`*^9, 
   3.802656503049803*^9}},ExpressionUUID->"1ee19320-04b8-453d-9658-\
a783849441c4"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"positionOfAttributedSurface", "::", "usage"}], "=", 
   "\"\<positionOfAttributedSurface[op_?opticsQ,attributeSymbol_Symbol,\
attributeValue_] returns position numbers of surfaces with 'attributeSymbol' \
attribute set to attributeValue.\>\""}], ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797738699233403*^9, 3.797738743143641*^9}, {
   3.7977388134351387`*^9, 3.797738816518022*^9}, {3.8005077713742332`*^9, 
   3.8005078132012177`*^9}, {3.8005161673894653`*^9, 3.800516194233562*^9}, {
   3.8005206425607758`*^9, 3.800520682041614*^9}, {3.800562319142768*^9, 
   3.800562440795611*^9}, {3.800562478049142*^9, 3.8005624931794987`*^9}, {
   3.8005625616972446`*^9, 3.800562579672426*^9}, 3.802653957110209*^9, {
   3.802654029317596*^9, 3.8026541323352413`*^9}, {3.8026563997645187`*^9, 
   3.802656503049803*^9}, {3.802656831611967*^9, 3.8026568355273743`*^9}, {
   3.802656919217098*^9, 3.802656937588307*^9}, {3.802656970991617*^9, 
   3.8026569714070168`*^9}, {3.802658356846197*^9, 3.802658369401257*^9}, {
   3.802658406189582*^9, 
   3.802658419622415*^9}},ExpressionUUID->"39eff147-0192-45f7-8f0a-\
282883edd76c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"marginalPositionOfSurface", "::", "usage"}], "=", 
   "\"\<marginalPositionOfSurface[s_surfaceQ] returns edge positions of the \
surface.\>\""}], ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797738699233403*^9, 3.797738743143641*^9}, {
   3.7977388134351387`*^9, 3.797738816518022*^9}, {3.8005077713742332`*^9, 
   3.8005078132012177`*^9}, {3.8005161673894653`*^9, 3.800516194233562*^9}, {
   3.8005206425607758`*^9, 3.800520682041614*^9}, {3.800562319142768*^9, 
   3.800562440795611*^9}, {3.800562478049142*^9, 3.8005624931794987`*^9}, {
   3.8005625616972446`*^9, 3.800562579672426*^9}, 3.802653957110209*^9, {
   3.802654029317596*^9, 3.8026541323352413`*^9}, {3.8026563997645187`*^9, 
   3.802656503049803*^9}, {3.802656831611967*^9, 3.8026568355273743`*^9}, {
   3.802656919217098*^9, 3.802656937588307*^9}, {3.802656970991617*^9, 
   3.8026569714070168`*^9}, {3.802658356846197*^9, 3.802658369401257*^9}, {
   3.802658406189582*^9, 
   3.802658419622415*^9}},ExpressionUUID->"063b85d7-f739-4bc1-a6bf-\
7890cb00a6bd"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"clearAperture", "::", "usage"}], "=", 
   "\"\<clearAperture[surf_?surfaceQ] returns 2D clear aperture size.\>\""}], 
  ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797738699233403*^9, 3.797738743143641*^9}, {
  3.7977388134351387`*^9, 3.797738816518022*^9}, {3.8005077713742332`*^9, 
  3.8005078132012177`*^9}, {3.8005161673894653`*^9, 
  3.800516194233562*^9}},ExpressionUUID->"bfe8fbfe-e3fa-4f82-99d8-\
0fa8cf27e626"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"surfacePosition", "::", "usage"}], "=", 
   "\"\<surfacePosition[surf_?surfaceQ] returns the surface position along \
the optical axis.\>\""}], ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797738699233403*^9, 3.797738743143641*^9}, {
  3.7977388134351387`*^9, 3.797738816518022*^9}, {3.8005077713742332`*^9, 
  3.8005078132012177`*^9}, {3.8005161673894653`*^9, 3.800516194233562*^9}, {
  3.8005206425607758`*^9, 3.800520682041614*^9}, {3.800562319142768*^9, 
  3.800562440795611*^9}, {3.800562478049142*^9, 3.8005624931794987`*^9}, {
  3.800565771144041*^9, 
  3.800565797344158*^9}},ExpressionUUID->"b2dd01b2-10c2-47d7-8101-\
590a80da98ad"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"surfaceShapeType", "::", "usage"}], "=", 
   "\"\<surfaceShapeType[surf_?surfaceQ] returns shape head symbol.\>\""}], 
  ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797738699233403*^9, 3.797738743143641*^9}, {
  3.7977388134351387`*^9, 3.797738816518022*^9}, {3.8005077713742332`*^9, 
  3.8005078132012177`*^9}, {3.8005161673894653`*^9, 3.800516194233562*^9}, {
  3.8005206425607758`*^9, 3.800520682041614*^9}, {3.800562319142768*^9, 
  3.800562440795611*^9}, {3.800562478049142*^9, 3.8005624931794987`*^9}, {
  3.800565771144041*^9, 
  3.800565797344158*^9}},ExpressionUUID->"461cc410-9421-4244-ba80-\
fa5609fc3190"]
}, Open  ]],

Cell[CellGroupData[{

Cell["optics", "Subsubsection",
 CellChangeTimes->{{3.802736041809772*^9, 
  3.802736043103485*^9}},ExpressionUUID->"79d85e4e-1328-4f52-8687-\
3a0367557b99"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"createOptics", "::", "usage"}], "=", 
   "\"\<createOptics[opticsSymbol_,seq:{___}] assigns optics object to the \
symbol 'oticsSymbol'.  The createOptics function can accept symbol with no \
Attributes or opticsSymbol[___] style expression. The argument 'seq' is a \
list of medium, surface, medium, surface, ...\>\""}], ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797738765846081*^9, 3.7977388661552896`*^9}, {
   3.802656990114972*^9, 3.802657068112467*^9}, 3.8068098412391777`*^9, {
   3.806810024185553*^9, 
   3.806810049503305*^9}},ExpressionUUID->"b5405154-d1c8-4187-874a-\
bf1ac0ae02c3"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"setPupil", "::", "usage"}], "=", 
   "\"\<setPupil[opticsSymbol_?opticsQ,surfaceSymbol_?surfaceQ] sets \
'surfaceSymbol' surface to pupil of optical system.\>\""}], ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797738765846081*^9, 3.7977388661552896`*^9}, {
  3.802656990114972*^9, 3.802657068112467*^9}, {3.80265769849527*^9, 
  3.802657742740237*^9}},ExpressionUUID->"cdae859d-a21d-4464-8f63-\
492d2d9130de"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pupilSurface", "::", "usage"}], "=", 
   "\"\<pupilSurface is a surface attribute specifing pupil.\>\""}], 
  ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797738765846081*^9, 3.7977388661552896`*^9}, {
  3.802656990114972*^9, 3.802657068112467*^9}, {3.80265769849527*^9, 
  3.802657742740237*^9}},ExpressionUUID->"4ce2fccc-f431-4c3e-a2fc-\
d5b7c97edcfd"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["ray tracing and others", "Subsection",
 CellChangeTimes->{{3.802736048581601*^9, 
  3.802736064275311*^9}},ExpressionUUID->"ef06c41c-511b-46ba-bd8a-\
bc9fae8752bf"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"traceRay", "::", "usage"}], "=", 
   "\"\<traceRay[optics_][initialRay_ray,lambda_?NumberQ] traces the ray \
through optics at wavelength lambda, and returns raySequence object.\>\""}], 
  ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797738887327849*^9, 
  3.797738948868903*^9}},ExpressionUUID->"f1a388a4-74d2-4b5f-9db7-\
d86e80c6c355"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"interpolationDomain", "::", "usage"}], "=", 
   "\"\<interpolationDomain[itf_InterpolatingFunction] returns doian of \
scalar interpolating function 'itf',\>\""}], ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797738983755085*^9, 3.797739062542654*^9}, {
  3.798347087656986*^9, 3.798347195826885*^9}, {3.798347413389637*^9, 
  3.7983474650826473`*^9}},ExpressionUUID->"86e0f0b6-b337-4ff6-af71-\
9432f5fdbf4b"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"interpolationSectionPoints", "::", "usage"}], "=", 
   "\"\<interpolationSectionPoints[itf_InterpolatingFunction] returns list of \
anchor points of interpolation of scalar function.\>\""}], ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797738983755085*^9, 3.797739062542654*^9}, {
  3.798347087656986*^9, 3.798347195826885*^9}, {3.798347413389637*^9, 
  3.7983474650826473`*^9}, {3.798347539212606*^9, 
  3.798347542643606*^9}},ExpressionUUID->"c8cccb90-4dcc-4934-bc14-\
97ab01ee932e"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"thinOutFromBothSide", "::", "usage"}], "=", 
   "\"\<thinOutFromBothSide[lis_List,n_] returns new list of element count to \
n from Length[lis].\>\""}], ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797739078573868*^9, 
  3.797739149722275*^9}},ExpressionUUID->"4de1a616-382f-4146-9802-\
b2244bcdd741"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"surfaceGraphics", "::", "usage"}], "=", 
   "\"\<surfaceGraphics[s_?surfaceQ,dom:{_,_}] returns Graphics object of the \
surface.\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.797804189857349*^9, 3.7978042200111647`*^9}, {
  3.8000577887233152`*^9, 3.800057791275159*^9}, {3.800057821852092*^9, 
  3.800057829626287*^9}, {3.800064703589058*^9, 3.800064704026189*^9}, {
  3.800148560701249*^9, 
  3.800148600257832*^9}},ExpressionUUID->"84356d43-2d2e-4006-a357-\
cb1590add8e2"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"opticsGraphics", "::", "usage"}], "=", 
   "\"\<opticsGraphics[opt_?opticsQ,opt___Rule] returns Graphics object of \
all surfaces.\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.797804189857349*^9, 3.7978042200111647`*^9}, {
  3.8000577887233152`*^9, 3.800057791275159*^9}, {3.800057821852092*^9, 
  3.800057829626287*^9}, {3.800064703589058*^9, 3.800064704026189*^9}, {
  3.800148560701249*^9, 3.800148600257832*^9}, {3.800163945270125*^9, 
  3.8001640000821543`*^9}},ExpressionUUID->"9dfc148a-3569-49e3-9737-\
4eb02f7e31fe"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"hideUselessSurface", "::", "usage"}], "=", 
   "\"\<hideUselessSurface is an option of opticsGraphics and opticsGraphics. \
If hideUselessSurface\.10\.08\.08\.08->False, the a surface sandwitched same \
medium is shown opticsGraphics. Default value is True.\>\""}], ";"}]], "Input",\

 InitializationCell->True,
 CellChangeTimes->{{3.797804189857349*^9, 3.7978042200111647`*^9}, {
  3.8000577887233152`*^9, 3.800057791275159*^9}, {3.800057821852092*^9, 
  3.800057829626287*^9}, {3.800064703589058*^9, 3.800064704026189*^9}, {
  3.800148560701249*^9, 3.800148600257832*^9}, {3.800163945270125*^9, 
  3.800164159691526*^9}, {3.802654907188973*^9, 3.802654936844224*^9}, {
  3.8026549760387506`*^9, 3.802655084481765*^9}, {3.808442535436645*^9, 
  3.808442536712492*^9}, {3.808443365488915*^9, 
  3.808443368716799*^9}},ExpressionUUID->"c3669929-44c6-4c5d-afa5-\
9547a641bcb0"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"rayCongruenceGraphics", "::", "usage"}], "=", 
   "\"\<rayCongruenceGraphics[rss:{__raySequence},opt___Rule] returns \
Graphics object of rays.\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.797804189857349*^9, 3.7978042200111647`*^9}, {
  3.8000577887233152`*^9, 3.800057791275159*^9}, {3.800057821852092*^9, 
  3.800057829626287*^9}, {3.800064703589058*^9, 3.800064704026189*^9}, {
  3.800148560701249*^9, 3.800148600257832*^9}, {3.800163945270125*^9, 
  3.8001641103366413`*^9}},ExpressionUUID->"fcabd3b4-4dcd-4560-beb0-\
8cca6f9de9a7"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"removeLast", "::", "usage"}], "=", 
   "\"\<removeLast is an option of opticsGraphics and rayCongruenceGraphics. \
If removeLast->True, the last surface and ray segments toward the last \
surface are not drawn.\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.797804189857349*^9, 3.7978042200111647`*^9}, {
  3.8000577887233152`*^9, 3.800057791275159*^9}, {3.800057821852092*^9, 
  3.800057829626287*^9}, {3.800064703589058*^9, 3.800064704026189*^9}, {
  3.800148560701249*^9, 3.800148600257832*^9}, {3.800163945270125*^9, 
  3.800164159691526*^9}, {3.802654907188973*^9, 3.802654936844224*^9}, {
  3.8026549760387506`*^9, 
  3.802655084481765*^9}},ExpressionUUID->"a6d27493-7027-4eb0-9ca9-\
fac2e51d0a90"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"rayCount", "::", "usage"}], "=", 
   "\"\<rayCount is an option of rayCongruenceGraphics.\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.797804189857349*^9, 3.7978042200111647`*^9}, {
  3.8000577887233152`*^9, 3.800057791275159*^9}, {3.800057821852092*^9, 
  3.800057829626287*^9}, {3.800064703589058*^9, 3.800064704026189*^9}, {
  3.800148560701249*^9, 3.800148600257832*^9}, {3.800163945270125*^9, 
  3.800164159691526*^9}},ExpressionUUID->"381ca392-deac-4e8b-b680-\
ce72c53b0743"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Private section", "Section",
 InitializationCell->True,
 CellChangeTimes->{{3.799464349266911*^9, 3.799464361089664*^9}, {
  3.7994644177522287`*^9, 
  3.799464423496195*^9}},ExpressionUUID->"f869ae36-e476-44fd-b45e-\
9c7e5dd76568"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797738391152273*^9, 3.797738402558744*^9}, {
  3.799464409766488*^9, 
  3.79946441775991*^9}},ExpressionUUID->"18130e7a-b01b-415b-919b-\
cbad94e88a8c"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Internal definitions", "Section",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.7977384066885767`*^9, 
  3.797738417488649*^9}},ExpressionUUID->"738493a8-e07c-45d1-972a-\
d6a6d6efabbd"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"canBeObjectSymbol", "[", "s_Symbol", "]"}], ":=", 
  RowBox[{"ContainsOnly", "[", 
   RowBox[{
    RowBox[{"Attributes", "[", "s", "]"}], ",", 
    RowBox[{"{", "Temporary", "}"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"canBeObjectSymbol", "[", 
   RowBox[{"s_Symbol", "[", "___", "]"}], "]"}], ":=", 
  RowBox[{"canBeObjectSymbol", "[", "s", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"canBeObjectSymbol", "[", "_", "]"}], ":=", "False"}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796769784702441*^9, 3.796769850449298*^9}, {
   3.796769882917695*^9, 3.796769923284545*^9}, {3.796770392869598*^9, 
   3.796770441809177*^9}, {3.7967705774102697`*^9, 3.796770578648234*^9}, {
   3.796770864513014*^9, 3.796771051900515*^9}, {3.796860411475552*^9, 
   3.7968604736677017`*^9}, {3.796877016926668*^9, 3.796877067788124*^9}, {
   3.79687716672609*^9, 3.796877167591175*^9}, {3.7968773792796392`*^9, 
   3.796877425326664*^9}, {3.796951711467187*^9, 3.7969519951567383`*^9}, {
   3.796953626693973*^9, 3.796953638687928*^9}, {3.7969602593141193`*^9, 
   3.796960275578966*^9}, {3.7969604358901157`*^9, 3.796960465556493*^9}, 
   3.796960508723426*^9, {3.796964380167589*^9, 3.7969644130482283`*^9}, {
   3.800507841609271*^9, 3.800507848852982*^9}, {3.800514992156886*^9, 
   3.80051506947886*^9}, 3.806807410531301*^9, {3.806807452850013*^9, 
   3.806807504988388*^9}, {3.8068075582446127`*^9, 3.806807559803069*^9}, {
   3.806807957639387*^9, 3.806807968571055*^9}, {3.806808588798668*^9, 
   3.806808596468001*^9}, {3.808431569494638*^9, 
   3.8084315864363194`*^9}},ExpressionUUID->"75c78a3c-99b5-4e7c-b041-\
5c4b52917af7"],

Cell[CellGroupData[{

Cell["medium", "Subsection",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.7969525480344257`*^9, 
  3.7969525522308073`*^9}},ExpressionUUID->"a77599ee-3de3-4b58-bc3b-\
ed5d5877bc4f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"mediumTypes", "=", 
   RowBox[{"{", 
    RowBox[{"constantMedium", ",", "dispersiveMedium"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "createMedium", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"mediumName", "\[Rule]", "\"\<\>\""}], ",", 
     RowBox[{"lambdaDomain", "\[Rule]", "All"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"refractiveIndexValue", "::", "outofrange"}], "=", 
   "\"\<wavelength `1` is not in range `2` to `3`\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"createMedium", "[", 
   RowBox[{
    RowBox[{"mediumSymbol_", "?", "canBeObjectSymbol"}], ",", 
    "rindexFunction_Function", ",", "opt___"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"mediumQ", "[", "mediumSymbol", "]"}], "^=", "True"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"mediumSymbol", "[", "mediumType", "]"}], "=", 
      "dispersiveMedium"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"mediumSymbol", "[", "mediumName", "]"}], "=", 
      RowBox[{
       RowBox[{"mediumName", "/.", 
        RowBox[{"{", "opt", "}"}]}], "/.", 
       RowBox[{"mediumName", "->", 
        RowBox[{"ToString", "[", "mediumSymbol", "]"}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"mediumSymbol", "[", "lambdaDomain", "]"}], "=", 
      RowBox[{
       RowBox[{"lambdaDomain", "/.", 
        RowBox[{"{", "opt", "}"}]}], "/.", 
       RowBox[{"Options", "[", "createMedium", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"mediumSymbol", "[", "refractiveIndex", "]"}], "=", 
      "rindexFunction"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"mediumSymbol", "[", "lastLambda", "]"}], "=", "0.0"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"mediumSymbol", "[", "lastIndex", "]"}], "=", "0.0"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"refractiveIndexValue", "[", "mediumSymbol", "]"}], "^=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", "lambda", "}"}], ",", 
        RowBox[{"Evaluate", "[", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"mediumSymbol", "[", "lambdaDomain", "]"}], "=!=", 
               "All"}], ")"}], "&&", 
             RowBox[{"Not", "[", 
              RowBox[{"Between", "[", 
               RowBox[{"lambda", ",", 
                RowBox[{"medium", "[", "lambdaDomain", "]"}]}], "]"}], 
              "]"}]}], ",", 
            RowBox[{
             RowBox[{"Message", "[", 
              RowBox[{
               RowBox[{"refractiveIndexValue", "::", "outofrange"}], ",", 
               "lambda", ",", 
               RowBox[{
                RowBox[{"mediumSymbol", "[", "lambdaDomain", "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", 
               RowBox[{
                RowBox[{"mediumSymbol", "[", "lambdaDomain", "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}], ";", 
             RowBox[{"Return", "[", "$Failed", "]"}]}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"lambda", "=!=", 
             RowBox[{"mediumSymbol", "[", "lastLambda", "]"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"mediumSymbol", "[", "lastLambda", "]"}], "=", 
              "lambda"}], ";", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"mediumSymbol", "[", "lastIndex", "]"}], "=", 
              RowBox[{
               RowBox[{"mediumSymbol", "[", "refractiveIndex", "]"}], "[", 
               "lambda", "]"}]}]}]}], "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"mediumSymbol", "[", "lastIndex", "]"}]}], "]"}]}], "]"}]}],
      ";", "\[IndentingNewLine]", "mediumSymbol"}]}], "\[IndentingNewLine]", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"createConstantMedium", "[", 
   RowBox[{
    RowBox[{"mediumSymbol_", "?", "canBeObjectSymbol"}], ",", 
    RowBox[{"rindex_", "?", "NumberQ"}], ",", "opt___"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"mediumQ", "[", "mediumSymbol", "]"}], "^=", "True"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"refractiveIndexValue", "[", "mediumSymbol", "]"}], "^=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", "lambda", "}"}], ",", 
        RowBox[{"mediumSymbol", "[", "lastIndex", "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"mediumSymbol", "[", "mediumType", "]"}], "=", 
      "constantMedium"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"mediumSymbol", "[", "mediumName", "]"}], "=", 
      RowBox[{
       RowBox[{"mediumName", "/.", 
        RowBox[{"{", "opt", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"mediumName", "->", 
         RowBox[{"ToString", "[", "mediumSymbol", "]"}]}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"mediumSymbol", "[", "lambdaDomain", "]"}], "=", "All"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"mediumSymbol", "[", "lastLambda", "]"}], "=", "0.0"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"mediumSymbol", "[", "lastIndex", "]"}], "=", "rindex"}], ";", 
     "\[IndentingNewLine]", "mediumSymbol"}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"mediumQ", "[", "_", "]"}], ":=", "False"}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796768783298791*^9, 3.796768789644017*^9}, 
   3.7967696126702642`*^9, {3.796769673614977*^9, 3.796769703336803*^9}, {
   3.796769736246367*^9, 3.796769766195997*^9}, {3.796769861633333*^9, 
   3.796769871992592*^9}, {3.796770381607551*^9, 3.7967703891334753`*^9}, {
   3.796857868002528*^9, 3.796857882505954*^9}, {3.796857912757736*^9, 
   3.796858168087769*^9}, {3.796858217702066*^9, 3.7968582415306177`*^9}, {
   3.79685828249403*^9, 3.796858404584647*^9}, {3.79687844403358*^9, 
   3.7968784459110527`*^9}, 3.796954724715143*^9, 3.796954957531233*^9, 
   3.796955074434312*^9, {3.798169678482917*^9, 3.7981698165011187`*^9}, {
   3.8003346613217897`*^9, 3.8003346781846848`*^9}, 3.800334716534918*^9, {
   3.8003347560473423`*^9, 3.800334759399688*^9}, {3.800424705739623*^9, 
   3.8004247890483418`*^9}, {3.8004248426999702`*^9, 3.80042487435861*^9}, {
   3.8004292731429462`*^9, 3.8004292758781223`*^9}, 3.80178481521082*^9, 
   3.80178490379362*^9, {3.801785332044261*^9, 3.801785334665309*^9}, {
   3.801785376920107*^9, 3.801785387426876*^9}, {3.8068080136621637`*^9, 
   3.806808024279902*^9}, {3.806808376483179*^9, 
   3.806808391960993*^9}},ExpressionUUID->"8eb44ccf-50bf-45d4-b335-\
0312751cfeb8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"refractiveIndexValue", "[", 
   RowBox[{
    RowBox[{"medium_", "?", "mediumQ"}], ",", 
    RowBox[{"lambda_", "?", "NumberQ"}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{"refractiveIndexValue", "[", "medium", "]"}], "[", "lambda", 
   "]"}]}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796768783298791*^9, 3.796768789644017*^9}, 
   3.7967696126702642`*^9, {3.796769673614977*^9, 3.796769703336803*^9}, {
   3.796769736246367*^9, 3.796769766195997*^9}, {3.796769861633333*^9, 
   3.796769871992592*^9}, {3.796770381607551*^9, 3.7967703891334753`*^9}, {
   3.796857868002528*^9, 3.796857882505954*^9}, {3.796857912757736*^9, 
   3.796858168087769*^9}, {3.796858217702066*^9, 3.7968582415306177`*^9}, {
   3.79685828249403*^9, 3.796858404584647*^9}, {3.79687844403358*^9, 
   3.7968784459110527`*^9}, 3.796954724715143*^9, 3.796954957531233*^9, 
   3.796955074434312*^9, {3.798169678482917*^9, 3.798169795609256*^9}, 
   3.798169832780407*^9, {3.7981699234382772`*^9, 3.798169935384864*^9}, {
   3.798169981837564*^9, 3.798170011887957*^9}, {3.7981700492735*^9, 
   3.798170054428008*^9}, {3.798170086367022*^9, 3.798170164792136*^9}, {
   3.7981709726947813`*^9, 3.7981709736564093`*^9}, {3.800337317960484*^9, 
   3.800337370754239*^9}, {3.800424370805395*^9, 3.8004243770774*^9}, {
   3.800424590135569*^9, 3.800424591235078*^9}, 3.8004248924366198`*^9, 
   3.801784900846195*^9, {3.801785217696589*^9, 3.8017852904501*^9}, {
   3.801785372296048*^9, 
   3.8017853735110407`*^9}},ExpressionUUID->"4d84905a-5a08-41ac-8a15-\
de5b8b82ad19"],

Cell[BoxData[
 RowBox[{
  RowBox[{"createConstantMedium", "[", 
   RowBox[{"atmosphere", ",", "1.0"}], "]"}], ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796954994104351*^9, 3.796954996691864*^9}, {
  3.798169374715516*^9, 3.7981693882706203`*^9}, {3.800425586584507*^9, 
  3.8004255871913147`*^9}, {3.800429089256276*^9, 
  3.800429091727315*^9}},ExpressionUUID->"119d8a14-786b-497e-9b8e-\
007fee6b550f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"sellmeierDispersion", "[", 
   RowBox[{
   "a1_", ",", "b1_", ",", "a2_", ",", "b2_", ",", "a3_", ",", "b3_", ",", 
    "___"}], "]"}], ":=", 
  RowBox[{"Function", "[", 
   RowBox[{
    RowBox[{"{", "lambda", "}"}], ",", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"lsq", "=", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"1000", "lambda"}], ")"}], "^", "2"}]}], "}"}], ",", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"1", "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"a1", "/", 
            RowBox[{"(", 
             RowBox[{"lsq", "-", "b1"}], ")"}]}], "+", 
           RowBox[{"a2", "/", 
            RowBox[{"(", 
             RowBox[{"lsq", "-", "b2"}], ")"}]}], "+", 
           RowBox[{"a3", "/", 
            RowBox[{"(", 
             RowBox[{"lsq", "-", "b3"}], ")"}]}]}], ")"}], "lsq"}]}], "]"}]}],
      "]"}]}], "]"}]}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796954994104351*^9, 3.796954996691864*^9}, {
  3.798169374715516*^9, 3.798169397586282*^9}, {3.798169430044155*^9, 
  3.798169435196796*^9}},
 CellLabel->"In[9]:=",ExpressionUUID->"789b8c34-9ea4-4d99-81cd-5d5d5a51b806"],

Cell[BoxData[
 RowBox[{
  RowBox[{"schottDispersion", "[", 
   RowBox[{
   "a0_", ",", "a1_", ",", "a2_", ",", "a3_", ",", "a4_", ",", "a5_", ",", 
    "___"}], "]"}], ":=", 
  RowBox[{"Function", "[", 
   RowBox[{
    RowBox[{"{", "lambda", "}"}], ",", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"lsq", "=", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"1000", "lambda"}], ")"}], "^", "2"}]}], "}"}], ",", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"a0", "+", 
        RowBox[{"a1", "*", "lsq"}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"a2", "+", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"a3", "+", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"a4", "+", 
                 RowBox[{"a5", "/", "lsq"}]}], ")"}], "/", "lsq"}]}], ")"}], 
            "/", "lsq"}]}], ")"}], "/", "lsq"}]}], "]"}]}], "]"}]}], 
   "]"}]}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796954994104351*^9, 3.796954996691864*^9}, {
   3.798169374715516*^9, 3.798169407756486*^9}, 3.798169440495715*^9},
 CellLabel->"In[10]:=",ExpressionUUID->"db0886dc-19b0-466a-a17f-10c6696d1e36"],

Cell[BoxData[
 RowBox[{
  RowBox[{"conradyDispersion", "[", 
   RowBox[{"a_", ",", "b_", ",", "c_", ",", "___"}], "]"}], ":=", 
  RowBox[{"Function", "[", 
   RowBox[{
    RowBox[{"{", "lambda", "}"}], ",", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"l", "=", 
        RowBox[{"1000", "lambda"}]}], "}"}], ",", 
      RowBox[{"a", "+", 
       RowBox[{"b", "/", "l"}], "+", 
       RowBox[{"c", "/", 
        RowBox[{"l", "^", "3.5"}]}]}]}], "]"}]}], "]"}]}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796954994104351*^9, 3.796954996691864*^9}, {
  3.798169374715516*^9, 3.798169407756486*^9}, {3.798169447583293*^9, 
  3.798169463954516*^9}, {3.7981694971019793`*^9, 3.798169500275077*^9}},
 CellLabel->"In[11]:=",ExpressionUUID->"f18df512-0bfa-41c7-84bb-049381804c05"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"interpretNumeric", "::", "cannotconvert"}], "=", 
   "\"\<A non-numerical string is found in `1`\>\""}], ";", 
  RowBox[{
   RowBox[{"interpretNumeric", "[", "s_String", "]"}], ":=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"n", "=", 
       RowBox[{"ToExpression", "[", 
        RowBox[{"StringReplace", "[", 
         RowBox[{"s", ",", 
          RowBox[{"\"\<E\>\"", "\[Rule]", "\"\<*10^\>\""}]}], "]"}], "]"}]}], 
      "}"}], ",", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", " ", 
        RowBox[{"NumberQ", "[", "n", "]"}]}], ",", 
       RowBox[{"Message", "[", 
        RowBox[{
         RowBox[{"interpretNumeric", "::", "cannotconvert"}], ",", "s"}], 
        "]"}], ",", "n"}], "]"}]}], "]"}]}]}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796954994104351*^9, 3.796954996691864*^9}, {
   3.798169374715516*^9, 3.798169407756486*^9}, {3.798169447583293*^9, 
   3.798169463954516*^9}, {3.7981694971019793`*^9, 3.798169550022396*^9}, {
   3.810942140854842*^9, 3.810942188994709*^9}, 3.81094235067008*^9, {
   3.81094242135583*^9, 
   3.810942510827629*^9}},ExpressionUUID->"6575cb90-6863-4280-af11-\
06cfd9d2d1ee"],

Cell[BoxData[
 RowBox[{
  RowBox[{"dispersionFunctionFromString", "[", 
   RowBox[{"s_String", ",", "modelFunction_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "sp", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"sp", "=", 
      RowBox[{"StringSplit", "[", "s", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "sp", "]"}], "===", "0"}], "||", 
        RowBox[{
         RowBox[{"First", "[", "sp", "]"}], "=!=", "\"\<CD\>\""}]}], ",", 
       RowBox[{"Return", "[", "$Failed", "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Apply", "[", 
      RowBox[{"modelFunction", ",", 
       RowBox[{"Map", "[", 
        RowBox[{"interpretNumeric", ",", 
         RowBox[{"Rest", "[", "sp", "]"}]}], "]"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796954994104351*^9, 3.796954996691864*^9}, {
   3.798169374715516*^9, 3.798169407756486*^9}, {3.798169447583293*^9, 
   3.798169463954516*^9}, {3.7981694971019793`*^9, 3.798169550022396*^9}, {
   3.810942140854842*^9, 3.810942188994709*^9}, 
   3.81094235067008*^9},ExpressionUUID->"2053d5a7-1c3f-4553-8ea9-\
88562a2d912c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"$nameHeader", "=", "\"\<NM*\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"$disersionCoefficientHeader", "=", "\"\<CD*\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"$lambdaRangeHeader", "=", "\"\<LD*\>\""}], ";"}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796954994104351*^9, 3.796954996691864*^9}, {
  3.798169374715516*^9, 3.798169407756486*^9}, {3.798169447583293*^9, 
  3.798169463954516*^9}, {3.7981694971019793`*^9, 3.798169550022396*^9}, {
  3.7981706553136787`*^9, 3.798170655524776*^9}},
 CellLabel->"In[13]:=",ExpressionUUID->"3e45eb02-c990-4c31-87e3-80bdb7678b99"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "dispersionModels", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"dispersionModels", "[", "1", "]"}], "=", "schottDispersion"}], 
  ";", 
  RowBox[{
   RowBox[{"dispersionModels", "[", "2", "]"}], "=", "sellmeierDispersion"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"dispersionModels", "[", "5", "]"}], "=", "conradyDispersion"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"dispersionModels", "[", "_", "]"}], ":=", "$Failed"}], 
  ";"}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796954994104351*^9, 3.796954996691864*^9}, {
  3.798169374715516*^9, 3.798169407756486*^9}, {3.798169447583293*^9, 
  3.798169463954516*^9}, {3.7981694971019793`*^9, 3.798169548886183*^9}},
 CellLabel->"In[16]:=",ExpressionUUID->"7d1eb72b-9645-4de1-b2dc-27a39c9344c5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"headerMatchQ", "[", 
   RowBox[{"s_String", ",", "header_String"}], "]"}], ":=", 
  RowBox[{"StringMatchQ", "[", 
   RowBox[{"s", ",", "header"}], "]"}]}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796954994104351*^9, 3.796954996691864*^9}, {
  3.798169374715516*^9, 3.798169407756486*^9}, {3.798169447583293*^9, 
  3.798169463954516*^9}, {3.7981694971019793`*^9, 3.7981695476143312`*^9}, {
  3.798170664448641*^9, 3.7981706666077347`*^9}},
 CellLabel->"In[20]:=",ExpressionUUID->"f57df671-ff22-467d-8d14-d8ca58e29207"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"rangeFind", "[", 
   RowBox[{"{", "}"}], "]"}], ":=", "All"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"rangeFind", "[", 
   RowBox[{"{", "s_String", "}"}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ws", "=", 
      RowBox[{"StringSplit", "[", "s", "]"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"0.001", 
       RowBox[{"interpretNumeric", "[", 
        RowBox[{"ws", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ",", 
      RowBox[{"0.001", 
       RowBox[{"interpretNumeric", "[", 
        RowBox[{"ws", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "]"}]}]}], "}"}]}], 
   "]"}]}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796954994104351*^9, 3.796954996691864*^9}, {
  3.798169374715516*^9, 3.798169407756486*^9}, {3.798169447583293*^9, 
  3.798169463954516*^9}, {3.7981694971019793`*^9, 3.7981695476143312`*^9}, {
  3.798170664448641*^9, 3.7981706666077347`*^9}, {3.810942073029785*^9, 
  3.810942073030469*^9}, {3.810942155260391*^9, 
  3.810942155261375*^9}},ExpressionUUID->"d3a2c92a-d903-4d56-9b69-\
a257abb694cc"],

Cell[BoxData[
 RowBox[{
  RowBox[{"readDispersion", "[", 
   RowBox[{"strs", ":", 
    RowBox[{"{", 
     RowBox[{"_String", "..."}], "}"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "frst", ",", "name", ",", "dispf", ",", "dlin", ",", "rlin", ",", 
      "rng"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"frst", "=", 
      RowBox[{"StringSplit", "[", 
       RowBox[{"strs", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"name", "=", 
      RowBox[{"frst", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"dispf", "=", 
      RowBox[{"dispersionModels", "[", 
       RowBox[{"ToExpression", "[", 
        RowBox[{"frst", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"dispf", "\[Equal]", "$Failed"}], ",", 
       RowBox[{"Return", "[", "$Failed", "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"dlin", "=", 
      RowBox[{
       RowBox[{"Flatten", "[", 
        RowBox[{"Select", "[", 
         RowBox[{"strs", ",", 
          RowBox[{
           RowBox[{"headerMatchQ", "[", 
            RowBox[{"#", ",", "$disersionCoefficientHeader"}], "]"}], "&"}]}],
          "]"}], "]"}], "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"rlin", "=", 
      RowBox[{"rangeFind", "[", 
       RowBox[{"Flatten", "[", 
        RowBox[{"Select", "[", 
         RowBox[{"strs", ",", 
          RowBox[{
           RowBox[{"headerMatchQ", "[", 
            RowBox[{"#", ",", "$lambdaRangeHeader"}], "]"}], "&"}]}], "]"}], 
        "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"name", ",", 
       RowBox[{"ToExpression", "[", 
        RowBox[{"toMediumSymbol", "[", "name", "]"}], "]"}], ",", 
       RowBox[{"dispersionFunctionFromString", "[", 
        RowBox[{"dlin", ",", "dispf"}], "]"}], ",", "rlin"}], "}"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796954994104351*^9, 3.796954996691864*^9}, {
   3.798169374715516*^9, 3.798169407756486*^9}, {3.798169447583293*^9, 
   3.798169463954516*^9}, {3.7981694971019793`*^9, 3.798169545826345*^9}, 
   3.7981706743834553`*^9},
 CellLabel->"In[23]:=",ExpressionUUID->"bf3be655-9617-4048-95ac-6fe87f3885d8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"toMediumSymbol", "[", "s_String", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "sl", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"sl", "=", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"StringMatchQ", "[", 
          RowBox[{"s", ",", 
           RowBox[{"RegularExpression", "[", "\"\<\\\\d\>\"", "]"}]}], "]"}], 
         ",", "\"\<$\>\"", ",", "\"\<\>\""}], "]"}], "<>", 
       RowBox[{"ToLowerCase", "[", "s", "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"StringReplace", "[", 
      RowBox[{"sl", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\"\<-\>\"", "\[Rule]", "\"\<$\>\""}], ",", 
         RowBox[{"\"\<_\>\"", "\[Rule]", "\"\<$\>\""}]}], "}"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796954994104351*^9, 3.796954996691864*^9}, {
  3.798169374715516*^9, 3.798169407756486*^9}, {3.798169447583293*^9, 
  3.798169463954516*^9}, {3.7981694971019793`*^9, 3.798169544813793*^9}},
 CellLabel->"In[24]:=",ExpressionUUID->"0f6144c3-dc4f-4c9f-91d0-2389909f45a6"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"mediumCatalog", "[", "]"}], "=", 
   RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Clear", "[", "createMediumsFromAGFFile", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"createMediumsFromAGFFile", "::", "cannotopen"}], "=", 
   "\"\<can not open the path `1`\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"createMediumsFromAGFFile", "[", "path_String", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "catalogName", 
     RowBox[{"(*", 
      RowBox[{
      ",", "strs", ",", "lines", ",", "rlines", ",", "blck", ",", "ps"}], 
      "*)"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"Not", "[", 
        RowBox[{"StringMatchQ", "[", 
         RowBox[{
          RowBox[{"FileExtension", "[", "path", "]"}], ",", "\"\<AGF\>\"", 
          ",", 
          RowBox[{"IgnoreCase", "\[Rule]", "True"}]}], "]"}], "]"}], ",", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"parseStringForDispersion", "::", "cannotopen"}], ",", 
          "path"}], "]"}], ";", 
        RowBox[{"Return", "[", "$Failed", "]"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"strs", "=", 
      RowBox[{"ReadList", "[", 
       RowBox[{"path", ",", "String", ",", 
        RowBox[{"RecordSeparators", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"\"\<\\n\>\"", ",", "\"\<\\r\\n\>\"", ",", "\"\<\\r\>\""}], 
          "}"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"strs", "===", "$Failed"}], ",", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"parseStringForDispersion", "::", "cannotopen"}], ",", 
          "path"}], "]"}], ";", 
        RowBox[{"Return", "[", "$Failed", "]"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"createMediumsFromAGFString", "[", 
      RowBox[{"strs", ",", 
       RowBox[{"FileBaseName", "[", "path", "]"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796954994104351*^9, 3.796954996691864*^9}, {
   3.798169374715516*^9, 3.798169407756486*^9}, {3.798169447583293*^9, 
   3.798169463954516*^9}, {3.7981694971019793`*^9, 3.798169541686063*^9}, 
   3.798170684678667*^9, {3.7981710707838*^9, 3.7981710853852663`*^9}, {
   3.823224099696052*^9, 3.823224189751524*^9}, {3.82322448153461*^9, 
   3.823224483723311*^9}, {3.8232245408788233`*^9, 
   3.823224544315576*^9}},ExpressionUUID->"d6fe9365-c81d-4431-807d-\
228f7d50d915"],

Cell[BoxData[
 RowBox[{
  RowBox[{"createMediumsFromAGFString", "[", 
   RowBox[{
    RowBox[{"agfstrs", ":", 
     RowBox[{"{", 
      RowBox[{"_String", "..."}], "}"}]}], ",", "catalogName_String"}], "]"}],
   ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"strs", ",", "lines", ",", "rlines", ",", "blck", ",", "ps"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"catalogName", "=", 
       RowBox[{"FileBaseName", "[", "catName", "]"}]}], ";"}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"strs", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"StringReplace", "[", 
          RowBox[{"#", ",", 
           RowBox[{
            RowBox[{"RegularExpression", "[", "\"\<[[:cntrl:]]\>\"", "]"}], 
            "\[RuleDelayed]", "\"\<\>\""}]}], "]"}], "&"}], ",", "agfstrs"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"lines", "=", 
      RowBox[{"SequenceSplit", "[", 
       RowBox[{"strs", ",", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"x_", "?", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"headerMatchQ", "[", 
              RowBox[{"#", ",", "$nameHeader"}], "]"}], "&"}], ")"}]}], "}"}],
          "\[RuleDelayed]", 
         RowBox[{"{", "x", "}"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"rlines", "=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"headerMatchQ", "[", 
         RowBox[{
          RowBox[{"lines", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", "$nameHeader"}], 
         "]"}], ",", "lines", ",", 
        RowBox[{"Rest", "[", "lines", "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"blck", "=", 
      RowBox[{"Map", "[", 
       RowBox[{"Flatten", ",", 
        RowBox[{"Partition", "[", 
         RowBox[{"rlines", ",", "2"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ps", "=", 
      RowBox[{"Select", "[", 
       RowBox[{
        RowBox[{"Map", "[", 
         RowBox[{"readDispersion", ",", "blck"}], "]"}], ",", 
        RowBox[{
         RowBox[{"#", "=!=", "$Failed"}], "&"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"AppendTo", "[", 
      RowBox[{
       RowBox[{"mediumCatalog", "[", "]"}], ",", "catalogName"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"mediumCatalog", "[", "catalogName", "]"}], "=", 
      RowBox[{"Map", "[", 
       RowBox[{"First", ",", "ps"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"createMedium", "[", 
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", 
          RowBox[{"#", "[", 
           RowBox[{"[", "3", "]"}], "]"}], ",", 
          RowBox[{"mediumName", "\[Rule]", 
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], ",", 
          RowBox[{"lambdaDomain", "\[Rule]", 
           RowBox[{"#", "[", 
            RowBox[{"[", "4", "]"}], "]"}]}]}], "]"}], "&"}], ",", "ps"}], 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"ReleaseHold", "[", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Hold", "[", 
          RowBox[{
           RowBox[{"mediumCatalog", "[", 
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}], "=", 
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "&"}], ",", "ps"}], 
       "]"}], "]"}], ";", "\[IndentingNewLine]", "catalogName"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796954994104351*^9, 3.796954996691864*^9}, {
   3.798169374715516*^9, 3.798169407756486*^9}, {3.798169447583293*^9, 
   3.798169463954516*^9}, {3.7981694971019793`*^9, 3.798169541686063*^9}, 
   3.798170684678667*^9, {3.7981710707838*^9, 3.7981710853852663`*^9}, {
   3.823224099696052*^9, 3.823224189751524*^9}, {3.823224374444541*^9, 
   3.823224381064927*^9}, {3.823224492096607*^9, 
   3.823224532378274*^9}},ExpressionUUID->"09458643-a69d-4d2a-85cb-\
a524f0d8fbe5"]
}, Open  ]],

Cell[CellGroupData[{

Cell["ray", "Subsection",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.7969526425379457`*^9, 
  3.796952645067474*^9}},ExpressionUUID->"389ec9a6-9b9b-4a1e-95e2-\
00e0890a5b6d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"raySet", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"y0_", ",", "z0_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"yd_", ",", "zd_"}], "}"}], ",", "opt___"}], "]"}], ":=", 
  RowBox[{"ray", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"y0", ",", "z0"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"yd", ",", "zd"}], "}"}], ",", "opt"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"raySet", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"y0_", ",", "z0_"}], "}"}], ",", 
    RowBox[{"angleToAxis_", "?", "NumericQ"}], ",", 
    RowBox[{"refractiveIndex_", "?", "NumericQ"}], ",", "opt___"}], "]"}], ":=", 
  RowBox[{"ray", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"y0", ",", "z0"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"refractiveIndex", "*", 
       RowBox[{"Sin", "[", "angleToAxis", "]"}]}], ",", 
      RowBox[{"refractiveIndex", "*", 
       RowBox[{"Cos", "[", "angleToAxis", "]"}]}]}], "}"}], ",", "opt"}], 
   "]"}]}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.554149894752626*^9, 3.5541499463815947`*^9}, {
   3.554150738981382*^9, 3.554150755438065*^9}, {3.554157397009694*^9, 
   3.554157398078087*^9}, {3.7965335856377287`*^9, 3.796533643114579*^9}, {
   3.796533702729501*^9, 3.7965337347938423`*^9}, {3.7965356683035717`*^9, 
   3.796535670439974*^9}, 3.7965357078011513`*^9, {3.800064527397431*^9, 
   3.800064544191798*^9}, {3.8001314966717443`*^9, 3.80013153788241*^9}, {
   3.800131597723885*^9, 3.800131601661957*^9}, {3.800131719877727*^9, 
   3.800131745858787*^9}},
 CellLabel->"In[29]:=",ExpressionUUID->"0a25a690-cfb4-48ad-89fe-1972742957a8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"appendRayOption", "[", 
   RowBox[{
    RowBox[{"ray", "[", 
     RowBox[{"p_", ",", "d_", ",", "o___"}], "]"}], ",", "opt___"}], "]"}], ":=", 
  RowBox[{"ray", "[", 
   RowBox[{"p", ",", "d", ",", "o", ",", "opt"}], "]"}]}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.554149894752626*^9, 3.5541499463815947`*^9}, {
   3.554150738981382*^9, 3.554150755438065*^9}, {3.554157397009694*^9, 
   3.554157398078087*^9}, {3.7965335856377287`*^9, 3.796533643114579*^9}, {
   3.796533702729501*^9, 3.7965337347938423`*^9}, {3.7965356683035717`*^9, 
   3.796535670439974*^9}, 3.7965357078011513`*^9, {3.800064527397431*^9, 
   3.800064544191798*^9}, {3.8001314966717443`*^9, 3.80013153788241*^9}, {
   3.800131597723885*^9, 3.800131601661957*^9}, {3.800131719877727*^9, 
   3.800131745858787*^9}, {3.8001558545140133`*^9, 3.8001558722302628`*^9}},
 CellLabel->"In[31]:=",ExpressionUUID->"233d4a49-01ef-49ad-b198-de33ca0b991c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"objectSidePrincipalPointPosition", "[", 
   RowBox[{"wl_", ",", 
    RowBox[{"solverResult", ":", 
     RowBox[{"{", "__Rule", "}"}]}]}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"n", "=", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"refractiveIndexValue", "[", 
         RowBox[{"lensMediumSymbol", "/.", "solverResult"}], "]"}], "[", "wl",
         "]"}], ")"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"-", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"lensMediumThickness", "*", "frontSurfaceCurvature"}], ")"}],
         "/", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
          "lensMediumThickness", "*", "frontSurfaceCurvature", "*", 
           "backSurfaceCurvature", "*", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"-", "1"}], "+", "n"}], ")"}]}], "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"frontSurfaceCurvature", "-", "backSurfaceCurvature"}], 
            ")"}], "*", "n"}]}], ")"}]}], ")"}]}], "/.", "solverResult"}]}], 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.825383793082452*^9, 3.82538382086176*^9}, {
   3.825383888086138*^9, 3.825383940112885*^9}, {3.825384066239044*^9, 
   3.825384077395413*^9}, 3.825385910678401*^9},
 CellLabel->
  "In[342]:=",ExpressionUUID->"183ed3f3-fd60-4ddf-a8ef-3a5cbd2da61a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Clear", "[", "domainDefinedMarginalRay", "]"}], ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.554149894752626*^9, 3.5541499463815947`*^9}, {
   3.554150738981382*^9, 3.554150755438065*^9}, {3.554157397009694*^9, 
   3.554157398078087*^9}, {3.7965335856377287`*^9, 3.796533643114579*^9}, {
   3.796533702729501*^9, 3.7965337347938423`*^9}, {3.7965356683035717`*^9, 
   3.796535670439974*^9}, 3.7965357078011513`*^9, {3.800064527397431*^9, 
   3.800064690976231*^9}},
 CellLabel->"In[32]:=",ExpressionUUID->"51bfd457-2e8a-4991-9024-9690078c2c6e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"markRayAsDomainDefinedMarginal", "[", "r_ray", "]"}], ":=", 
  RowBox[{"appendRayOption", "[", 
   RowBox[{"r", ",", "domainDefinedMarginalRay"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"raySetAsDomainDefinedMarginal", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"y0_", ",", "z0_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"yd_", ",", "zd_"}], "}"}], ",", "opt___"}], "]"}], ":=", 
  RowBox[{"raySet", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"y0", ",", "z0"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"yd", ",", "zd"}], "}"}], ",", "domainDefinedMarginalRay", ",", 
    "opt"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"domainDefinedMarginalRayQ", "[", 
   RowBox[{"ray", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"_", ",", "_"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"_", ",", "_"}], "}"}], ",", "opt___"}], "]"}], "]"}], ":=", 
  RowBox[{"MemberQ", "[", 
   RowBox[{
    RowBox[{"{", "opt", "}"}], ",", "domainDefinedMarginalRay"}], 
   "]"}]}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.554149894752626*^9, 3.5541499463815947`*^9}, {
   3.554150738981382*^9, 3.554150755438065*^9}, {3.554157397009694*^9, 
   3.554157398078087*^9}, {3.7965335856377287`*^9, 3.796533643114579*^9}, {
   3.796533702729501*^9, 3.7965337347938423`*^9}, {3.7965356683035717`*^9, 
   3.796535670439974*^9}, 3.7965357078011513`*^9, {3.800064527397431*^9, 
   3.800064690976231*^9}, {3.8001314378438787`*^9, 3.8001314775681047`*^9}, {
   3.800131778923304*^9, 3.800131793897229*^9}, 3.800155485926979*^9, {
   3.8001556831341343`*^9, 3.800155684831127*^9}},
 CellLabel->"In[33]:=",ExpressionUUID->"a7d95f2f-93f7-48e4-a15d-935e4ba147de"],

Cell[BoxData[
 RowBox[{
  RowBox[{"setRefractiveIndexForRay", "[", 
   RowBox[{
    RowBox[{"ray", "[", 
     RowBox[{
      RowBox[{"p", ":", 
       RowBox[{"{", 
        RowBox[{"_", ",", "_"}], "}"}]}], ",", 
      RowBox[{"v", ":", 
       RowBox[{"{", 
        RowBox[{"_", ",", "_"}], "}"}]}], ",", "opt___"}], "]"}], ",", 
    "index_"}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"len", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"v", ".", "v"}], "]"}]}], "}"}], ",", 
    RowBox[{"ray", "[", 
     RowBox[{"p", ",", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"index", "/", "len"}], "*", "#"}], "&"}], ",", "v"}], "]"}],
       ",", "opt"}], "]"}]}], "]"}]}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.7968571524938393`*^9, 3.7968572957345057`*^9}},
 CellLabel->"In[36]:=",ExpressionUUID->"ea6d5175-72d2-49ff-a522-dce3dc3440ec"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"ray", "[", 
    RowBox[{
     RowBox[{"org", ":", 
      RowBox[{"{", 
       RowBox[{"y0_", ",", "z0_"}], "}"}]}], ",", 
     RowBox[{"dir", ":", 
      RowBox[{"{", 
       RowBox[{"yd_", ",", "zd_"}], "}"}]}], ",", "___"}], "]"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"origin", "[", 
     RowBox[{"ray", "[", 
      RowBox[{"org_", ",", "dir_", ",", "___"}], "]"}], "]"}], ":=", "org"}], 
   "\n", 
   RowBox[{
    RowBox[{"heightOfOrigin", "[", 
     RowBox[{"ray", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"h_", ",", "z_"}], "}"}], ",", "_", ",", "___"}], "]"}], 
     "]"}], ":=", "h"}], "\n", 
   RowBox[{
    RowBox[{"direction", "[", 
     RowBox[{"ray", "[", 
      RowBox[{"org_", ",", "dir_", ",", "___"}], "]"}], "]"}], ":=", "dir"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"offsetRay", "[", 
     RowBox[{
      RowBox[{"ray", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"y_", ",", "z_"}], "}"}], ",", "dir_", ",", "opt___"}], 
       "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"yoff_", ",", "zoff_"}], "}"}]}], "]"}], ":=", 
    RowBox[{"ray", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"y", "-", "yoff"}], ",", 
        RowBox[{"z", "-", "zoff"}]}], "}"}], ",", "dir", ",", "opt"}], 
     "]"}]}]}]}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{
  3.796953844412093*^9, {3.796953938341159*^9, 3.796953941683091*^9}, {
   3.796961565431848*^9, 3.79696159637002*^9}, {3.797024911602504*^9, 
   3.79702491387389*^9}, {3.797028824277893*^9, 3.7970288419182253`*^9}, {
   3.797028894491588*^9, 3.79702896167875*^9}, 3.7970293686297913`*^9},
 CellLabel->"In[37]:=",ExpressionUUID->"be057dca-ff09-4a6e-8e01-8dfa060c7faa"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"origin", "[", 
   RowBox[{"stoppedRay", "[", 
    RowBox[{
     RowBox[{"org", ":", 
      RowBox[{"{", 
       RowBox[{"_", ",", "_"}], "}"}]}], ",", "__"}], "]"}], "]"}], ":=", 
  "org"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"origin", "[", 
   RowBox[{"stoppedRay", "[", "noIntersection", "]"}], "]"}], ":=", 
  RowBox[{"Sequence", "[", "]"}]}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797026152920617*^9, 3.7970262008354397`*^9}, 
   3.7970282696672983`*^9},
 CellLabel->"In[41]:=",ExpressionUUID->"096b78ce-e164-4781-ab1e-72508d99cf3c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"parallelToAxisQ", "[", 
    RowBox[{"ray", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"_", ",", "_"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"yd_", ",", "_"}], "}"}], ",", "___"}], "]"}], "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"N", "[", "yd", "]"}], "===", "0.0"}], ")"}]}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"declinationForHeight", "[", "r_ray", "]"}], ":=", 
    RowBox[{"Indeterminate", "/;", 
     RowBox[{"parallelToAxisQ", "[", "r", "]"}]}]}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"declinationForHeight", "[", 
   RowBox[{"r", ":", 
    RowBox[{"ray", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"_", ",", "_"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"yd_", ",", "_"}], "}"}], ",", "___"}], "]"}]}], "]"}], ":=", 
  "yd"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"signOfCosine", "[", 
   RowBox[{"r", ":", 
    RowBox[{"ray", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"_", ",", "_"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"_", ",", "zd_"}], "}"}], ",", "___"}], "]"}]}], "]"}], ":=", 
  RowBox[{"Sign", "[", "zd", "]"}]}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797029422451811*^9, 3.7970294911342497`*^9}, 
   3.797029573376875*^9, {3.797029657382717*^9, 3.797029680357428*^9}, {
   3.802725804061676*^9, 3.8027258068841*^9}, {3.802725952627593*^9, 
   3.802726005885586*^9}, 
   3.802727112986178*^9},ExpressionUUID->"836824c6-c5a1-47d1-b475-\
d6319927ff08"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"offsetBackRay", "[", 
   RowBox[{
    RowBox[{"ray", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"y_", ",", "z_"}], "}"}], ",", "dir_", ",", "opt___"}], "]"}], 
    ",", 
    RowBox[{"{", 
     RowBox[{"yoff_", ",", "zoff_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"ray", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"y", "+", "yoff"}], ",", 
      RowBox[{"z", "+", "zoff"}]}], "}"}], ",", "dir", ",", "opt"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"offsetBackRay", "[", 
   RowBox[{
    RowBox[{"stoppedRay", "[", "noIntersection", "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"yoff_", ",", "zoff_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"stoppedRay", "[", "noIntersection", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"offsetBackRay", "[", 
   RowBox[{
    RowBox[{"stoppedRay", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"y_", ",", "z_"}], "}"}], ",", "a_"}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"yoff_", ",", "zoff_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"stoppedRay", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"y", "+", "yoff"}], ",", 
      RowBox[{"z", "+", "zoff"}]}], "}"}], ",", "a"}], "]"}]}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{
  3.796953844412093*^9, {3.796953938341159*^9, 3.796953941683091*^9}, {
   3.796961565431848*^9, 3.79696159637002*^9}, {3.797024911602504*^9, 
   3.797025007320793*^9}},
 CellLabel->"In[46]:=",ExpressionUUID->"cbf5282f-a66f-4e17-91e5-94dffa3a8cfb"],

Cell[BoxData[
 RowBox[{
  RowBox[{"refractiveIndexFromDirection", "[", 
   RowBox[{"ray", "[", 
    RowBox[{"_", ",", "dir_", ",", "___"}], "]"}], "]"}], ":=", 
  RowBox[{"Sqrt", "[", 
   RowBox[{"dir", ".", "dir"}], "]"}]}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{
  3.796953844412093*^9, {3.796953938341159*^9, 3.796953941683091*^9}, {
   3.796961565431848*^9, 3.79696159637002*^9}, {3.797024911602504*^9, 
   3.797024915145123*^9}},
 CellLabel->"In[49]:=",ExpressionUUID->"0981966b-9e20-4287-a0a7-ca3c67e7a172"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"axisCrossingPosition", "[", 
   RowBox[{"ray", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"y_", ",", "z_"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"s_", ",", "c_"}], "}"}], ",", "___"}], "]"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{
     RowBox[{"s", "*", "z"}], "-", 
     RowBox[{"c", "*", "y"}]}], ")"}], "/", "s"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"axisCrossingPosition", "[", 
   RowBox[{"ray", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"y_", ",", "z_"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"s_", "?", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"N", "[", "#", "]"}], "===", "0.0"}], "&"}], ")"}]}], ",", 
       "c_"}], "}"}], ",", "___"}], "]"}], "]"}], ":=", 
  "Indeterminate"}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797028450087489*^9, 3.797028469044547*^9}, {
  3.797028607393189*^9, 3.797028628306919*^9}},
 CellLabel->"In[50]:=",ExpressionUUID->"6defa6e0-352d-4839-8942-3f9ec39e4a75"]
}, Open  ]],

Cell[CellGroupData[{

Cell["raySequence", "Subsection",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.7969526726907187`*^9, 
  3.79695267719777*^9}},ExpressionUUID->"c48fb6b9-9563-4df0-958d-\
06cdd0474c58"],

Cell[BoxData[
 RowBox[{
  RowBox[{"raySegmentCount", "[", 
   RowBox[{"raySequence", "[", 
    RowBox[{"lambda_", ",", "rays_List"}], "]"}], "]"}], ":=", 
  RowBox[{"Length", "[", "rays", "]"}]}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796961831155655*^9, 3.796961885954783*^9}, {
  3.7970304511370277`*^9, 3.79703049142167*^9}, {3.7981457474151*^9, 
  3.798145771714437*^9}, {3.798145815063038*^9, 3.79814582081141*^9}},
 CellLabel->"In[52]:=",ExpressionUUID->"94c69d41-c539-43be-9239-5ffc9b324374"],

Cell[BoxData[
 RowBox[{
  RowBox[{"opticalPath", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"p1", ":", 
       RowBox[{"{", 
        RowBox[{"_", ",", "z1_"}], "}"}]}], ",", 
      RowBox[{"p2", ":", 
       RowBox[{"{", 
        RowBox[{"_", ",", "z2_"}], "}"}]}]}], "}"}], ",", "refInd_"}], "]"}], 
  ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"v", "=", 
      RowBox[{"p1", "-", "p2"}]}], "}"}], ",", 
    RowBox[{
     RowBox[{"Sign", "[", 
      RowBox[{"z2", "-", "z1"}], "]"}], "*", 
     RowBox[{"Sqrt", "[", 
      RowBox[{"v", ".", "v"}], "]"}], "refInd"}]}], "]"}], 
  RowBox[{"(*", 
   RowBox[{
   "assumed", " ", "rays", " ", "go", " ", "toward", " ", "positive", " ", 
    "z", " ", "direction"}], "*)"}]}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796961831155655*^9, 3.796961885954783*^9}, {
  3.7970304511370277`*^9, 3.79703049142167*^9}, {3.7981457474151*^9, 
  3.7981457617456703`*^9}, {3.798773671848132*^9, 3.7987737009961557`*^9}},
 CellLabel->"In[53]:=",ExpressionUUID->"c4581d23-41f9-49a2-beb8-c0bb465a4896"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"raySequence", "[", 
    RowBox[{"lambda_", ",", 
     RowBox[{"rays", ":", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"ray", "[", "___", "]"}], "..."}], "}"}]}]}], "]"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"waveLength", "[", 
     RowBox[{"raySequence", "[", 
      RowBox[{"lambda_", ",", "___"}], "]"}], "]"}], ":=", "lambda"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"sequenceOfRays", "[", 
     RowBox[{"raySequence", "[", 
      RowBox[{"lambda_", ",", "rays_List"}], "]"}], "]"}], ":=", 
    RowBox[{"Cases", "[", 
     RowBox[{"rays", ",", 
      RowBox[{"Except", "[", "untraceableRay", "]"}]}], "]"}]}]}]}]], "Input",\

 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796856547759344*^9, 3.796856561116248*^9}, {
   3.7968585997370358`*^9, 3.796858692372059*^9}, {3.796953328266081*^9, 
   3.796953330964087*^9}, {3.796953515853327*^9, 3.796953524764027*^9}, 
   3.796953863356751*^9, 3.7969613492790403`*^9, {3.79696146355809*^9, 
   3.796961559490305*^9}, {3.7969616054367237`*^9, 3.796961617902678*^9}, {
   3.7969618894982853`*^9, 3.796962018721459*^9}, {3.797025300141307*^9, 
   3.797025311525181*^9}, {3.797025456343191*^9, 3.79702545734301*^9}, {
   3.7970255193913717`*^9, 3.797025524014585*^9}, 3.797025605525152*^9, {
   3.797025865380913*^9, 3.797025933646471*^9}, {3.797025990869837*^9, 
   3.797026046411633*^9}},
 CellLabel->"In[54]:=",ExpressionUUID->"e4e960dd-0d66-45e2-afe6-41fd565f3fcc"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"opticalPathLength", "[", "rs_raySequence", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"sr", ",", "ps", ",", "inds"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"sr", "=", 
      RowBox[{"sequenceOfRays", "[", "rs", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ps", "=", 
      RowBox[{"Map", "[", 
       RowBox[{"origin", ",", "sr"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"inds", "=", 
      RowBox[{"Most", "[", 
       RowBox[{"Map", "[", 
        RowBox[{"refractiveIndexFromDirection", ",", "sr"}], "]"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"Total", "[", 
      RowBox[{"Thread", "[", 
       RowBox[{"opticalPath", "[", 
        RowBox[{
         RowBox[{"Most", "[", 
          RowBox[{"Transpose", "[", 
           RowBox[{"{", 
            RowBox[{"ps", ",", 
             RowBox[{"RotateLeft", "[", "ps", "]"}]}], "}"}], "]"}], "]"}], 
         ",", "inds"}], "]"}], "]"}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"opticalPathLengthForHeight", "[", "rs_raySequence", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"sr", ",", "ps", ",", "inds"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"sr", "=", 
      RowBox[{"sequenceOfRays", "[", "rs", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Cases", "[", 
         RowBox[{"sr", ",", 
          RowBox[{"stoppedRay", "[", "_", "]"}]}], "]"}], "=!=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"Return", "[", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0"}], "}"}], "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ps", "=", 
      RowBox[{"Map", "[", 
       RowBox[{"origin", ",", "sr"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"inds", "=", 
      RowBox[{"Most", "[", 
       RowBox[{"Map", "[", 
        RowBox[{"refractiveIndexFromDirection", ",", "sr"}], "]"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"heightOfOrigin", "[", 
        RowBox[{"First", "[", "sr", "]"}], "]"}], ",", 
       RowBox[{"Total", "[", 
        RowBox[{"Thread", "[", 
         RowBox[{"opticalPath", "[", 
          RowBox[{
           RowBox[{"Most", "[", 
            RowBox[{"Transpose", "[", 
             RowBox[{"{", 
              RowBox[{"ps", ",", 
               RowBox[{"RotateLeft", "[", "ps", "]"}]}], "}"}], "]"}], "]"}], 
           ",", "inds"}], "]"}], "]"}], "]"}]}], "}"}]}]}], 
   "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"opticalPathLengthForHeight", "[", 
   RowBox[{"rs_raySequence", ",", 
    RowBox[{"op_", "?", "opticsQ"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "ppos", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"ppos", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{"positionOfAttributedSurface", "[", 
        RowBox[{"op", ",", "pupilSurface", ",", "True"}], "]"}], "]"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"ppos", "===", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"Return", "[", 
        RowBox[{"opticalPathLengthForHeight", "[", "rs", "]"}], "]"}]}], 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"opticalPathLengthForHeight", "[", 
      RowBox[{"rs", ",", 
       RowBox[{
        RowBox[{"ppos", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "+", "1"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"opticalPathLengthForHeight", "[", 
   RowBox[{"rs_raySequence", ",", 
    RowBox[{"sn_", "?", "IntegerQ"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ppos", ",", "sr", ",", "ps", ",", "inds"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"sr", "=", 
      RowBox[{"sequenceOfRays", "[", "rs", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Cases", "[", 
         RowBox[{"sr", ",", 
          RowBox[{"stoppedRay", "[", "_", "]"}]}], "]"}], "=!=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"Return", "[", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0"}], "}"}], "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ps", "=", 
      RowBox[{"Map", "[", 
       RowBox[{"origin", ",", "sr"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"inds", "=", 
      RowBox[{"Most", "[", 
       RowBox[{"Map", "[", 
        RowBox[{"refractiveIndexFromDirection", ",", "sr"}], "]"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"heightOfOrigin", "[", 
        RowBox[{"sr", "[", 
         RowBox[{"[", "sn", "]"}], "]"}], "]"}], ",", 
       RowBox[{"Total", "[", 
        RowBox[{"Thread", "[", 
         RowBox[{"opticalPath", "[", 
          RowBox[{
           RowBox[{"Most", "[", 
            RowBox[{"Transpose", "[", 
             RowBox[{"{", 
              RowBox[{"ps", ",", 
               RowBox[{"RotateLeft", "[", "ps", "]"}]}], "}"}], "]"}], "]"}], 
           ",", "inds"}], "]"}], "]"}], "]"}]}], "}"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796856547759344*^9, 3.796856561116248*^9}, {
   3.7968585997370358`*^9, 3.796858692372059*^9}, {3.796953328266081*^9, 
   3.796953330964087*^9}, {3.796953515853327*^9, 3.796953524764027*^9}, 
   3.796953863356751*^9, 3.7969613492790403`*^9, {3.79696146355809*^9, 
   3.796961559490305*^9}, {3.7969616054367237`*^9, 3.796961617902678*^9}, {
   3.7969618894982853`*^9, 3.796962018721459*^9}, {3.797025300141307*^9, 
   3.797025311525181*^9}, {3.797025456343191*^9, 3.79702545734301*^9}, {
   3.7970255193913717`*^9, 3.797025524014585*^9}, 3.797025605525152*^9, {
   3.797025865380913*^9, 3.797025933646471*^9}, {3.797025990869837*^9, 
   3.7970260610706997`*^9}, {3.797026099389998*^9, 3.797026116096239*^9}, {
   3.7970262145053864`*^9, 3.797026226147839*^9}, {3.797030125434162*^9, 
   3.797030175914686*^9}, {3.797030207573413*^9, 3.79703021373919*^9}, {
   3.7970479184186974`*^9, 3.797048039606699*^9}, {3.7970481391985397`*^9, 
   3.7970481540124083`*^9}, {3.7970482621431227`*^9, 
   3.7970482652567167`*^9}, {3.797048369856492*^9, 3.797048402411417*^9}, 
   3.797048445278633*^9, {3.797114721470047*^9, 3.797114784391354*^9}, {
   3.797114852817202*^9, 3.7971148618623877`*^9}, {3.79711492077043*^9, 
   3.797115041564952*^9}, {3.797115157659132*^9, 3.797115167097574*^9}, {
   3.7971152976383057`*^9, 3.797115346563252*^9}, {3.7971154591813507`*^9, 
   3.797115513747149*^9}, 3.7973070331322527`*^9, {3.8026595949293633`*^9, 
   3.802659621613669*^9}, {3.8026596667942467`*^9, 3.802659815646047*^9}, {
   3.802659880806547*^9, 3.802659919777275*^9}, {3.802659967939518*^9, 
   3.802660020309835*^9}, {3.802660114732914*^9, 3.802660114935306*^9}, {
   3.802660254505312*^9, 
   3.80266027437276*^9}},ExpressionUUID->"97469671-630a-49de-ad53-\
3666f7311a7f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"opticalPathDifference", "[", 
   RowBox[{"ops", ":", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"_", ",", "_"}], "}"}], "..."}], "}"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"fitf", ",", "x"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"Not", "[", 
        RowBox[{"MatrixQ", "[", 
         RowBox[{"ops", ",", "NumberQ"}], "]"}], "]"}], ",", 
       RowBox[{"Return", "[", "$Failed", "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"fitf", "=", 
      RowBox[{"Fit", "[", 
       RowBox[{"ops", ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "x", ",", 
          RowBox[{"x", "^", "2"}]}], "}"}], ",", "x"}], "]"}]}], ";", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"subtract", " ", "y"}], "-", " ", 
       RowBox[{"and", " ", "z"}], "-", " ", 
       RowBox[{"focus", " ", "position", " ", "moving"}]}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "-", 
           RowBox[{"(", 
            RowBox[{"fitf", "/.", 
             RowBox[{"x", "->", 
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}]}], ")"}]}]}], "}"}], "&"}], 
       ",", "ops"}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"opticalPathDifference", "[", 
   RowBox[{"rss", ":", 
    RowBox[{"{", 
     RowBox[{"_raySequence", "..."}], "}"}]}], "]"}], ":=", 
  RowBox[{"opticalPathDifference", "[", 
   RowBox[{"Map", "[", 
    RowBox[{"opticalPathLengthForHeight", ",", "rss"}], "]"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"opticalPathDifference", "[", 
   RowBox[{
    RowBox[{"rss", ":", 
     RowBox[{"{", "__raySequence", "}"}]}], ",", 
    RowBox[{"op_", "?", "opticsQ"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ppos", ",", "sn", ",", "ops", ",", "fitf", ",", "x"}], "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"ppos", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{"positionOfAttributedSurface", "[", 
        RowBox[{"op", ",", "pupilSurface", ",", "True"}], "]"}], "]"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"ppos", "===", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"Return", "[", 
        RowBox[{"opticalPathDifference", "[", "rss", "]"}], "]"}]}], "]"}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"sn", "=", 
      RowBox[{
       RowBox[{"ppos", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "+", "1"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ops", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"opticalPathLengthForHeight", "[", 
          RowBox[{"#", ",", "sn"}], "]"}], "&"}], ",", "rss"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"fitf", "=", 
      RowBox[{"Fit", "[", 
       RowBox[{"ops", ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "x", ",", 
          RowBox[{"x", "^", "2"}]}], "}"}], ",", "x"}], "]"}]}], ";", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "-", 
           RowBox[{"(", 
            RowBox[{"fitf", "/.", 
             RowBox[{"x", "->", 
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}]}], ")"}]}]}], "}"}], "&"}], 
       ",", "ops"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796856547759344*^9, 3.796856561116248*^9}, {
   3.7968585997370358`*^9, 3.796858692372059*^9}, {3.796953328266081*^9, 
   3.796953330964087*^9}, {3.796953515853327*^9, 3.796953524764027*^9}, 
   3.796953863356751*^9, 3.7969613492790403`*^9, {3.79696146355809*^9, 
   3.796961559490305*^9}, {3.7969616054367237`*^9, 3.796961617902678*^9}, {
   3.7969618894982853`*^9, 3.796962018721459*^9}, {3.797025300141307*^9, 
   3.797025311525181*^9}, {3.797025456343191*^9, 3.79702545734301*^9}, {
   3.7970255193913717`*^9, 3.797025524014585*^9}, 3.797025605525152*^9, {
   3.797025865380913*^9, 3.797025933646471*^9}, {3.797025990869837*^9, 
   3.7970260610706997`*^9}, {3.797026099389998*^9, 3.797026116096239*^9}, {
   3.7970262145053864`*^9, 3.797026226147839*^9}, {3.797030125434162*^9, 
   3.797030175914686*^9}, {3.797030207573413*^9, 3.79703021373919*^9}, {
   3.7970479184186974`*^9, 3.797048039606699*^9}, {3.7970481391985397`*^9, 
   3.7970481540124083`*^9}, {3.7970482621431227`*^9, 
   3.7970482652567167`*^9}, {3.797048369856492*^9, 3.797048402411417*^9}, 
   3.797048445278633*^9, {3.797114721470047*^9, 3.797114784391354*^9}, {
   3.797114852817202*^9, 3.7971148618623877`*^9}, {3.79711492077043*^9, 
   3.797115041564952*^9}, {3.797115157659132*^9, 3.797115167097574*^9}, {
   3.7971152976383057`*^9, 3.797115346563252*^9}, {3.7971154591813507`*^9, 
   3.797115559084523*^9}, 3.7971156178705883`*^9, {3.797115819107245*^9, 
   3.797115861575301*^9}, {3.797307063767344*^9, 3.797307064079546*^9}, {
   3.7973072196536703`*^9, 3.797307264954484*^9}, {3.797743185445232*^9, 
   3.797743237392682*^9}, {3.797743341084299*^9, 3.7977433434621363`*^9}, 
   3.7977434530496283`*^9, {3.797743523782528*^9, 3.797743528644505*^9}, {
   3.797743710943523*^9, 3.797743711171598*^9}, {3.802660299673609*^9, 
   3.802660371438862*^9}, {3.802661413779879*^9, 3.8026614163903837`*^9}, {
   3.802661882293743*^9, 3.802661884656625*^9}, 3.802661923277779*^9, {
   3.802662016407947*^9, 3.802662043598961*^9}, {3.842057216062559*^9, 
   3.84205722915493*^9}},ExpressionUUID->"87a8bf67-462f-4749-9504-\
c45914e70343"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"logitudinalAberPositionReversed", "[", "rs_raySequence", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"sr", ",", "s", ",", "e"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"sr", "=", 
      RowBox[{"sequenceOfRays", "[", "rs", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"s", "=", 
      RowBox[{"First", "[", "sr", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"e", "=", 
      RowBox[{"Last", "[", "sr", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"axisCrossingPosition", "[", "e", "]"}], ",", 
       RowBox[{"heightOfOrigin", "[", "s", "]"}]}], "}"}]}]}], 
   "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"logitudinalAberPositionReversed", "[", 
   RowBox[{"rs_raySequence", ",", 
    RowBox[{"sn_", "?", "IntegerQ"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"sr", ",", "s", ",", "e"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"sr", "=", 
      RowBox[{"sequenceOfRays", "[", "rs", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"s", "=", 
      RowBox[{"sr", "[", 
       RowBox[{"[", "sn", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"e", "=", 
      RowBox[{"Last", "[", "sr", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"axisCrossingPosition", "[", "e", "]"}], ",", 
       RowBox[{"heightOfOrigin", "[", "s", "]"}]}], "}"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797028296187377*^9, 3.797028380156611*^9}, {
   3.797028537043461*^9, 3.797028589310945*^9}, {3.797028862327673*^9, 
   3.7970288638457603`*^9}, {3.797029229742413*^9, 3.797029248349979*^9}, {
   3.802660077584877*^9, 3.802660082219186*^9}, {3.802660128468727*^9, 
   3.8026601467280283`*^9}, 3.802660281775043*^9, 3.802660392229743*^9, {
   3.802660625670775*^9, 3.8026606261976624`*^9}, {3.802660678309651*^9, 
   3.802660802173542*^9}},ExpressionUUID->"87e451a9-a622-4bf7-bc4c-\
a90c97384cb5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"longitudinalSphericalAberration", "[", 
   RowBox[{
    RowBox[{"rs", ":", 
     RowBox[{"{", "__raySequence", "}"}]}], ",", 
    RowBox[{"op_", "?", "opticsQ"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ppos", ",", "sn"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"ppos", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{"positionOfAttributedSurface", "[", 
        RowBox[{"op", ",", "pupilSurface", ",", "True"}], "]"}], "]"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"ppos", "===", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"Return", "[", 
        RowBox[{"opticalPathDifference", "[", "rs", "]"}], "]"}]}], "]"}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"sn", "=", 
      RowBox[{
       RowBox[{"ppos", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "+", "1"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Select", "[", 
      RowBox[{
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"logitudinalAberPositionReversed", "[", 
           RowBox[{"#", ",", "sn"}], "]"}], "&"}], ",", "rs"}], "]"}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}], "\[GreaterEqual]", "0.0"}], 
        "&"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797028296187377*^9, 3.797028380156611*^9}, {
   3.797028537043461*^9, 3.797028589310945*^9}, {3.797028862327673*^9, 
   3.7970288638457603`*^9}, {3.797029229742413*^9, 3.797029248349979*^9}, {
   3.802660077584877*^9, 3.802660082219186*^9}, {3.802660128468727*^9, 
   3.8026601467280283`*^9}, 3.802660281775043*^9, 3.802660392229743*^9, {
   3.802660625670775*^9, 3.8026606261976624`*^9}, {3.802660678309651*^9, 
   3.802660802173542*^9}, {3.802661516325679*^9, 
   3.802661528609394*^9}},ExpressionUUID->"accedfff-d77e-4cd9-ba58-\
9e6b136968d9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"oscValueReversed", "[", 
   RowBox[{"rs_raySequence", ",", "f_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"sr", ",", "s", ",", "e", ",", "de", ",", "h"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"sr", "=", 
      RowBox[{"sequenceOfRays", "[", "rs", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"s", "=", 
      RowBox[{"First", "[", "sr", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"h", "=", 
      RowBox[{"heightOfOrigin", "[", "s", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"e", "=", 
      RowBox[{"Last", "[", "sr", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"de", "=", 
      RowBox[{"declinationForHeight", "[", "e", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"de", "=!=", "0.0"}], ",", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"-", 
            RowBox[{"signOfCosine", "[", "e", "]"}]}], 
           RowBox[{"h", "/", "de"}]}], "-", "f"}], ",", "h"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0.0", ",", "h"}], "}"}]}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"finiteOscValueReversed", "[", 
   RowBox[{"rs_raySequence", ",", 
    RowBox[{"{", 
     RowBox[{"dop_", ",", "dpi_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"sr", ",", "so", ",", "si"}], "}"}], ",", "\[IndentingNewLine]", 
    
    RowBox[{
     RowBox[{"sr", "=", 
      RowBox[{"sequenceOfRays", "[", "rs", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"so", "=", 
      RowBox[{"declinationForHeight", "[", 
       RowBox[{"First", "[", "sr", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"si", "=", 
      RowBox[{"declinationForHeight", "[", 
       RowBox[{"Last", "[", "sr", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"si", "=!=", "0.0"}], ",", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"-", 
            RowBox[{"signOfCosine", "[", 
             RowBox[{"Last", "[", "sr", "]"}], "]"}]}], "dop", "*", 
           RowBox[{"so", "/", "si"}]}], "-", "dpi"}], ",", 
         RowBox[{"dop", "*", "so"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0.0", ",", 
         RowBox[{"dop", "*", "so"}]}], "}"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797029157024097*^9, 3.797029191241912*^9}, {
   3.797029252163917*^9, 3.7970293034771767`*^9}, {3.797029503847419*^9, 
   3.797029519642888*^9}, {3.802660142183962*^9, 3.8026601638715973`*^9}, 
   3.8026602852278233`*^9, 3.802660905936068*^9, {3.802661010584999*^9, 
   3.802661043018936*^9}, {3.802669270321192*^9, 3.802669271718004*^9}, {
   3.802725592175235*^9, 3.8027256047749157`*^9}, {3.802725701536601*^9, 
   3.802725706758335*^9}, 3.802725849318131*^9, {3.802726038489332*^9, 
   3.802726147728467*^9}, {3.802726179993881*^9, 3.802726285519704*^9}, 
   3.802726642577175*^9, {3.80272714241847*^9, 3.8027271426985073`*^9}, {
   3.802727175885219*^9, 
   3.802727203495713*^9}},ExpressionUUID->"18f303b1-7d92-463c-beed-\
5b1c8f150539"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"offenceAgainstSineCondition", "[", 
   RowBox[{
    RowBox[{"rs", ":", 
     RowBox[{"{", "__raySequence", "}"}]}], ",", "f_"}], "]"}], ":=", 
  RowBox[{"Select", "[", 
   RowBox[{
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"oscValueReversed", "[", 
        RowBox[{"#", ",", "f"}], "]"}], "&"}], ",", "rs"}], "]"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"#", "[", 
       RowBox[{"[", 
        RowBox[{"-", "1"}], "]"}], "]"}], "\[GreaterEqual]", "0.0"}], "&"}]}],
    "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"offenceAgainstSineCondition", "[", 
   RowBox[{
    RowBox[{"rs", ":", 
     RowBox[{"{", "__raySequence", "}"}]}], ",", 
    RowBox[{"{", 
     RowBox[{"dop_", ",", "dpi_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"Select", "[", 
   RowBox[{
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"finiteOscValueReversed", "[", 
        RowBox[{"#", ",", 
         RowBox[{"{", 
          RowBox[{"dop", ",", "dpi"}], "}"}]}], "]"}], "&"}], ",", "rs"}], 
     "]"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"#", "[", 
       RowBox[{"[", 
        RowBox[{"-", "1"}], "]"}], "]"}], "\[GreaterEqual]", "0.0"}], "&"}]}],
    "]"}]}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797029157024097*^9, 3.797029191241912*^9}, {
   3.797029252163917*^9, 3.7970293034771767`*^9}, {3.797029503847419*^9, 
   3.797029519642888*^9}, {3.802660142183962*^9, 3.8026601638715973`*^9}, 
   3.8026602852278233`*^9, 3.802660905936068*^9, {3.802661010584999*^9, 
   3.802661043018936*^9}, {3.802661173318379*^9, 3.802661202364998*^9}, 
   3.802661537610805*^9, 3.802669267922929*^9, {3.802725461269506*^9, 
   3.802725579798884*^9}, {3.8027262977477283`*^9, 
   3.8027263091215353`*^9}},ExpressionUUID->"eb5833fd-e6d9-452a-8b16-\
d2d86dd712b8"]
}, Open  ]],

Cell[CellGroupData[{

Cell["shapes", "Subsection",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796952696530294*^9, 3.796952700769079*^9}, {
   3.796952731933558*^9, 3.796952732596759*^9}, 
   3.79773862217914*^9},ExpressionUUID->"c8f1572e-44c0-44c9-b021-\
e9de359f424d"],

Cell["\<\
All shape object has same arguments.
shapeObject[shapeParameters : {___}, implicitDomain : {_, _}, explicitDomain \
: {_, _}]
implicitDomain : domain region of the shape function
explicitDomain : user added domain. explicitDomain should  \[Element] \
implicitDomain\
\>", "Text",
 InitializationCell->True,
 CellChangeTimes->{{3.800133886764906*^9, 3.800133961048031*^9}, {
  3.800134205274849*^9, 
  3.800134338995187*^9}},ExpressionUUID->"c85d8ddf-d758-4844-a790-\
90a6ce7e6578"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "domainAll", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Interval", "[", "domainAll", "]"}], "^=", 
   RowBox[{"Interval", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"-", "Infinity"}], ",", "Infinity"}], "}"}], "]"}]}], ";", 
  RowBox[{
   RowBox[{"Between", "[", "domainAll", "]"}], "^=", 
   RowBox[{"Between", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"-", "Infinity"}], ",", "Infinity"}], "}"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"domain", "[", 
   RowBox[{"s_", "[", 
    RowBox[{
     RowBox[{"{", "___", "}"}], ",", "_", ",", "explicitDomain_"}], "]"}], 
   "]"}], ":=", 
  RowBox[{"explicitDomain", "/;", 
   RowBox[{"shapeQ", "[", "s", "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"implicitDomain", "[", 
   RowBox[{"s_", "[", 
    RowBox[{
     RowBox[{"{", "___", "}"}], ",", "impdom_", ",", "_"}], "]"}], "]"}], ":=", 
  RowBox[{"impdom", "/;", 
   RowBox[{"shapeQ", "[", "s", "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"insideDomain", "[", 
   RowBox[{"s_", "?", "shapeQ"}], "]"}], ":=", 
  RowBox[{"Between", "[", 
   RowBox[{"domain", "[", "s", "]"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"insideImplicitDomain", "[", 
   RowBox[{"s_", "?", "shapeQ"}], "]"}], ":=", 
  RowBox[{"Between", "[", 
   RowBox[{"implicitDomain", "[", "s", "]"}], "]"}]}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796877169503286*^9, 3.796877250191266*^9}, {
   3.796877289825718*^9, 3.796877341803919*^9}, {3.796877459314434*^9, 
   3.796877516578953*^9}, {3.796877591271963*^9, 3.7968776216918697`*^9}, {
   3.796877748359894*^9, 3.796877795691044*^9}, {3.796877831367427*^9, 
   3.796877860212453*^9}, {3.7968779293571663`*^9, 3.796877948416113*^9}, {
   3.796879897564604*^9, 3.79687999344204*^9}, 3.796880349978952*^9, {
   3.796880391018942*^9, 3.796880395239031*^9}, {3.796880514752489*^9, 
   3.796880527071312*^9}, {3.796880558438424*^9, 3.796880614624117*^9}, {
   3.7968806457862053`*^9, 3.796880655169403*^9}, {3.796880693410612*^9, 
   3.796880696964609*^9}, {3.7968833580035133`*^9, 3.79688337703966*^9}, 
   3.7969451019899683`*^9, {3.796945153869811*^9, 3.7969452078442287`*^9}, 
   3.79695281751539*^9, 3.796952848206065*^9, {3.7969535458043537`*^9, 
   3.796953558628438*^9}, 3.796953895680643*^9, {3.797803981679779*^9, 
   3.797803994154147*^9}, {3.7978040250162897`*^9, 3.7978040496884108`*^9}, 
   3.798429206492852*^9, {3.800066437853732*^9, 3.8000664751700907`*^9}, {
   3.800133652032836*^9, 3.800133670495042*^9}, {3.800134361149042*^9, 
   3.800134438888592*^9}, {3.800134472831417*^9, 3.800134497548888*^9}, {
   3.8001345915462008`*^9, 3.8001346231040287`*^9}, {3.800135981481265*^9, 
   3.800136034322405*^9}, {3.800138410877873*^9, 3.800138464737906*^9}},
 CellLabel->"In[66]:=",ExpressionUUID->"85878c51-1c4a-4582-872c-114edf74e966"],

Cell[BoxData[
 RowBox[{
  RowBox[{"copyShapeReplacingDomain", "[", 
   RowBox[{
    RowBox[{"s_", "[", 
     RowBox[{
      RowBox[{"p", ":", 
       RowBox[{"{", "___", "}"}]}], ",", "impdom_", ",", "dom_"}], "]"}], ",",
     "newDom_"}], "]"}], ":=", 
  RowBox[{"s", "[", 
   RowBox[{"p", ",", "impdom", ",", "newDom"}], "]"}]}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796877169503286*^9, 3.796877250191266*^9}, {
   3.796877289825718*^9, 3.796877341803919*^9}, {3.796877459314434*^9, 
   3.796877516578953*^9}, {3.796877591271963*^9, 3.7968776216918697`*^9}, {
   3.796877748359894*^9, 3.796877795691044*^9}, {3.796877831367427*^9, 
   3.796877860212453*^9}, {3.7968779293571663`*^9, 3.796877948416113*^9}, {
   3.796879897564604*^9, 3.79687999344204*^9}, 3.796880349978952*^9, {
   3.796880391018942*^9, 3.796880395239031*^9}, {3.796880514752489*^9, 
   3.796880527071312*^9}, {3.796880558438424*^9, 3.796880614624117*^9}, {
   3.7968806457862053`*^9, 3.796880655169403*^9}, {3.796880693410612*^9, 
   3.796880696964609*^9}, {3.7968833580035133`*^9, 3.79688337703966*^9}, 
   3.7969451019899683`*^9, {3.796945153869811*^9, 3.7969452078442287`*^9}, 
   3.79695281751539*^9, 3.796952848206065*^9, {3.7969535458043537`*^9, 
   3.796953558628438*^9}, 3.796953895680643*^9, {3.797803981679779*^9, 
   3.797803994154147*^9}, {3.7978040250162897`*^9, 3.7978040496884108`*^9}, 
   3.798429206492852*^9, {3.800066437853732*^9, 3.8000664751700907`*^9}, {
   3.800133652032836*^9, 3.800133670495042*^9}, {3.800134361149042*^9, 
   3.800134438888592*^9}, {3.800134472831417*^9, 3.800134497548888*^9}, {
   3.8001345915462008`*^9, 3.8001346231040287`*^9}, {3.800135981481265*^9, 
   3.800136034322405*^9}, {3.8001525684961433`*^9, 3.80015258948622*^9}, {
   3.800153251227948*^9, 3.800153252631577*^9}},
 CellLabel->"In[72]:=",ExpressionUUID->"bba909c5-dc2c-4423-9b02-72e5b81a9df2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"planeShape", "[", "]"}], ":=", 
  RowBox[{"plane", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "domainAll", ",", "domainAll"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"planeShape", "[", 
   RowBox[{"dom", ":", 
    RowBox[{"{", 
     RowBox[{"_", ",", "_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"plane", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "domainAll", ",", "dom"}], "]"}]}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796877169503286*^9, 3.796877250191266*^9}, {
   3.796877289825718*^9, 3.796877341803919*^9}, {3.796877459314434*^9, 
   3.796877516578953*^9}, {3.796877591271963*^9, 3.7968776216918697`*^9}, {
   3.796877748359894*^9, 3.796877795691044*^9}, {3.796877831367427*^9, 
   3.796877860212453*^9}, {3.7968779293571663`*^9, 3.796877948416113*^9}, {
   3.796879897564604*^9, 3.79687999344204*^9}, 3.796880349978952*^9, {
   3.796880391018942*^9, 3.796880395239031*^9}, {3.796880514752489*^9, 
   3.796880527071312*^9}, {3.796880558438424*^9, 3.796880614624117*^9}, {
   3.7968806457862053`*^9, 3.796880655169403*^9}, {3.796880693410612*^9, 
   3.796880696964609*^9}, {3.7968833580035133`*^9, 3.79688337703966*^9}, 
   3.7969451019899683`*^9, {3.796945153869811*^9, 3.7969452078442287`*^9}, 
   3.79695281751539*^9, 3.796952848206065*^9, {3.7969535458043537`*^9, 
   3.796953558628438*^9}, 3.796953895680643*^9, {3.797803981679779*^9, 
   3.797803994154147*^9}, {3.7978040250162897`*^9, 3.7978040496884108`*^9}, {
   3.798429206492852*^9, 3.798429259853134*^9}, {3.800065265951194*^9, 
   3.800065272971478*^9}, {3.800065907382147*^9, 3.800065916574608*^9}, {
   3.8000664768904753`*^9, 3.8000665497041893`*^9}, {3.8000781340200777`*^9, 
   3.80007813409937*^9}, {3.80013271440792*^9, 3.800132751400071*^9}, {
   3.800133577027255*^9, 3.800133583899769*^9}, {3.800134455450488*^9, 
   3.800134465485221*^9}},
 CellLabel->"In[73]:=",ExpressionUUID->"d1898dce-c5f5-43b2-a0e8-2c6fa61b8c36"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"perfectThinLensShape", "[", 
   RowBox[{"f_", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"N", "[", "f", "]"}], "===", "0.0"}], "&"}], ")"}]}], "]"}], ":=", 
  RowBox[{"planeShape", "[", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"perfectThinLensShape", "[", 
   RowBox[{"f_", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"N", "[", "#", "]"}], "=!=", "0.0"}], "&"}], ")"}]}], "]"}], ":=", 
  RowBox[{"perfectThinLens", "[", 
   RowBox[{
    RowBox[{"{", "f", "}"}], ",", "domainAll", ",", "domainAll"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"perfectThinLensShape", "[", 
   RowBox[{
    RowBox[{"f_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"N", "[", "#", "]"}], "=!=", "0.0"}], "&"}], ")"}]}], ",", 
    RowBox[{"dom", ":", 
     RowBox[{"{", 
      RowBox[{"_", ",", "_"}], "}"}]}]}], "]"}], ":=", 
  RowBox[{"perfectThinLens", "[", 
   RowBox[{
    RowBox[{"{", "f", "}"}], ",", "domainAll", ",", "dom"}], 
   "]"}]}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796877169503286*^9, 3.796877250191266*^9}, {
   3.796877289825718*^9, 3.796877341803919*^9}, {3.796877459314434*^9, 
   3.796877516578953*^9}, {3.796877591271963*^9, 3.7968776216918697`*^9}, {
   3.796877748359894*^9, 3.796877795691044*^9}, {3.796877831367427*^9, 
   3.796877860212453*^9}, {3.7968779293571663`*^9, 3.796877948416113*^9}, {
   3.796879897564604*^9, 3.79687999344204*^9}, 3.796880349978952*^9, {
   3.796880391018942*^9, 3.796880395239031*^9}, {3.796880514752489*^9, 
   3.796880527071312*^9}, {3.796880558438424*^9, 3.796880614624117*^9}, {
   3.7968806457862053`*^9, 3.796880655169403*^9}, {3.796880693410612*^9, 
   3.796880696964609*^9}, {3.7968833580035133`*^9, 3.79688337703966*^9}, 
   3.7969451019899683`*^9, {3.796945153869811*^9, 3.7969452078442287`*^9}, 
   3.79695281751539*^9, 3.796952848206065*^9, {3.7969535458043537`*^9, 
   3.796953558628438*^9}, 3.796953895680643*^9, {3.797803981679779*^9, 
   3.797803994154147*^9}, {3.7978040250162897`*^9, 3.7978040496884108`*^9}, {
   3.798429206492852*^9, 3.798429312618677*^9}, {3.798430193675152*^9, 
   3.7984302099632673`*^9}, {3.798435243516458*^9, 3.798435247182898*^9}, {
   3.800065954296433*^9, 3.800066007477895*^9}, {3.800066517133849*^9, 
   3.800066571035338*^9}, {3.8001327845328093`*^9, 3.800132832268674*^9}, {
   3.800133268696526*^9, 3.800133277133802*^9}, {3.800134564917966*^9, 
   3.8001345827038307`*^9}},
 CellLabel->"In[75]:=",ExpressionUUID->"b36e6e42-ada1-4a7c-bd8d-388c977ec5d8"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"quadraticImpicitDomain", "[", 
   RowBox[{
    RowBox[{"curv_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"N", "[", "#", "]"}], "=!=", "0.0"}], "&"}], ")"}]}], ",", 
    RowBox[{"conic_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"N", "[", "#", "]"}], "\[GreaterEqual]", 
        RowBox[{"-", "1.0"}]}], "&"}], ")"}]}]}], "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{
     RowBox[{"-", "1"}], "/", 
     RowBox[{"(", 
      RowBox[{"curv", 
       RowBox[{"(", 
        RowBox[{"1", "+", "conic"}], ")"}]}], ")"}]}], ",", 
    RowBox[{"1", "/", 
     RowBox[{"(", 
      RowBox[{"curv", 
       RowBox[{"(", 
        RowBox[{"1", "+", "conic"}], ")"}]}], ")"}]}]}], 
   "}"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"quadraticImpicitDomain", "[", 
   RowBox[{
    RowBox[{"curv_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"N", "[", "#", "]"}], "=!=", "0.0"}], "&"}], ")"}]}], ",", 
    RowBox[{"conic_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"N", "[", "#", "]"}], "<", 
        RowBox[{"-", "1.0"}]}], "&"}], ")"}]}]}], "]"}], ":=", 
  "domainAll"}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796877169503286*^9, 3.796877250191266*^9}, {
   3.796877289825718*^9, 3.796877341803919*^9}, {3.796877459314434*^9, 
   3.796877516578953*^9}, {3.796877591271963*^9, 3.7968776216918697`*^9}, {
   3.796877748359894*^9, 3.796877795691044*^9}, {3.796877831367427*^9, 
   3.796877860212453*^9}, {3.7968779293571663`*^9, 3.796877948416113*^9}, {
   3.796879897564604*^9, 3.79687999344204*^9}, 3.796880349978952*^9, {
   3.796880391018942*^9, 3.796880395239031*^9}, {3.796880514752489*^9, 
   3.796880527071312*^9}, {3.796880558438424*^9, 3.796880614624117*^9}, {
   3.7968806457862053`*^9, 3.796880655169403*^9}, {3.796880693410612*^9, 
   3.796880696964609*^9}, {3.7968833580035133`*^9, 3.79688337703966*^9}, 
   3.7969451019899683`*^9, {3.796945153869811*^9, 3.7969452078442287`*^9}, {
   3.79695281751539*^9, 3.796952819495062*^9}, {3.796953005173312*^9, 
   3.796953013622637*^9}, {3.796953573546941*^9, 3.796953576998888*^9}, 
   3.796953906908269*^9, {3.798402423661192*^9, 3.7984024314770937`*^9}, {
   3.800065721437642*^9, 3.800065859445539*^9}, {3.800066608554409*^9, 
   3.800066645310514*^9}, {3.800132993194942*^9, 3.8001331170853357`*^9}, {
   3.800141480114711*^9, 3.8001414867605133`*^9}, 3.800141547054996*^9},
 CellLabel->"In[78]:=",ExpressionUUID->"638c01e5-7051-4f28-bd37-c0f2eec3f1bf"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"sphericalShape", "[", 
   RowBox[{"curv_", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"N", "[", "#", "]"}], "===", "0.0"}], "&"}], ")"}]}], "]"}], ":=", 
  RowBox[{"planeShape", "[", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"sphericalShape", "[", 
   RowBox[{
    RowBox[{"curv_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"N", "[", "#", "]"}], "===", "0.0"}], "&"}], ")"}]}], ",", 
    "dom_"}], "]"}], ":=", 
  RowBox[{"planeShape", "[", "dom", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"sphericalShape", "[", 
   RowBox[{"curv_", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"N", "[", "#", "]"}], "=!=", "0.0"}], "&"}], ")"}]}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"impdom", "=", 
      RowBox[{"quadraticImpicitDomain", "[", 
       RowBox[{"curv", ",", "0.0"}], "]"}]}], "}"}], ",", 
    RowBox[{"spherical", "[", 
     RowBox[{
      RowBox[{"{", "curv", "}"}], ",", "impdom", ",", "impdom"}], "]"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"sphericalShape", "[", 
   RowBox[{
    RowBox[{"curv_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"N", "[", "#", "]"}], "=!=", "0.0"}], "&"}], ")"}]}], ",", 
    RowBox[{"dom", ":", 
     RowBox[{"{", 
      RowBox[{"_", ",", "_"}], "}"}]}]}], "]"}], ":=", 
  RowBox[{"spherical", "[", 
   RowBox[{
    RowBox[{"{", "curv", "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{"-", "1.0"}], "/", "curv"}], ",", 
      RowBox[{"1.0", "/", "curv"}]}], "}"}], ",", "dom"}], "]"}]}]}], "Input",\

 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796877169503286*^9, 3.796877250191266*^9}, {
   3.796877289825718*^9, 3.796877341803919*^9}, {3.796877459314434*^9, 
   3.796877516578953*^9}, {3.796877591271963*^9, 3.7968776216918697`*^9}, {
   3.796877748359894*^9, 3.796877795691044*^9}, {3.796877831367427*^9, 
   3.796877860212453*^9}, {3.7968779293571663`*^9, 3.796877948416113*^9}, {
   3.796879897564604*^9, 3.79687999344204*^9}, 3.796880349978952*^9, {
   3.796880391018942*^9, 3.796880395239031*^9}, {3.796880514752489*^9, 
   3.796880527071312*^9}, {3.796880558438424*^9, 3.796880614624117*^9}, {
   3.7968806457862053`*^9, 3.796880655169403*^9}, {3.796880693410612*^9, 
   3.796880696964609*^9}, {3.7968833580035133`*^9, 3.79688337703966*^9}, 
   3.7969451019899683`*^9, {3.796945153869811*^9, 3.7969452078442287`*^9}, 
   3.79695281751539*^9, 3.796952848206065*^9, {3.7969535648506603`*^9, 
   3.796953567762932*^9}, 3.796953902420086*^9, {3.8000665837946653`*^9, 
   3.800066600443862*^9}, {3.800132847174822*^9, 3.8001329093232718`*^9}, {
   3.800134633274693*^9, 3.800134647168975*^9}, {3.800134681255517*^9, 
   3.800134684552644*^9}, {3.806807355115734*^9, 3.806807382637075*^9}, 
   3.806809117895699*^9, {3.806809246523574*^9, 3.8068092468249063`*^9}, 
   3.8084342101670923`*^9, {3.808435024601173*^9, 
   3.80843502691894*^9}},ExpressionUUID->"d38f7d62-e082-45f2-bc4a-\
1b2c45283cd5"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"curvature", "[", 
   RowBox[{"spherical", "[", 
    RowBox[{
     RowBox[{"{", "curv_", "}"}], ",", "__"}], "]"}], "]"}], ":=", 
  "curv"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"radius", "[", 
   RowBox[{"spherical", "[", 
    RowBox[{
     RowBox[{"{", "curv_", "}"}], ",", "__"}], "]"}], "]"}], ":=", 
  RowBox[{"1.0", "/", "curv"}]}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.7969528759957848`*^9, 3.796952903851618*^9}, {
  3.796952980275592*^9, 3.796952997466626*^9}, {3.800132922959771*^9, 
  3.800132935244467*^9}, {3.800134651567333*^9, 3.800134652129681*^9}, {
  3.800134697793785*^9, 3.8001347066145287`*^9}},
 CellLabel->"In[83]:=",ExpressionUUID->"6aba6cde-c02c-46d8-86ed-058725e074af"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"quadraticShape", "[", 
   RowBox[{
    RowBox[{"curv_", "?", "NumericQ"}], ",", 
    RowBox[{"conic_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"N", "[", "#", "]"}], "===", "0.0"}], "&"}], ")"}]}]}], "]"}],
   ":=", 
  RowBox[{"sphericalShape", "[", "curv", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"quadraticShape", "[", 
   RowBox[{
    RowBox[{"curv_", "?", "NumericQ"}], ",", 
    RowBox[{"conic_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"N", "[", "#", "]"}], "===", "0.0"}], "&"}], ")"}]}], ",", 
    RowBox[{"dom", ":", 
     RowBox[{"{", 
      RowBox[{"_", ",", "_"}], "}"}]}]}], "]"}], ":=", 
  RowBox[{"sphericalShape", "[", 
   RowBox[{"curv", ",", "dom"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"quadraticShape", "[", 
   RowBox[{
    RowBox[{"curv_", "?", "NumericQ"}], ",", 
    RowBox[{"conic_", "?", "NumericQ"}]}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"dom", "=", 
      RowBox[{"quadraticImpicitDomain", "[", 
       RowBox[{"curv", ",", "conic"}], "]"}]}], "}"}], ",", 
    RowBox[{"quadratic", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"curv", ",", "conic"}], "}"}], ",", "dom", ",", "dom"}], 
     "]"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"quadraticShape", "[", 
   RowBox[{
    RowBox[{"curv_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"N", "[", "#", "]"}], "=!=", "0.0"}], "&"}], ")"}]}], ",", 
    RowBox[{"conic_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"N", "[", "#", "]"}], "=!=", "0.0"}], "&"}], ")"}]}], ",", 
    RowBox[{"dom", ":", 
     RowBox[{"{", 
      RowBox[{"_", ",", "_"}], "}"}]}]}], "]"}], ":=", 
  RowBox[{"quadratic", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"curv", ",", "conic"}], "}"}], ",", 
    RowBox[{"quadraticImpicitDomain", "[", 
     RowBox[{"curv", ",", "conic"}], "]"}], ",", "dom"}], "]"}]}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796877169503286*^9, 3.796877250191266*^9}, {
   3.796877289825718*^9, 3.796877341803919*^9}, {3.796877459314434*^9, 
   3.796877516578953*^9}, {3.796877591271963*^9, 3.7968776216918697`*^9}, {
   3.796877748359894*^9, 3.796877795691044*^9}, {3.796877831367427*^9, 
   3.796877860212453*^9}, {3.7968779293571663`*^9, 3.796877948416113*^9}, {
   3.796879897564604*^9, 3.79687999344204*^9}, 3.796880349978952*^9, {
   3.796880391018942*^9, 3.796880395239031*^9}, {3.796880514752489*^9, 
   3.796880527071312*^9}, {3.796880558438424*^9, 3.796880614624117*^9}, {
   3.7968806457862053`*^9, 3.796880655169403*^9}, {3.796880693410612*^9, 
   3.796880696964609*^9}, {3.7968833580035133`*^9, 3.79688337703966*^9}, 
   3.7969451019899683`*^9, {3.796945153869811*^9, 3.7969452078442287`*^9}, {
   3.79695281751539*^9, 3.796952819495062*^9}, {3.796953005173312*^9, 
   3.796953013622637*^9}, {3.796953573546941*^9, 3.796953576998888*^9}, 
   3.796953906908269*^9, {3.798402423661192*^9, 3.7984024314770937`*^9}, {
   3.800065721437642*^9, 3.800065859445539*^9}, {3.800066608554409*^9, 
   3.800066645310514*^9}, {3.800132993194942*^9, 3.8001330892963943`*^9}, {
   3.800133171875177*^9, 3.800133250515284*^9}, {3.800133297845883*^9, 
   3.8001333083540983`*^9}, {3.800134729565731*^9, 3.800134739150926*^9}},
 CellLabel->"In[85]:=",ExpressionUUID->"3538902b-7ad6-476b-9de8-2ce744b98608"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"curvature", "[", 
   RowBox[{"quadratic", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"curv_", ",", "_"}], "}"}], ",", "__"}], "]"}], "]"}], ":=", 
  "curv"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"radius", "[", 
   RowBox[{"quadratic", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"curv_", ",", "_"}], "}"}], ",", "__"}], "]"}], "]"}], ":=", 
  RowBox[{"1.0", "/", "curv"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"conicConstant", "[", 
   RowBox[{"quadratic", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"_", ",", "conic_"}], "}"}], ",", "___"}], "]"}], "]"}], ":=", 
  "conic"}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.7969529206023808`*^9, 3.796952947615641*^9}, {
  3.796953015331997*^9, 3.796953020958293*^9}, {3.7984024381282883`*^9, 
  3.798402446306809*^9}, {3.800066647212861*^9, 3.8000666474142714`*^9}, {
  3.8001333199758577`*^9, 3.8001333505202827`*^9}, {3.800134744348394*^9, 
  3.800134745406135*^9}, {3.8001407913736477`*^9, 3.800140813996296*^9}},
 CellLabel->"In[89]:=",ExpressionUUID->"eef9ff16-c323-45a2-bf5c-e2cd41f138f4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"parametricShape", "[", 
   RowBox[{"f_Function", ",", 
    RowBox[{"dom", ":", 
     RowBox[{"{", 
      RowBox[{"_", ",", "_"}], "}"}]}]}], "]"}], ":=", 
  RowBox[{"parametric", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"f", ",", 
      RowBox[{"Evaluate", "[", 
       RowBox[{
        RowBox[{"Derivative", "[", "1", "]"}], "[", "f", "]"}], "]"}]}], 
     "}"}], ",", "dom", ",", "dom"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"parametricShape", "[", "f_InterpolatingFunction", "]"}], ":=", 
  RowBox[{"parametric", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"f", ",", 
      RowBox[{"Evaluate", "[", 
       RowBox[{
        RowBox[{"Derivative", "[", "1", "]"}], "[", "f", "]"}], "]"}]}], 
     "}"}], ",", 
    RowBox[{"interpolationDomain", "[", "f", "]"}], ",", 
    RowBox[{"interpolationDomain", "[", "f", "]"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"parametricShape", "[", 
   RowBox[{"f_InterpolatingFunction", ",", 
    RowBox[{"dom", ":", 
     RowBox[{"{", 
      RowBox[{"_", ",", "_"}], "}"}]}]}], "]"}], ":=", 
  RowBox[{"parametric", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"f", ",", 
      RowBox[{"Evaluate", "[", 
       RowBox[{
        RowBox[{"Derivative", "[", "1", "]"}], "[", "f", "]"}], "]"}]}], 
     "}"}], ",", 
    RowBox[{"interpolationDomain", "[", "f", "]"}], ",", "dom"}], 
   "]"}]}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796877169503286*^9, 3.796877250191266*^9}, {
   3.796877289825718*^9, 3.796877341803919*^9}, {3.796877459314434*^9, 
   3.796877516578953*^9}, {3.796877591271963*^9, 3.7968776216918697`*^9}, {
   3.796877748359894*^9, 3.796877795691044*^9}, {3.796877831367427*^9, 
   3.796877860212453*^9}, {3.7968779293571663`*^9, 3.796877948416113*^9}, {
   3.796879897564604*^9, 3.79687999344204*^9}, 3.796880349978952*^9, {
   3.796880391018942*^9, 3.796880395239031*^9}, {3.796880514752489*^9, 
   3.796880527071312*^9}, {3.796880558438424*^9, 3.796880614624117*^9}, {
   3.7968806457862053`*^9, 3.796880655169403*^9}, {3.796880693410612*^9, 
   3.796880696964609*^9}, {3.7968833580035133`*^9, 3.79688337703966*^9}, 
   3.7969451019899683`*^9, {3.796945153869811*^9, 3.7969452078442287`*^9}, {
   3.79695281751539*^9, 3.796952819495062*^9}, {3.796953582501814*^9, 
   3.796953585122075*^9}, 3.796953911904488*^9, {3.7983477013318033`*^9, 
   3.7983477028619823`*^9}, {3.800133388256379*^9, 3.8001334330767403`*^9}, {
   3.800134752560223*^9, 3.800134803435253*^9}, {3.800515915898963*^9, 
   3.8005159498340893`*^9}},ExpressionUUID->"a66a2ea0-832a-4a2b-a38b-\
5c3b6a290bda"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"individualOffset", "[", 
   RowBox[{"parametric", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"f_", ",", "_"}], "}"}], ",", "___"}], "]"}], "]"}], ":=", 
  RowBox[{"f", "[", "0.0", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"individualOffset", "[", "_", "]"}], ":=", "0.0"}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796877169503286*^9, 3.796877250191266*^9}, {
   3.796877289825718*^9, 3.796877341803919*^9}, {3.796877459314434*^9, 
   3.796877516578953*^9}, {3.796877591271963*^9, 3.7968776216918697`*^9}, {
   3.796877748359894*^9, 3.796877795691044*^9}, {3.796877831367427*^9, 
   3.796877860212453*^9}, {3.7968779293571663`*^9, 3.796877948416113*^9}, {
   3.796879897564604*^9, 3.79687999344204*^9}, 3.796880349978952*^9, {
   3.796880391018942*^9, 3.796880395239031*^9}, {3.796880514752489*^9, 
   3.796880527071312*^9}, {3.796880558438424*^9, 3.796880614624117*^9}, {
   3.7968806457862053`*^9, 3.796880655169403*^9}, {3.796880693410612*^9, 
   3.796880696964609*^9}, {3.7968833580035133`*^9, 3.79688337703966*^9}, 
   3.7969451019899683`*^9, {3.796945153869811*^9, 3.7969452078442287`*^9}, {
   3.79695281751539*^9, 3.796952819495062*^9}, {3.796953582501814*^9, 
   3.796953585122075*^9}, 3.796953911904488*^9, {3.7983477013318033`*^9, 
   3.7983477028619823`*^9}, {3.800133388256379*^9, 3.8001334330767403`*^9}, {
   3.800134752560223*^9, 3.800134803435253*^9}, {3.800515915898963*^9, 
   3.8005159498340893`*^9}, {3.800515983465425*^9, 
   3.800516047594634*^9}},ExpressionUUID->"d76219df-4b01-4bbc-abc9-\
6c369999666c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"shapeFunction", "[", 
   RowBox[{"parametric", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"f_", ",", "_"}], "}"}], ",", "___"}], "]"}], "]"}], ":=", 
  "f"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"shapeDerivativeFunction", "[", 
   RowBox[{"parametric", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"_", ",", "df_"}], "}"}], ",", "__"}], "]"}], "]"}], ":=", 
  "df"}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796952961377417*^9, 3.796952969283547*^9}, {
  3.79695303279359*^9, 3.796953076253558*^9}, {3.8000666550546513`*^9, 
  3.800066684596716*^9}, {3.800133436418144*^9, 3.800133479845512*^9}, {
  3.8001348074181967`*^9, 3.800134828951811*^9}},
 CellLabel->"In[95]:=",ExpressionUUID->"ee0442f9-9c72-4376-bc3b-03720857a7dc"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"shapeQ", "[", "spherical", "]"}], ":=", 
  "True"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"shapeQ", "[", "quadratic", "]"}], ":=", 
  "True"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"shapeQ", "[", "plane", "]"}], ":=", 
  "True"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"shapeQ", "[", "perfectThinLens", "]"}], ":=", 
  "True"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"shapeQ", "[", "parametric", "]"}], ":=", 
  "True"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"shapeQ", "[", 
   RowBox[{"spherical", "[", "___", "]"}], "]"}], ":=", 
  "True"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"shapeQ", "[", 
   RowBox[{"quadratic", "[", "___", "]"}], "]"}], ":=", 
  "True"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"shapeQ", "[", 
   RowBox[{"plane", "[", "___", "]"}], "]"}], ":=", 
  "True"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"shapeQ", "[", 
   RowBox[{"perfectThinLens", "[", "___", "]"}], "]"}], ":=", 
  "True"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"shapeQ", "[", 
   RowBox[{"parametric", "[", "___", "]"}], "]"}], ":=", 
  "True"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"shapeQ", "[", "_", "]"}], ":=", "False"}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796535766686433*^9, 3.7965357702522383`*^9}, {
  3.7965358038233557`*^9, 3.796535933237008*^9}, {3.796770370842196*^9, 
  3.7967703746087627`*^9}, {3.7967705364499407`*^9, 3.7967705448417997`*^9}, {
  3.796952737333377*^9, 3.796952744860147*^9}, {3.798435183675696*^9, 
  3.798435189446032*^9}, {3.80013824726192*^9, 3.800138257270609*^9}, {
  3.800152462573307*^9, 3.800152475293991*^9}},
 CellLabel->"In[97]:=",ExpressionUUID->"c38adddb-ab19-414d-b6e5-1305944fd27a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"shapeFunctionToDraw", "[", "s_plane", "]"}], "[", "h_", "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{"0", ",", "h"}], "}"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"shapeFunctionToDraw", "[", "s_perfectThinLens", "]"}], "[", "h_", 
   "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{"0", ",", "h"}], "}"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"shapeFunctionToDraw", "[", "s_spherical", "]"}], "[", "h_", "]"}],
   ":=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"curvature", "[", "s", "]"}], "*", 
       RowBox[{"h", "^", "2"}]}], ")"}], "/", 
     RowBox[{"(", 
      RowBox[{"1", "+", 
       RowBox[{"Sqrt", "[", 
        RowBox[{"1", "-", 
         RowBox[{
          RowBox[{
           RowBox[{"curvature", "[", "s", "]"}], "^", "2"}], "*", 
          RowBox[{"h", "^", "2"}]}]}], "]"}]}], ")"}]}], ",", "h"}], 
   "}"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"shapeFunctionToDraw", "[", "s_quadratic", "]"}], "[", "h_", "]"}],
   ":=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"curvature", "[", "s", "]"}], "*", 
       RowBox[{"h", "^", "2"}]}], ")"}], "/", 
     RowBox[{"(", 
      RowBox[{"1", "+", 
       RowBox[{"Sqrt", "[", 
        RowBox[{"1", "-", 
         RowBox[{
          RowBox[{
           RowBox[{"curvature", "[", "s", "]"}], "^", "2"}], "*", 
          RowBox[{"h", "^", "2"}], "*", 
          RowBox[{"(", 
           RowBox[{"1", "+", 
            RowBox[{"conicConstant", "[", "s", "]"}]}], ")"}]}]}], "]"}]}], 
      ")"}]}], ",", "h"}], "}"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"shapeFunctionToDraw", "[", "s_parametric", "]"}], "[", "h_", 
   "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{
     RowBox[{"shapeFunction", "[", "s", "]"}], "[", "h", "]"}], ",", "h"}], 
   "}"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.797801579573367*^9, 3.797801596367785*^9}, {
   3.797801695700436*^9, 3.797801730450405*^9}, {3.7978017784675503`*^9, 
   3.797801966067807*^9}, 3.798402449638255*^9, {3.798434811893723*^9, 
   3.798434822434772*^9}},
 CellLabel->
  "In[108]:=",ExpressionUUID->"94dabc3c-f60a-49c5-891a-78868e5fefa7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"marginalPosition", "[", 
   RowBox[{"s_", "?", "shapeQ"}], "]"}], ":=", 
  RowBox[{"Map", "[", 
   RowBox[{
    RowBox[{"shapeFunctionToDraw", "[", "s", "]"}], ",", 
    RowBox[{"domain", "[", "s", "]"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.800142527214327*^9, 3.800142558232266*^9}, {
  3.800142621233823*^9, 3.800142636489025*^9}},
 CellLabel->
  "In[113]:=",ExpressionUUID->"99c36184-dc47-4b0f-9b56-6630980df05f"]
}, Open  ]],

Cell[CellGroupData[{

Cell["normalVector", "Subsection",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796953133343335*^9, 
  3.7969531401664677`*^9}},ExpressionUUID->"18bd7eea-e157-43bd-b4db-\
a69276fee8b7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Protect", "[", "noNormalVector", "]"}], ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796951556649659*^9, 3.796951570048418*^9}},
 CellLabel->
  "In[114]:=",ExpressionUUID->"0ba624f1-4daa-469b-a452-e9ee90b9c008"],

Cell[BoxData[
 RowBox[{
  RowBox[{"normalVector", "[", 
   RowBox[{
    RowBox[{"plane", "[", "__", "]"}], ",", "_"}], "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{"0.0", ",", "1.0"}], "}"}]}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796882700925036*^9, 3.7968827657801113`*^9}, {
   3.796882795854*^9, 3.796882864571574*^9}, {3.796882921500057*^9, 
   3.796882982329913*^9}, {3.796883043542914*^9, 3.796883285955927*^9}, {
   3.796883341432807*^9, 3.7968833418814297`*^9}, {3.796949677491233*^9, 
   3.796949685950142*^9}, {3.796949766426108*^9, 3.7969498476869917`*^9}, {
   3.796951574605652*^9, 3.79695158073552*^9}, 3.797020780010846*^9, {
   3.798429335885247*^9, 3.7984293740678167`*^9}},
 CellLabel->
  "In[115]:=",ExpressionUUID->"40f8667c-7b1d-46fb-90cc-5b69d3cef9d8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"\.10normalVector", "[", 
   RowBox[{
    RowBox[{"perfectThinLens", "[", "__", "]"}], ",", "_"}], "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{"0.0", ",", "1.0"}], "}"}]}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796882700925036*^9, 3.7968827657801113`*^9}, {
   3.796882795854*^9, 3.796882864571574*^9}, {3.796882921500057*^9, 
   3.796882982329913*^9}, {3.796883043542914*^9, 3.796883285955927*^9}, {
   3.796883341432807*^9, 3.7968833418814297`*^9}, {3.796949677491233*^9, 
   3.796949685950142*^9}, {3.796949766426108*^9, 3.7969498476869917`*^9}, {
   3.796951574605652*^9, 3.79695158073552*^9}, 3.797020780010846*^9, {
   3.798429335885247*^9, 3.7984293740678167`*^9}},
 CellLabel->
  "In[116]:=",ExpressionUUID->"24bfe539-fbf2-4e77-b911-48f28eeb729d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"normalVector", "[", 
   RowBox[{"s_spherical", ",", "h_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"crv", ",", "v", ",", "sq"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"crv", "=", 
       RowBox[{"curvature", "[", "s", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"v", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"-", "h"}], "*", 
          RowBox[{
           RowBox[{"Sqrt", "[", 
            RowBox[{"1.0", "-", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"crv", "*", "h"}], ")"}], "^", "2"}]}], "]"}], "/", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"1.0", "/", "crv"}], "-", 
             RowBox[{"crv", "*", 
              RowBox[{"h", "^", "2"}]}]}], ")"}]}]}], ",", "1.0"}], "}"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"sq", "=", 
       RowBox[{"v", ".", "v"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"v", "/", 
       RowBox[{"Sqrt", "[", "sq", "]"}]}]}]}], "\[IndentingNewLine]", "]"}], "/;", 
   RowBox[{
    RowBox[{"insideImplicitDomain", "[", "s", "]"}], "[", "h", 
    "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"normalVector", "[", 
   RowBox[{"s_spherical", ",", "h_"}], "]"}], ":=", 
  RowBox[{"noNormalVector", "/;", 
   RowBox[{"(", 
    RowBox[{"!", " ", 
     RowBox[{
      RowBox[{"insideImplicitDomain", "[", "s", "]"}], "[", "h", "]"}]}], 
    ")"}]}]}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796882700925036*^9, 3.7968827657801113`*^9}, {
   3.796882795854*^9, 3.796882864571574*^9}, {3.796882921500057*^9, 
   3.796882982329913*^9}, {3.796883043542914*^9, 3.796883285955927*^9}, {
   3.796883341432807*^9, 3.7968833418814297`*^9}, {3.796949677491233*^9, 
   3.796949685950142*^9}, {3.796949766426108*^9, 3.7969498476869917`*^9}, {
   3.796951574605652*^9, 3.79695158073552*^9}, 3.797020780010846*^9, {
   3.798402453204362*^9, 3.798402458491733*^9}, {3.8001351776032763`*^9, 
   3.800135188627534*^9}, {3.800135229297729*^9, 3.800135282569265*^9}, {
   3.800135332306044*^9, 3.8001355329253387`*^9}, {3.800135575473065*^9, 
   3.800135604083502*^9}, {3.800135784811504*^9, 3.8001357849911833`*^9}, {
   3.800136060604*^9, 3.800136072630374*^9}},
 CellLabel->
  "In[117]:=",ExpressionUUID->"f2d7dd3e-4f11-4347-98bd-ec4e88b5c3ae"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"normalVector", "[", 
   RowBox[{"q_quadratic", ",", "h_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"crv", ",", "con", ",", "v", ",", "sq"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"crv", "=", 
       RowBox[{"curvature", "[", "q", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"con", "=", 
       RowBox[{"conicConstant", "[", "q", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"v", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"-", "h"}], "*", 
          RowBox[{
           RowBox[{"Sqrt", "[", 
            RowBox[{"1.0", "-", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"1.0", "+", "con"}], ")"}], 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"crv", "*", "h"}], ")"}], "^", "2"}]}]}], "]"}], "/", 
           
           RowBox[{"(", 
            RowBox[{
             RowBox[{"1.0", "/", "crv"}], "-", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"1.0", "+", "con"}], ")"}], "*", "crv", "*", 
              RowBox[{"h", "^", "2"}]}]}], ")"}]}]}], ",", "1.0"}], "}"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"sq", "=", 
       RowBox[{"v", ".", "v"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"v", "/", 
       RowBox[{"Sqrt", "[", "sq", "]"}]}]}]}], "\[IndentingNewLine]", "]"}], "/;", 
   RowBox[{
    RowBox[{"insideImplicitDomain", "[", "q", "]"}], "[", "h", 
    "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"normalVector", "[", 
   RowBox[{"q_quadratic", ",", "h_"}], "]"}], ":=", 
  RowBox[{"noNormalVector", "/;", 
   RowBox[{"(", 
    RowBox[{"!", " ", 
     RowBox[{
      RowBox[{"insideImplicitDomain", "[", "q", "]"}], "[", "h", "]"}]}], 
    ")"}]}]}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796882700925036*^9, 3.7968827657801113`*^9}, {
   3.796882795854*^9, 3.796882864571574*^9}, {3.796882921500057*^9, 
   3.796882982329913*^9}, {3.796883043542914*^9, 3.796883285955927*^9}, {
   3.796883341432807*^9, 3.7968833418814297`*^9}, {3.796949677491233*^9, 
   3.796949685950142*^9}, {3.796949766426108*^9, 3.7969498476869917`*^9}, {
   3.796951574605652*^9, 3.79695158073552*^9}, 3.797020780010846*^9, {
   3.798402453204362*^9, 3.798402458491733*^9}, {3.8001351776032763`*^9, 
   3.800135188627534*^9}, {3.800135229297729*^9, 3.800135282569265*^9}, {
   3.800135332306044*^9, 3.800135565034026*^9}, {3.800135615907649*^9, 
   3.800135704538638*^9}, {3.800136078221705*^9, 3.800136087189021*^9}},
 CellLabel->
  "In[119]:=",ExpressionUUID->"c7d03e22-8bb4-4e27-b76f-2ad2e2c01e03"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"normalVector", "[", 
   RowBox[{"p_parametric", ",", "h_"}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"v", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", 
          RowBox[{
           RowBox[{"shapeDerivativeFunction", "[", "p", "]"}], "[", "h", 
           "]"}]}], ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"v", "/", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"v", ".", "v"}], "]"}]}]}], "]"}], "/;", 
   RowBox[{
    RowBox[{"insideImplicitDomain", "[", "p", "]"}], "[", "h", 
    "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"normalVector", "[", 
   RowBox[{"p_parametric", ",", "h_"}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"noNormalVector", "/;", 
   RowBox[{"(", 
    RowBox[{"!", 
     RowBox[{
      RowBox[{"insideImplicitDomain", "[", "p", "]"}], "[", "h", "]"}]}], 
    ")"}]}]}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796882700925036*^9, 3.7968827657801113`*^9}, {
   3.796882795854*^9, 3.796882864571574*^9}, {3.796882921500057*^9, 
   3.796882982329913*^9}, {3.796883043542914*^9, 3.796883285955927*^9}, {
   3.796883341432807*^9, 3.7968833418814297`*^9}, {3.796949677491233*^9, 
   3.796949685950142*^9}, {3.796949766426108*^9, 3.7969498476869917`*^9}, {
   3.796951574605652*^9, 3.79695158073552*^9}, 3.797020780010846*^9, {
   3.798402453204362*^9, 3.798402458491733*^9}, {3.8001351776032763`*^9, 
   3.800135188627534*^9}, {3.800135229297729*^9, 3.800135282569265*^9}, {
   3.800135332306044*^9, 3.800135565034026*^9}, {3.800135615907649*^9, 
   3.800135679506571*^9}, {3.800135722134942*^9, 3.8001358102256317`*^9}, {
   3.800136093893697*^9, 3.800136102309133*^9}},
 CellLabel->
  "In[121]:=",ExpressionUUID->"6b268ef5-5e52-41a9-81ec-f06f66eee47f"]
}, Open  ]],

Cell[CellGroupData[{

Cell["reflectedVector", "Subsection",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796953162939392*^9, 
  3.796953168574336*^9}},ExpressionUUID->"cdf9e1a4-bbc9-4ae0-bc09-\
4d1355af72fa"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Protect", "[", "totalReflection", "]"}], ";"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796951592134096*^9, 3.7969516222289057`*^9}},
 CellLabel->
  "In[123]:=",ExpressionUUID->"55ed7401-4262-4825-9b43-40b96d5e0914"],

Cell[BoxData[
 RowBox[{
  RowBox[{"reflectedVector", "[", 
   RowBox[{
    RowBox[{"plane", "[", "__", "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"iind_", ",", "oind_"}], "}"}], ",", "h_", ",", 
    RowBox[{"r", ":", 
     RowBox[{"{", 
      RowBox[{"ry_", ",", "rz_"}], "}"}]}]}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"sq", "=", 
      RowBox[{
       RowBox[{"oind", "^", "2"}], "-", 
       RowBox[{"iind", "^", "2"}], "+", 
       RowBox[{"rz", "^", "2"}]}]}], "}"}], ",", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"sq", "<", "0.0"}], ",", "$Failed", ",", 
      RowBox[{"{", 
       RowBox[{"ry", ",", 
        RowBox[{"Sqrt", "[", "sq", "]"}]}], "}"}]}], "]"}]}], 
   "]"}]}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796950568222487*^9, 3.796950648693183*^9}, {
   3.79695077996415*^9, 3.796950784508752*^9}, {3.796950870474677*^9, 
   3.7969509574843807`*^9}, {3.796950989739541*^9, 3.7969510430203333`*^9}, {
   3.796951074130281*^9, 3.796951130347267*^9}, {3.7969511603534184`*^9, 
   3.796951411079836*^9}, {3.7969516254459133`*^9, 3.7969516718645144`*^9}, {
   3.796961109588644*^9, 3.7969611122639647`*^9}, 3.796963231305654*^9, {
   3.797020387708414*^9, 3.797020388898448*^9}, 3.797020694360326*^9, {
   3.798429393161351*^9, 3.798429417742017*^9}},
 CellLabel->
  "In[124]:=",ExpressionUUID->"001077e6-850e-481b-908c-9b47064fb687"],

Cell[BoxData[
 RowBox[{
  RowBox[{"reflectedVector", "[", 
   RowBox[{
    RowBox[{"perfectThinLens", "[", 
     RowBox[{
      RowBox[{"{", "f_", "}"}], ",", "__"}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"iind_", ",", "oind_"}], "}"}], ",", "h_", ",", 
    RowBox[{"r", ":", 
     RowBox[{"{", 
      RowBox[{"ry_", ",", "rz_"}], "}"}]}]}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"sq", "=", 
      RowBox[{
       RowBox[{"Sqrt", "[", 
        RowBox[{
         RowBox[{"f", "^", "2"}], "+", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"h", "-", 
            RowBox[{"f", "*", "ry"}]}], ")"}], "^", "2"}]}], "]"}], 
       RowBox[{"oind", "/", "iind"}]}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"f", "*", "ry"}], "-", "h"}], ")"}], "/", "sq"}], ",", 
      RowBox[{"f", "/", "sq"}]}], "}"}]}], "]"}]}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796950568222487*^9, 3.796950648693183*^9}, {
   3.79695077996415*^9, 3.796950784508752*^9}, {3.796950870474677*^9, 
   3.7969509574843807`*^9}, {3.796950989739541*^9, 3.7969510430203333`*^9}, {
   3.796951074130281*^9, 3.796951130347267*^9}, {3.7969511603534184`*^9, 
   3.796951411079836*^9}, {3.7969516254459133`*^9, 3.7969516718645144`*^9}, {
   3.796961109588644*^9, 3.7969611122639647`*^9}, 3.796963231305654*^9, {
   3.797020387708414*^9, 3.797020388898448*^9}, 3.797020694360326*^9, {
   3.798429393161351*^9, 3.7984294548011703`*^9}, 3.798429575608852*^9, {
   3.7984296263143053`*^9, 3.798429648454459*^9}, {3.7984310241144238`*^9, 
   3.798431093987302*^9}, {3.798431160141735*^9, 3.798431164381825*^9}, {
   3.7984317185794573`*^9, 3.798431718870476*^9}, 3.7984318120364637`*^9, {
   3.798431917938806*^9, 3.7984319263632812`*^9}, {3.798432197746101*^9, 
   3.798432199432518*^9}, 3.7984341658963823`*^9, {3.7984347388330173`*^9, 
   3.79843474327592*^9}, {3.800135825212173*^9, 3.80013582750642*^9}},
 CellLabel->
  "In[125]:=",ExpressionUUID->"a02c4a82-f922-4d17-ad6b-beb0ad8a9bb8"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"reflectedVector", "[", 
   RowBox[{
    RowBox[{"s_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"MemberQ", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"spherical", ",", "quadratic", ",", "parametric"}], "}"}], 
         ",", 
         RowBox[{"Head", "[", "#", "]"}]}], "]"}], "&"}], ")"}]}], ",", 
    RowBox[{"{", 
     RowBox[{"iind_", ",", "oind_"}], "}"}], ",", "h_", ",", 
    RowBox[{"r", ":", 
     RowBox[{"{", 
      RowBox[{"_", ",", "_"}], "}"}]}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"v", ",", "sq", ",", "com", ",", "iprod"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"v", "=", 
      RowBox[{"normalVector", "[", 
       RowBox[{"s", ",", "h"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"v", "===", "noNormalVector"}], ",", 
       RowBox[{"Return", "[", "noNormalVector", "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"iprod", "=", 
      RowBox[{"r", ".", "v"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"sq", "=", 
      RowBox[{
       RowBox[{"oind", "^", "2"}], "-", 
       RowBox[{"iind", "^", "2"}], "+", 
       RowBox[{"iprod", "^", "2"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"sq", "<", "0.0"}], ",", 
       RowBox[{"Return", "[", "totalReflection", "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"com", "=", 
      RowBox[{
       RowBox[{"Sqrt", "[", "sq", "]"}], "-", "iprod"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"r", "+", 
      RowBox[{"v", "*", "com"}]}]}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"reflectedVector", "[", 
     RowBox[{"q_quadratic", ",", 
      RowBox[{"{", 
       RowBox[{"iind_", ",", "oind_"}], "}"}], ",", "h_", ",", 
      RowBox[{"r", ":", 
       RowBox[{"{", 
        RowBox[{"_", ",", "_"}], "}"}]}]}], "]"}], ":=", 
    RowBox[{
     RowBox[{
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"v", ",", "sq", ",", "com", ",", "iprod"}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"v", "=", 
          RowBox[{"normalVector", "[", 
           RowBox[{"q", ",", "h"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"v", "===", "noNormalVector"}], ",", 
           RowBox[{"Return", "[", "noNormalVector", "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"iprod", "=", 
          RowBox[{"r", ".", "v"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"sq", "=", 
          RowBox[{
           RowBox[{"oind", "^", "2"}], "-", 
           RowBox[{"iind", "^", "2"}], "+", 
           RowBox[{"iprod", "^", "2"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"sq", "<", "0.0"}], ",", 
           RowBox[{"Return", "[", "totalReflection", "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"com", "=", 
          RowBox[{
           RowBox[{"Sqrt", "[", "sq", "]"}], "-", "iprod"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"r", "+", 
          RowBox[{"v", "*", "com"}]}]}]}], "\[IndentingNewLine]", "]"}], 
      "\[IndentingNewLine]", 
      RowBox[{"reflectedVector", "[", 
       RowBox[{"p_parametric", ",", 
        RowBox[{"{", 
         RowBox[{"iind_", ",", "oind_"}], "}"}], ",", "h_", ",", 
        RowBox[{"r", ":", 
         RowBox[{"{", 
          RowBox[{"_", ",", "_"}], "}"}]}]}], "]"}]}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"v", ",", "sq", ",", "com", ",", "iprod"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"v", "=", 
         RowBox[{"normalVector", "[", 
          RowBox[{"p", ",", "h"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"v", "===", "noNormalVector"}], ",", 
          RowBox[{"Return", "[", "noNormalVector", "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"iprod", "=", 
         RowBox[{"r", ".", "v"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"sq", "=", 
         RowBox[{
          RowBox[{"oind", "^", "2"}], "-", 
          RowBox[{"iind", "^", "2"}], "+", 
          RowBox[{"iprod", "^", "2"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"sq", "<", "0.0"}], ",", 
          RowBox[{"Return", "[", "totalReflection", "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"com", "=", 
         RowBox[{
          RowBox[{"Sqrt", "[", "sq", "]"}], "-", "iprod"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"r", "+", 
         RowBox[{"v", "*", "com"}]}]}]}], "\[IndentingNewLine]", "]"}]}]}], 
   "*)"}]}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796950568222487*^9, 3.796950648693183*^9}, {
   3.79695077996415*^9, 3.796950784508752*^9}, {3.796950870474677*^9, 
   3.7969509574843807`*^9}, {3.796950989739541*^9, 3.7969510430203333`*^9}, {
   3.796951074130281*^9, 3.796951130347267*^9}, {3.7969511603534184`*^9, 
   3.796951411079836*^9}, {3.7969516254459133`*^9, 3.7969516718645144`*^9}, {
   3.796961109588644*^9, 3.7969611122639647`*^9}, 3.796963231305654*^9, {
   3.797020387708414*^9, 3.797020388898448*^9}, 3.797020694360326*^9, {
   3.797021020772375*^9, 3.7970210292315273`*^9}, 3.797021173687891*^9, 
   3.797021290163611*^9, {3.79702183865359*^9, 3.797021844154347*^9}, {
   3.797021925226881*^9, 3.797021945622726*^9}, {3.797044948201213*^9, 
   3.797045033611269*^9}, {3.800136216413598*^9, 3.800136262425675*^9}, {
   3.8001386792090816`*^9, 3.8001386811861258`*^9}, {3.80013871588619*^9, 
   3.800138716592856*^9}, 3.80015287744501*^9},
 CellLabel->
  "In[126]:=",ExpressionUUID->"20e96ea9-a574-4e58-9412-fac169492627"]
}, Closed]],

Cell[CellGroupData[{

Cell["intersection", "Subsection",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796953188287322*^9, 
  3.7969531935955467`*^9}},ExpressionUUID->"827b80d6-d4a2-4625-8ae8-\
d5f2cf890e0e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Protect", "[", "noIntersection", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"intersection", "[", 
   RowBox[{
    RowBox[{"plane", "[", "__", "]"}], ",", 
    RowBox[{"ray", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"yg_", ",", "zg_"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"yd_", ",", "zd_"}], "}"}], ",", "opt___"}], "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "t", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"N", "[", "zd", "]"}], "===", "0.0"}], ",", 
       RowBox[{"Return", "[", "noIntersection", "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"yg", "-", 
        RowBox[{"yd", "*", 
         RowBox[{"zg", "/", "zd"}]}]}], ",", "0.0"}], "}"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796878466906435*^9, 3.7968785336299467`*^9}, {
   3.796878583649637*^9, 3.796878660815896*^9}, {3.79688040934692*^9, 
   3.796880469311411*^9}, {3.796960573661688*^9, 3.7969605767645903`*^9}, {
   3.798429660313058*^9, 3.79842968743722*^9}, {3.798429750382882*^9, 
   3.798429755995872*^9}, 3.800141150025877*^9, {3.800157029566989*^9, 
   3.800157029744823*^9}},
 CellLabel->
  "In[273]:=",ExpressionUUID->"26da69f1-9626-42f0-9e13-8eb3fc677782"],

Cell[BoxData[
 RowBox[{
  RowBox[{"intersection", "[", 
   RowBox[{
    RowBox[{"perfectThinLens", "[", "__", "]"}], ",", 
    RowBox[{"ray", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"yg_", ",", "zg_"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"yd_", ",", "zd_"}], "}"}], ",", "opt___"}], "]"}]}], "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"yg", "-", 
     RowBox[{"zg", "*", "yd"}]}], ",", "0.0"}], "}"}]}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796878466906435*^9, 3.7968785336299467`*^9}, {
   3.796878583649637*^9, 3.796878660815896*^9}, {3.79688040934692*^9, 
   3.796880469311411*^9}, {3.796960573661688*^9, 3.7969605767645903`*^9}, {
   3.798429660313058*^9, 3.79842968743722*^9}, {3.798429750382882*^9, 
   3.798429755995872*^9}, 3.79843037441835*^9, 3.7984344931221113`*^9},
 CellLabel->
  "In[275]:=",ExpressionUUID->"ab8d125b-b8bc-4254-beaf-b86989a1defb"],

Cell[BoxData[
 RowBox[{
  RowBox[{"intersection", "[", 
   RowBox[{"s_spherical", ",", 
    RowBox[{"ray", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"yg_", ",", "zg_"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"yd_", ",", "zd_"}], "}"}], ",", "opt___"}], "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"crv", ",", "isq", ",", "a", ",", "pos"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"crv", "=", 
      RowBox[{"curvature", "[", "s", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"isq", "=", 
      RowBox[{
       RowBox[{"zd", "^", "2"}], "-", 
       RowBox[{
        RowBox[{"crv", "^", "2"}], "*", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"yg", "*", "zd"}], "-", 
           RowBox[{"yd", "*", "zg"}]}], ")"}], "^", "2"}]}], "+", 
       RowBox[{"2", "*", "crv", "*", "yd", "*", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"-", 
           RowBox[{"(", 
            RowBox[{"yg", "*", "zd"}], ")"}]}], "+", 
          RowBox[{"yd", "*", "zg"}]}], ")"}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"isq", "<", "0.0"}], ",", 
       RowBox[{"Return", "[", "noIntersection", "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"a", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"zd", "-", 
         RowBox[{"crv", "*", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"yd", "*", "yg"}], "+", 
            RowBox[{"zd", "*", "zg"}]}], ")"}]}], "-", 
         RowBox[{"Sqrt", "[", "isq", "]"}]}], ")"}], "/", 
       RowBox[{"(", 
        RowBox[{"crv", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"yd", "^", "2"}], "+", 
           RowBox[{"zd", "^", "2"}]}], ")"}]}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"pos", "=", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"yg", ",", "zg"}], "}"}], "+", 
       RowBox[{"a", 
        RowBox[{"{", 
         RowBox[{"yd", ",", "zd"}], "}"}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"insideImplicitDomain", "[", "s", "]"}], "[", 
        RowBox[{"pos", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", "pos", ",", 
       "noIntersection"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",\

 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.7968786815166283`*^9, 3.7968786930262547`*^9}, {
  3.796879241576441*^9, 3.796879265966501*^9}, {3.796879645895056*^9, 
  3.7968798518108997`*^9}, {3.7969605825937233`*^9, 3.796960589714694*^9}, {
  3.796963449833935*^9, 3.7969634511810217`*^9}, {3.800136295559957*^9, 
  3.800136350303926*^9}},
 CellLabel->
  "In[276]:=",ExpressionUUID->"abb8510d-98da-430f-97fd-56d0743095e5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"intersection", "[", 
   RowBox[{"q_quadratic", ",", 
    RowBox[{"ray", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"yg_", ",", "zg_"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"yd_", ",", "zd_"}], "}"}], ",", "opt___"}], "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"crv", ",", "con", ",", "isq", ",", "a", ",", "pos"}], "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"crv", "=", 
      RowBox[{"curvature", "[", "q", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"con", "=", 
      RowBox[{"conicConstant", "[", "q", "]"}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"isq", "=", 
      RowBox[{
       RowBox[{"zd", "^", "2"}], "-", 
       RowBox[{
        RowBox[{"crv", "^", "2"}], "*", 
        RowBox[{"(", 
         RowBox[{"1", "+", "con"}], ")"}], "*", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"yg", "*", "zd"}], "-", 
           RowBox[{"yd", "*", "zg"}]}], ")"}], "^", "2"}]}], "+", 
       RowBox[{"2", "*", "crv", "*", "yd", "*", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"-", 
           RowBox[{"(", 
            RowBox[{"yg", "*", "zd"}], ")"}]}], "+", 
          RowBox[{"yd", "*", "zg"}]}], ")"}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"isq", "<", "0.0"}], ",", 
       RowBox[{"Return", "[", "noIntersection", "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"a", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"zd", "-", 
         RowBox[{"crv", "*", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"yd", "*", "yg"}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "+", "con"}], ")"}], "*", "zd", "*", "zg"}]}], 
           ")"}]}], "-", 
         RowBox[{"Sqrt", "[", "isq", "]"}]}], ")"}], "/", 
       RowBox[{"(", 
        RowBox[{"crv", "*", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"yd", "^", "2"}], "+", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"1", "+", "con"}], ")"}], "*", 
            RowBox[{"zd", "^", "2"}]}]}], ")"}]}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"pos", "=", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"yg", ",", "zg"}], "}"}], "+", 
       RowBox[{"a", 
        RowBox[{"{", 
         RowBox[{"yd", ",", "zd"}], "}"}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"insideImplicitDomain", "[", "q", "]"}], "[", 
        RowBox[{"pos", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", "pos", ",", 
       "noIntersection"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",\

 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796880009383465*^9, 3.796880018373248*^9}, {
   3.796880177839019*^9, 3.796880214715835*^9}, {3.79696059302379*^9, 
   3.796960597072277*^9}, {3.797021696018186*^9, 3.79702170463409*^9}, {
   3.7984024621367598`*^9, 3.798402470235581*^9}, {3.800136358585064*^9, 
   3.800136403068078*^9}, 3.8001385649374447`*^9},
 CellLabel->
  "In[277]:=",ExpressionUUID->"38965917-5080-4013-8eb1-7fbe12610b3a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"heightInDomain", "[", 
   RowBox[{"height_", ",", 
    RowBox[{"dom", ":", 
     RowBox[{"{", 
      RowBox[{"_", ",", "_"}], "}"}]}]}], "]"}], ":=", 
  RowBox[{"height", "/;", 
   RowBox[{
    RowBox[{"Between", "[", "dom", "]"}], "[", "height", 
    "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"heightInDomain", "[", 
   RowBox[{"height_", ",", 
    RowBox[{"{", 
     RowBox[{"hmin_", ",", "hmax_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"hmin", "/;", 
   RowBox[{"height", "<", "hmin"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"heightInDomain", "[", 
   RowBox[{"height_", ",", 
    RowBox[{"{", 
     RowBox[{"hmin_", ",", "hmax_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"hmax", "/;", 
   RowBox[{"hmax", "<", "height"}]}]}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.7968807304338827`*^9, 3.796880758853324*^9}, {
  3.7968810791522512`*^9, 3.796881104560596*^9}, {3.796881197933489*^9, 
  3.796881335018581*^9}},
 CellLabel->
  "In[278]:=",ExpressionUUID->"da2c1d62-f5ef-432a-a232-b7365a4846b8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"intersection", "[", 
   RowBox[{"p_parametric", ",", 
    RowBox[{"ray", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"yg_", ",", "zg_"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"yd_", ",", "zd_"}], "}"}], ",", "opt___"}], "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"f", ",", "y", ",", "ini", ",", "hsol"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"ini", "=", 
      RowBox[{"heightInDomain", "[", 
       RowBox[{
        RowBox[{"yg", "-", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"yd", "*", "zg"}], ")"}], "/", "zd"}]}], ",", 
        RowBox[{"implicitDomain", "[", "p", "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"shapeFunction", "[", "p", "]"}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"hsol", "=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"N", "[", "yd", "]"}], "===", "0.0"}], ",", "yg", ",", 
        "\[IndentingNewLine]", 
        RowBox[{"y", "/.", 
         RowBox[{"FindRoot", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"f", "[", "y", "]"}], "\[Equal]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"y", " ", "zd"}], "-", 
               RowBox[{"yg", "*", "zd"}], "+", 
               RowBox[{"yd", "*", "zg"}]}], ")"}], "/", "yd"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"y", ",", "ini"}], "}"}]}], "]"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"insideImplicitDomain", "[", "p", "]"}], "[", "hsol", "]"}], 
       ",", 
       RowBox[{"{", 
        RowBox[{"hsol", ",", 
         RowBox[{"f", "[", "hsol", "]"}]}], "}"}], ",", "noIntersection"}], 
      "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.7968807304338827`*^9, 3.796880758853324*^9}, {
   3.7968810791522512`*^9, 3.796881104560596*^9}, {3.796881197933489*^9, 
   3.796881361390875*^9}, {3.796881642259029*^9, 3.79688172952765*^9}, {
   3.796881790978628*^9, 3.796881800315844*^9}, {3.796881860709216*^9, 
   3.796881937727541*^9}, {3.796881993340763*^9, 3.7968820067725153`*^9}, 
   3.796882165550249*^9, {3.796960601325877*^9, 3.7969606044189034`*^9}, {
   3.797021506752614*^9, 3.797021539040604*^9}, {3.7970215829165487`*^9, 
   3.79702161441693*^9}, {3.797021651049049*^9, 3.797021670209876*^9}, {
   3.797024759608643*^9, 3.797024759775339*^9}, {3.797026779013144*^9, 
   3.797026808565876*^9}, 3.7970270669397907`*^9, {3.800136421542609*^9, 
   3.800136422227553*^9}, {3.80013645971362*^9, 3.800136516450321*^9}, {
   3.800156219073226*^9, 3.8001562355424747`*^9}, {3.800156581324768*^9, 
   3.8001566127601843`*^9}, {3.800156643552354*^9, 3.8001566465422783`*^9}, 
   3.8001567198986673`*^9},
 CellLabel->
  "In[281]:=",ExpressionUUID->"3ff47b13-4417-4ec1-8447-9af4290da74a"]
}, Closed]],

Cell[CellGroupData[{

Cell["surface", "Subsection",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796953217674849*^9, 
  3.796953221068666*^9}},ExpressionUUID->"8f69ebda-f290-4106-b4e7-\
983f56162377"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"surfaceQ", "[", "_", "]"}], ":=", "False"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "createSurface", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"surfaceComment", "\[Rule]", "\"\<\>\""}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"createSurface", "[", 
   RowBox[{
    RowBox[{"surfaceSymbol_", "?", "canBeObjectSymbol"}], ",", 
    "surfaceShape_", ",", 
    RowBox[{"position", ":", 
     RowBox[{"{", 
      RowBox[{"_", ",", "_"}], "}"}]}], ",", "opt___"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"surfaceQ", "[", "surfaceSymbol", "]"}], "^=", "True"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"surfaceSymbol", "[", "shape", "]"}], "=", "surfaceShape"}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"surfaceSymbol", "[", "origin", "]"}], "=", "position"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"surfaceSymbol", "[", "surfaceComment", "]"}], "=", 
      RowBox[{
       RowBox[{"surfaceComment", "/.", 
        RowBox[{"{", "opt", "}"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"surfaceComment", "\[Rule]", 
         RowBox[{"ToString", "[", "surfaceComment", "]"}]}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", "surfaceSymbol"}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"inDomainQ", "[", 
   RowBox[{
    RowBox[{"surface_", "?", "surfaceQ"}], ",", "height_"}], "]"}], ":=", 
  RowBox[{"Between", "[", 
   RowBox[{"height", ",", 
    RowBox[{"surface", "[", "domain", "]"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"nearestHeight", "[", 
   RowBox[{
    RowBox[{"surface_", "?", "surfaceQ"}], ",", "height_"}], "]"}], ":=", 
  RowBox[{"height", "/;", 
   RowBox[{"inDomain", "[", 
    RowBox[{"surface", ",", "height"}], "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"nearestHeight", "[", 
   RowBox[{
    RowBox[{"surface_", "?", "surfaceQ"}], ",", "height_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"surface", "[", "domain", "]"}], "[", 
    RowBox[{"[", "1", "]"}], "]"}], "/;", 
   RowBox[{"height", "<", 
    RowBox[{
     RowBox[{"surface", "[", "domain", "]"}], "[", 
     RowBox[{"[", "1", "]"}], "]"}]}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"nearestHeight", "[", 
   RowBox[{
    RowBox[{"surface_", "?", "surfaceQ"}], ",", "height_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"surface", "[", "domain", "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"-", "1"}], "]"}], "]"}], "/;", 
   RowBox[{
    RowBox[{
     RowBox[{"surface", "[", "domain", "]"}], "[", 
     RowBox[{"[", 
      RowBox[{"-", "1"}], "]"}], "]"}], "<", "height"}]}]}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796769784702441*^9, 3.796769850449298*^9}, {
   3.796769882917695*^9, 3.796769923284545*^9}, {3.796770392869598*^9, 
   3.796770441809177*^9}, {3.7967705774102697`*^9, 3.796770578648234*^9}, {
   3.796770864513014*^9, 3.796771051900515*^9}, {3.796860411475552*^9, 
   3.7968604736677017`*^9}, {3.796877016926668*^9, 3.796877067788124*^9}, {
   3.79687716672609*^9, 3.796877167591175*^9}, {3.7968773792796392`*^9, 
   3.796877425326664*^9}, {3.796951711467187*^9, 3.7969519951567383`*^9}, {
   3.796953626693973*^9, 3.796953638687928*^9}, {3.7969602593141193`*^9, 
   3.796960275578966*^9}, {3.7969604358901157`*^9, 3.796960465556493*^9}, 
   3.796960508723426*^9, {3.796964380167589*^9, 3.7969644130482283`*^9}, {
   3.800507841609271*^9, 3.800507848852982*^9}, {3.800514992156886*^9, 
   3.80051506947886*^9}, 3.806807410531301*^9, {3.806807452850013*^9, 
   3.8068074998923273`*^9}, {3.806807975108374*^9, 3.806807975719441*^9}, 
   3.806808405582767*^9},ExpressionUUID->"bfc46232-f5a4-4cf9-8b04-\
379c2df039cd"],

Cell[BoxData[
 RowBox[{
  RowBox[{"clearAperture", "[", 
   RowBox[{"surf_", "?", "surfaceQ"}], "]"}], ":=", 
  RowBox[{"domain", "[", 
   RowBox[{"surf", "[", "shape", "]"}], "]"}]}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796769784702441*^9, 3.796769850449298*^9}, {
   3.796769882917695*^9, 3.796769923284545*^9}, {3.796770392869598*^9, 
   3.796770441809177*^9}, {3.7967705774102697`*^9, 3.796770578648234*^9}, {
   3.796770864513014*^9, 3.796771051900515*^9}, {3.796860411475552*^9, 
   3.7968604736677017`*^9}, {3.796877016926668*^9, 3.796877067788124*^9}, {
   3.79687716672609*^9, 3.796877167591175*^9}, {3.7968773792796392`*^9, 
   3.796877425326664*^9}, {3.796951711467187*^9, 3.7969519951567383`*^9}, {
   3.796953626693973*^9, 3.796953638687928*^9}, {3.7969602593141193`*^9, 
   3.796960275578966*^9}, {3.7969604358901157`*^9, 3.796960465556493*^9}, 
   3.796960508723426*^9, {3.796964380167589*^9, 3.7969644130482283`*^9}, {
   3.800507841609271*^9, 3.800507884786635*^9}, {3.800516072955917*^9, 
   3.8005161448462133`*^9}},ExpressionUUID->"d1b1b267-03bd-480e-95c3-\
6f1e9ab1f869"],

Cell[BoxData[
 RowBox[{
  RowBox[{"surfacePosition", "[", 
   RowBox[{"surf_", "?", "surfaceQ"}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"surf", "[", "origin", "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"-", "1"}], "]"}], "]"}], "+", 
   RowBox[{"individualOffset", "[", 
    RowBox[{"surf", "[", "shape", "]"}], "]"}]}]}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796769784702441*^9, 3.796769850449298*^9}, {
   3.796769882917695*^9, 3.796769923284545*^9}, {3.796770392869598*^9, 
   3.796770441809177*^9}, {3.7967705774102697`*^9, 3.796770578648234*^9}, {
   3.796770864513014*^9, 3.796771051900515*^9}, {3.796860411475552*^9, 
   3.7968604736677017`*^9}, {3.796877016926668*^9, 3.796877067788124*^9}, {
   3.79687716672609*^9, 3.796877167591175*^9}, {3.7968773792796392`*^9, 
   3.796877425326664*^9}, {3.796951711467187*^9, 3.7969519951567383`*^9}, {
   3.796953626693973*^9, 3.796953638687928*^9}, {3.7969602593141193`*^9, 
   3.796960275578966*^9}, {3.7969604358901157`*^9, 3.796960465556493*^9}, 
   3.796960508723426*^9, {3.796964380167589*^9, 3.7969644130482283`*^9}, {
   3.800507841609271*^9, 3.800507884786635*^9}, {3.800516072955917*^9, 
   3.8005161448462133`*^9}, {3.800562513522173*^9, 3.800562516918889*^9}, {
   3.800565716990013*^9, 3.800565737103487*^9}, {3.8026581395600433`*^9, 
   3.802658144161249*^9}},ExpressionUUID->"9fccfb43-4e04-4437-aff9-\
92173b55911c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"marginalPositionOfSurface", "[", 
   RowBox[{"s_", "?", "surfaceQ"}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"p", "=", 
      RowBox[{"surfacePosition", "[", "s", "]"}]}], "}"}], ",", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"0", ",", "p"}], "}"}], "+", "#"}], "&"}], ",", 
      RowBox[{"marginalPosition", "[", 
       RowBox[{"s", "[", "shape", "]"}], "]"}]}], "]"}]}], "]"}]}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796769784702441*^9, 3.796769850449298*^9}, {
   3.796769882917695*^9, 3.796769923284545*^9}, {3.796770392869598*^9, 
   3.796770441809177*^9}, {3.7967705774102697`*^9, 3.796770578648234*^9}, {
   3.796770864513014*^9, 3.796771051900515*^9}, {3.796860411475552*^9, 
   3.7968604736677017`*^9}, {3.796877016926668*^9, 3.796877067788124*^9}, {
   3.79687716672609*^9, 3.796877167591175*^9}, {3.7968773792796392`*^9, 
   3.796877425326664*^9}, {3.796951711467187*^9, 3.7969519951567383`*^9}, {
   3.796953626693973*^9, 3.796953638687928*^9}, {3.7969602593141193`*^9, 
   3.796960275578966*^9}, {3.7969604358901157`*^9, 3.796960465556493*^9}, 
   3.796960508723426*^9, {3.796964380167589*^9, 3.7969644130482283`*^9}, {
   3.800507841609271*^9, 3.800507884786635*^9}, {3.800516072955917*^9, 
   3.8005161448462133`*^9}, {3.800562513522173*^9, 3.800562516918889*^9}, {
   3.800565716990013*^9, 3.800565737103487*^9}, {3.8026581395600433`*^9, 
   3.802658144161249*^9}, {3.802658248483369*^9, 3.802658318752563*^9}, 
   3.802658739139885*^9},ExpressionUUID->"c806e19f-ea8d-4c3d-8645-\
97568c782b57"],

Cell[BoxData[
 RowBox[{
  RowBox[{"surfaceShapeType", "[", 
   RowBox[{"surf_", "?", "surfaceQ"}], "]"}], ":=", 
  RowBox[{"Head", "[", 
   RowBox[{"surf", "[", "shape", "]"}], "]"}]}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796769784702441*^9, 3.796769850449298*^9}, {
   3.796769882917695*^9, 3.796769923284545*^9}, {3.796770392869598*^9, 
   3.796770441809177*^9}, {3.7967705774102697`*^9, 3.796770578648234*^9}, {
   3.796770864513014*^9, 3.796771051900515*^9}, {3.796860411475552*^9, 
   3.7968604736677017`*^9}, {3.796877016926668*^9, 3.796877067788124*^9}, {
   3.79687716672609*^9, 3.796877167591175*^9}, {3.7968773792796392`*^9, 
   3.796877425326664*^9}, {3.796951711467187*^9, 3.7969519951567383`*^9}, {
   3.796953626693973*^9, 3.796953638687928*^9}, {3.7969602593141193`*^9, 
   3.796960275578966*^9}, {3.7969604358901157`*^9, 3.796960465556493*^9}, 
   3.796960508723426*^9, {3.796964380167589*^9, 3.7969644130482283`*^9}, {
   3.800507841609271*^9, 3.800507884786635*^9}, {3.800516072955917*^9, 
   3.8005161448462133`*^9}, {3.800562513522173*^9, 3.800562516918889*^9}, {
   3.800565716990013*^9, 
   3.800565759995273*^9}},ExpressionUUID->"ca0b8550-03c4-4ca1-878a-\
971a96713cde"],

Cell[BoxData[
 RowBox[{
  RowBox[{"attachAttributeToSurface", "[", 
   RowBox[{
    RowBox[{"surfaceSymbol_", "?", "surfaceQ"}], ",", 
    "attributeSymbol_Symbol", ",", "attributeValue_"}], "]"}], ":=", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"surfaceSymbol", "[", "attributeSymbol", "]"}], "=", 
    "attributeValue"}], ")"}]}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796769784702441*^9, 3.796769850449298*^9}, {
   3.796769882917695*^9, 3.796769923284545*^9}, {3.796770392869598*^9, 
   3.796770441809177*^9}, {3.7967705774102697`*^9, 3.796770578648234*^9}, {
   3.796770864513014*^9, 3.796771051900515*^9}, {3.796860411475552*^9, 
   3.7968604736677017`*^9}, {3.796877016926668*^9, 3.796877067788124*^9}, {
   3.79687716672609*^9, 3.796877167591175*^9}, {3.7968773792796392`*^9, 
   3.796877425326664*^9}, {3.796951711467187*^9, 3.7969519951567383`*^9}, {
   3.796953626693973*^9, 3.796953638687928*^9}, {3.7969602593141193`*^9, 
   3.796960275578966*^9}, {3.7969604358901157`*^9, 3.796960465556493*^9}, 
   3.796960508723426*^9, {3.796964380167589*^9, 3.7969644130482283`*^9}, {
   3.800507841609271*^9, 3.800507884786635*^9}, {3.800516072955917*^9, 
   3.8005161448462133`*^9}, {3.800562513522173*^9, 3.800562518933543*^9}, {
   3.8005626125322847`*^9, 3.800562640229957*^9}, {3.802654228715652*^9, 
   3.8026543302815228`*^9}, {3.802656524640746*^9, 
   3.802656525055118*^9}},ExpressionUUID->"de00c433-744e-45b3-9a26-\
0b5ef92da8de"],

Cell[BoxData[
 RowBox[{
  RowBox[{"setDomain", "[", 
   RowBox[{
    RowBox[{"surface_", "?", "surfaceQ"}], ",", "pos_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"h", ",", "dom"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"h", "=", 
      RowBox[{"pos", "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"dom", "=", 
        RowBox[{"domain", "[", 
         RowBox[{"surface", "[", "shape", "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"dom", "=!=", "domainAll"}], ")"}], "&&", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"dom", "[", 
             RowBox[{"[", 
              RowBox[{"-", "1"}], "]"}], "]"}], "<", "h"}], ")"}]}], 
         ","}]}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"surface", "[", "shape", "]"}], "=", 
      RowBox[{"copyShapeReplacingDomain", "[", 
       RowBox[{
        RowBox[{"surface", "[", "shape", "]"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", "h"}], ",", "h"}], "}"}]}], "]"}]}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796769784702441*^9, 3.796769850449298*^9}, {
   3.796769882917695*^9, 3.796769923284545*^9}, {3.796770392869598*^9, 
   3.796770441809177*^9}, {3.7967705774102697`*^9, 3.796770578648234*^9}, {
   3.796770864513014*^9, 3.796771051900515*^9}, {3.796860411475552*^9, 
   3.7968604736677017`*^9}, {3.796877016926668*^9, 3.796877067788124*^9}, {
   3.79687716672609*^9, 3.796877167591175*^9}, {3.7968773792796392`*^9, 
   3.796877425326664*^9}, {3.796951711467187*^9, 3.7969519951567383`*^9}, {
   3.796953626693973*^9, 3.796953638687928*^9}, {3.7969602593141193`*^9, 
   3.796960275578966*^9}, {3.7969604358901157`*^9, 3.796960465556493*^9}, {
   3.796960508723426*^9, 3.7969605189720383`*^9}, {3.796960686201282*^9, 
   3.796960715148543*^9}, {3.7969633714284687`*^9, 3.79696337440775*^9}, 
   3.796963479983646*^9, {3.796964485141097*^9, 3.796964537050671*^9}, {
   3.79696457812516*^9, 3.796964589769722*^9}, {3.797020549207868*^9, 
   3.797020584488193*^9}, {3.797024669032661*^9, 3.797024695366959*^9}, {
   3.800065046221534*^9, 3.800065050169012*^9}, {3.800065082884128*^9, 
   3.8000651175590076`*^9}, {3.800066191784512*^9, 3.8000663884189243`*^9}, {
   3.800066709066752*^9, 3.800066776759419*^9}, {3.800067696303589*^9, 
   3.800067701680316*^9}, 3.800067764980142*^9, {3.80006785058181*^9, 
   3.800067875995936*^9}, 3.800068198275508*^9, 3.800078145092518*^9, 
   3.800137552252738*^9},
 CellLabel->
  "In[142]:=",ExpressionUUID->"6dee9e34-21fa-48b8-9d2a-0b6beadc7857"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"reflectedRay", "[", 
    RowBox[{"surface_", "?", "surfaceQ"}], "]"}], "[", 
   RowBox[{
    RowBox[{"r", ":", 
     RowBox[{"ray", "[", 
      RowBox[{"_", ",", "_", ",", "opt___"}], "]"}]}], ",", 
    RowBox[{"{", 
     RowBox[{"inputIndex_", ",", "outputIndex_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"pos", ",", "rv"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pos", "=", 
      RowBox[{"intersection", "[", 
       RowBox[{
        RowBox[{"surface", "[", "shape", "]"}], ",", "r"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"pos", "===", "noIntersection"}], ",", 
       RowBox[{"Return", "[", 
        RowBox[{"stoppedRay", "[", "noIntersection", "]"}], "]"}]}], "]"}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"domainDefinedMarginalRayQ", "[", "r", "]"}], ",", 
       RowBox[{"setDomain", "[", 
        RowBox[{"surface", ",", "pos"}], "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"rv", "=", 
      RowBox[{"reflectedVector", "[", 
       RowBox[{
        RowBox[{"surface", "[", "shape", "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"inputIndex", ",", "outputIndex"}], "}"}], ",", 
        RowBox[{"pos", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", 
        RowBox[{"direction", "[", "r", "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"rv", "===", "noNormalVector"}], "||", 
        RowBox[{"rv", "===", "totalReflection"}]}], ",", 
       RowBox[{"Return", "[", 
        RowBox[{"stoppedRay", "[", 
         RowBox[{"pos", ",", "rv"}], "]"}], "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ray", "[", 
      RowBox[{"pos", ",", "rv", ",", "opt"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796769784702441*^9, 3.796769850449298*^9}, {
   3.796769882917695*^9, 3.796769923284545*^9}, {3.796770392869598*^9, 
   3.796770441809177*^9}, {3.7967705774102697`*^9, 3.796770578648234*^9}, {
   3.796770864513014*^9, 3.796771051900515*^9}, {3.796860411475552*^9, 
   3.7968604736677017`*^9}, {3.796877016926668*^9, 3.796877067788124*^9}, {
   3.79687716672609*^9, 3.796877167591175*^9}, {3.7968773792796392`*^9, 
   3.796877425326664*^9}, {3.796951711467187*^9, 3.7969519951567383`*^9}, {
   3.796953626693973*^9, 3.796953638687928*^9}, {3.7969602593141193`*^9, 
   3.796960275578966*^9}, {3.7969604358901157`*^9, 3.796960465556493*^9}, {
   3.796960508723426*^9, 3.7969605189720383`*^9}, {3.796960686201282*^9, 
   3.796960715148543*^9}, {3.7969633714284687`*^9, 3.79696337440775*^9}, 
   3.796963479983646*^9, {3.796964485141097*^9, 3.796964537050671*^9}, {
   3.79696457812516*^9, 3.796964589769722*^9}, {3.797020549207868*^9, 
   3.797020584488193*^9}, {3.797024669032661*^9, 3.797024695366959*^9}, {
   3.800065046221534*^9, 3.800065050169012*^9}, {3.800065082884128*^9, 
   3.8000651175590076`*^9}, {3.800066191784512*^9, 3.8000663884189243`*^9}, {
   3.800066709066752*^9, 3.800066806765603*^9}, {3.800068100657386*^9, 
   3.800068101387163*^9}, {3.800068132044639*^9, 3.800068153577077*^9}, 
   3.800068203777081*^9, 3.800137554085713*^9},
 CellLabel->
  "In[143]:=",ExpressionUUID->"67a9a4ff-27fc-4c51-8a74-39a692904b86"]
}, Open  ]],

Cell[CellGroupData[{

Cell["optics", "Subsection",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.79695257765583*^9, 
  3.79695258086158*^9}},ExpressionUUID->"bfd577de-bfb1-41d2-90ab-\
95efb2992172"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"opticsQ", "[", "_", "]"}], ":=", 
  "False"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"createOptics", "[", 
   RowBox[{
    RowBox[{"opticsSymbol_", "?", "canBeObjectSymbol"}], ",", 
    RowBox[{"seq", ":", 
     RowBox[{"{", "___", "}"}]}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"meds", ",", "surfs"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"meds", ",", "surfs"}], "}"}], "=", 
      RowBox[{"Transpose", "[", 
       RowBox[{"Partition", "[", 
        RowBox[{"seq", ",", "2"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"Not", "[", 
        RowBox[{"Apply", "[", 
         RowBox[{"And", ",", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"Map", "[", 
             RowBox[{"mediumQ", ",", "meds"}], "]"}], ",", 
            RowBox[{"Map", "[", 
             RowBox[{"surfaceQ", ",", "surfs"}], "]"}]}], "]"}]}], "]"}], 
        "]"}], ",", 
       RowBox[{"Return", "[", "$Failed", "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"opticsQ", "[", "opticsSymbol", "]"}], "^=", "True"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"opticsSymbol", "[", "mediums", "]"}], "=", "meds"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"opticsSymbol", "[", "surfaces", "]"}], "=", "surfs"}], ";", 
     "\[IndentingNewLine]", "opticsSymbol"}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.7969537253840857`*^9, 3.796953736451861*^9}, 
   3.796953793559937*^9, {3.7969598786224813`*^9, 3.796959885932865*^9}, {
   3.7969599846465187`*^9, 3.7969600186645803`*^9}, {3.796964603293754*^9, 
   3.7969646306433487`*^9}, {3.8026565313802032`*^9, 3.802656621064143*^9}, {
   3.806808087349124*^9, 3.806808087691737*^9}, 
   3.8068084099005632`*^9},ExpressionUUID->"02a2439b-8ab9-4334-8f24-\
150cc65360c7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"positionOfAttributedSurface", "[", 
   RowBox[{
    RowBox[{"op_", "?", "opticsQ"}], ",", "attributeSymbol_Symbol", ",", 
    "attributeValue_"}], "]"}], " ", ":=", 
  RowBox[{"Position", "[", 
   RowBox[{
    RowBox[{"op", "[", "surfaces", "]"}], ",", 
    RowBox[{"_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"#", "[", "attributeSymbol", "]"}], "===", "attributeValue"}],
        "&"}], ")"}]}]}], "]"}]}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.7969537253840857`*^9, 3.796953736451861*^9}, 
   3.796953793559937*^9, {3.7969598786224813`*^9, 3.796959885932865*^9}, {
   3.7969599846465187`*^9, 3.7969600186645803`*^9}, {3.796964603293754*^9, 
   3.7969646306433487`*^9}, {3.8026565313802032`*^9, 3.802656621064143*^9}, {
   3.8026567758236113`*^9, 3.80265677610432*^9}, {3.802657093358986*^9, 
   3.802657096654567*^9}},ExpressionUUID->"0188595a-1a6b-4b12-9cb8-\
3e53a42fb876"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"setPupil", "::", "nosurface"}], "=", 
   "\"\<optics does not have a surface `1`\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"setPupil", "[", 
   RowBox[{
    RowBox[{"opticsSymbol_", "?", "opticsQ"}], ",", 
    RowBox[{"surfaceSymbol_", "?", "surfaceQ"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"poss", ",", "surf"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"poss", "=", 
      RowBox[{"positionOfAttributedSurface", "[", 
       RowBox[{"opticsSymbol", ",", "pupilSurface", ",", "True"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"poss", "=!=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{
        RowBox[{"surfs", "=", 
         RowBox[{"Extract", "[", 
          RowBox[{
           RowBox[{"opticsSymbol", "[", "surfaces", "]"}], ",", "poss"}], 
          "]"}]}], ";", 
        RowBox[{"ReleaseHold", "[", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Hold", "[", 
             RowBox[{
              RowBox[{"#", "[", "pupilSurface", "]"}], "=", "False"}], "]"}], 
            "&"}], ",", "surfs"}], "]"}], "]"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"MemberQ", "[", 
        RowBox[{
         RowBox[{"opticsSymbol", "[", "surfaces", "]"}], ",", 
         "surfaceSymbol"}], "]"}], ",", 
       RowBox[{
        RowBox[{"surfaceSymbol", "[", "pupilSurface", "]"}], "=", "True"}], 
       ",", 
       RowBox[{"Message", "[", 
        RowBox[{
         RowBox[{"setPupil", "::", "nosurface"}], ",", "surfaceSymbol"}], 
        "]"}]}], "]"}], ";", "\[IndentingNewLine]", "opticsSymbol"}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.7969537253840857`*^9, 3.796953736451861*^9}, 
   3.796953793559937*^9, {3.7969598786224813`*^9, 3.796959885932865*^9}, {
   3.7969599846465187`*^9, 3.7969600186645803`*^9}, {3.796964603293754*^9, 
   3.7969646306433487`*^9}, {3.8026565313802032`*^9, 3.802656621064143*^9}, {
   3.8026567758236113`*^9, 3.80265677610432*^9}, {3.802657093358986*^9, 
   3.802657253066844*^9}, {3.8026572867385674`*^9, 3.802657329353938*^9}, {
   3.8026574740866337`*^9, 3.802657605635552*^9}, 
   3.802657685939878*^9},ExpressionUUID->"976dc6ae-57c1-42de-b32d-\
c7dec2900eaa"]
}, Open  ]],

Cell[CellGroupData[{

Cell["traceRay", "Subsection",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796952600798683*^9, 
  3.796952605488256*^9}},ExpressionUUID->"df78e49c-d4c8-422a-848a-\
85c6fb6759a1"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"traceRay", "[", 
    RowBox[{"optics_", "?", "opticsQ"}], "]"}], "[", 
   RowBox[{"initialRay_ray", ",", 
    RowBox[{"lambda_", "?", "NumberQ"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"indices", ",", "indpair", ",", "args", ",", "ir", ",", "rays"}],
      "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"indices", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"refractiveIndexValue", "[", 
          RowBox[{"#", ",", "lambda"}], "]"}], "&"}], ",", 
        RowBox[{"optics", "[", "mediums", "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"indpair", "=", 
      RowBox[{"Transpose", "[", 
       RowBox[{"{", 
        RowBox[{"indices", ",", 
         RowBox[{"RotateLeft", "[", "indices", "]"}]}], "}"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"args", "=", 
      RowBox[{"Transpose", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"optics", "[", "surfaces", "]"}], ",", 
         RowBox[{"Take", "[", 
          RowBox[{"indpair", ",", 
           RowBox[{"Length", "[", 
            RowBox[{"optics", "[", "surfaces", "]"}], "]"}]}], "]"}]}], "}"}],
        "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"ir", "=", 
      RowBox[{"setRefractiveIndexForRay", "[", 
       RowBox[{"initialRay", ",", 
        RowBox[{"indices", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"rays", "=", 
      RowBox[{"FoldList", "[", 
       RowBox[{"traceOneRay", ",", "ir", ",", "args"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"raySequence", "[", 
      RowBox[{"lambda", ",", "rays"}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.7969656501684103`*^9, 3.796965651483568*^9}},
 CellLabel->
  "In[161]:=",ExpressionUUID->"fcb3d799-7294-43a0-9c54-77de7463d1db"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"traceRay", "[", 
    RowBox[{"surface_", "?", "surfaceQ"}], "]"}], "[", 
   RowBox[{"r_ray", ",", 
    RowBox[{"{", 
     RowBox[{"inputIndex_", ",", "outputIndex_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"traceOneRay", "[", 
   RowBox[{"r", ",", 
    RowBox[{"{", 
     RowBox[{"surface", ",", 
      RowBox[{"{", 
       RowBox[{"inputIndex", ",", "outputIndex"}], "}"}]}], "}"}]}], 
   "]"}]}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.7968577359788923`*^9, 3.796857797158944*^9}, {
  3.7968578284581137`*^9, 3.7968578376715927`*^9}, {3.796859354723282*^9, 
  3.7968593669299383`*^9}, {3.7968595875518007`*^9, 3.7968596147770557`*^9}, {
  3.796859920417903*^9, 3.796859923320112*^9}, {3.79686018937031*^9, 
  3.7968602589420547`*^9}, {3.796965659495899*^9, 3.796965673547748*^9}},
 CellLabel->
  "In[162]:=",ExpressionUUID->"4454b879-bd0a-4c2d-ab28-d1bf17bf8831"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"traceOneRay", "[", 
   RowBox[{"r_ray", ",", 
    RowBox[{"{", 
     RowBox[{"surface_", ",", 
      RowBox[{"{", 
       RowBox[{"inputIndex_", ",", "outputIndex_"}], "}"}]}], "}"}]}], "]"}], 
  ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"offray", ",", "refray"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"offray", "=", 
      RowBox[{"offsetRay", "[", 
       RowBox[{"r", ",", 
        RowBox[{"surface", "[", "origin", "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"refray", "=", 
      RowBox[{
       RowBox[{"reflectedRay", "[", "surface", "]"}], "[", 
       RowBox[{"offray", ",", 
        RowBox[{"{", 
         RowBox[{"inputIndex", ",", "outputIndex"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"offsetBackRay", "[", 
      RowBox[{"refray", ",", 
       RowBox[{"surface", "[", "origin", "]"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"traceOneRay", "[", 
   RowBox[{
    RowBox[{"stoppedRay", "[", "__", "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"surface_", ",", 
      RowBox[{"{", 
       RowBox[{"inputIndex_", ",", "outputIndex_"}], "}"}]}], "}"}]}], "]"}], 
  ":=", "untraceableRay"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"traceOneRay", "[", 
   RowBox[{"untraceableRay", ",", 
    RowBox[{"{", 
     RowBox[{"surface_", ",", 
      RowBox[{"{", 
       RowBox[{"inputIndex_", ",", "outputIndex_"}], "}"}]}], "}"}]}], "]"}], 
  ":=", "untraceableRay"}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.7968577359788923`*^9, 3.796857797158944*^9}, {
   3.7968578284581137`*^9, 3.7968578376715927`*^9}, {3.796859354723282*^9, 
   3.7968593669299383`*^9}, {3.7968595875518007`*^9, 
   3.7968596147770557`*^9}, {3.796859920417903*^9, 3.796859923320112*^9}, {
   3.79686018937031*^9, 3.7968602589420547`*^9}, {3.796860306295829*^9, 
   3.796860340238323*^9}, {3.796860485570848*^9, 3.796860569206224*^9}, 
   3.796860617627799*^9, 3.796960449213484*^9, {3.79696568253598*^9, 
   3.796965690860189*^9}, {3.797024304481428*^9, 3.797024346253635*^9}, {
   3.797024478524724*^9, 3.7970245039953423`*^9}, {3.797024803022727*^9, 
   3.7970248558554707`*^9}, {3.797025023016018*^9, 3.79702502528848*^9}, 
   3.797025089543069*^9, {3.797025210980597*^9, 3.797025231308313*^9}, {
   3.797025374264648*^9, 3.797025404162394*^9}, {3.7970255469335203`*^9, 
   3.797025567521103*^9}, {3.797025642078875*^9, 3.797025645508071*^9}, {
   3.797025737877379*^9, 3.7970257485975924`*^9}},
 CellLabel->
  "In[163]:=",ExpressionUUID->"41a7bdac-d90e-4efe-9e4e-5bba2d9e9b3c"],

Cell[BoxData[
 RowBox[{"(*", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Protect", "[", "mediums", "]"}], ";", "\[IndentingNewLine]", 
   RowBox[{"Protect", "[", "surfaces", "]"}], ";", "\[IndentingNewLine]", 
   RowBox[{"Protect", "[", "shape", "]"}], ";", "\[IndentingNewLine]", 
   RowBox[{"Protect", "[", "surface", "]"}], ";", "\[IndentingNewLine]", 
   RowBox[{"Protect", "[", "boundary", "]"}], ";", "\[IndentingNewLine]", 
   RowBox[{"Protect", "[", "domain", "]"}], ";", "\[IndentingNewLine]", 
   RowBox[{"Protect", "[", "ray", "]"}], ";", "\[IndentingNewLine]", 
   RowBox[{"Protect", "[", "raySequence", "]"}], ";", "\[IndentingNewLine]", 
   RowBox[{"Protect", "[", "plane", "]"}], ";", "\[IndentingNewLine]", 
   RowBox[{"Protect", "[", "spherical", "]"}], ";", "\[IndentingNewLine]", 
   RowBox[{"Protect", "[", "quadratic", "]"}], ";", "\[IndentingNewLine]", 
   RowBox[{"Protect", "[", "parametric", "]"}], ";", "\[IndentingNewLine]", 
   RowBox[{"Protect", "[", "stoppedRay", "]"}], ";", "\[IndentingNewLine]", 
   RowBox[{"Protect", "[", "untraceableRay", "]"}], ";"}], 
  "\[IndentingNewLine]", "*)"}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{
  3.796953648564158*^9, {3.796953697581685*^9, 3.796953710609912*^9}, {
   3.796953850058773*^9, 3.796953869520212*^9}, {3.796953926393014*^9, 
   3.796953927303315*^9}, {3.796960976575077*^9, 3.7969609800705957`*^9}, {
   3.7970244467116003`*^9, 3.79702445259377*^9}, 3.797024497594409*^9, {
   3.7970255719652357`*^9, 3.7970255764640503`*^9}, {3.797040792073503*^9, 
   3.7970407931314087`*^9}},
 CellLabel->
  "In[166]:=",ExpressionUUID->"0c36398e-c180-4691-a7eb-956ca37a44ad"]
}, Open  ]],

Cell[CellGroupData[{

Cell["utilities", "Subsection",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796953266017013*^9, 
  3.796953274532906*^9}},ExpressionUUID->"008edd48-df0f-423a-9995-\
9cd723f5ec60"],

Cell[BoxData[
 RowBox[{
  RowBox[{"unfoldInterpolation", "[", "if_InterpolatingFunction", "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"dompos", "=", 
      RowBox[{"interpolationSectionPoints", "[", "if", "]"}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Interpolation", "[", 
     RowBox[{"Evaluate", "[", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"#", ",", 
           RowBox[{"if", "[", 
            RowBox[{"Abs", "[", "#", "]"}], "]"}]}], "}"}], "&"}], ",", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"Reverse", "[", 
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "#"}], "&"}], ",", 
             RowBox[{"Rest", "[", "dompos", "]"}]}], "]"}], "]"}], ",", 
          "dompos"}], "]"}]}], "]"}], "]"}], "]"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.7967977709926577`*^9, 3.796797789021618*^9}, {
   3.796797821993806*^9, 3.796797825753137*^9}, {3.79685180587654*^9, 
   3.796851806771229*^9}, {3.797041165828801*^9, 3.79704117133854*^9}, 
   3.797042205586026*^9, {3.797042239504097*^9, 3.797042268834337*^9}, {
   3.7970422998292513`*^9, 3.797042376950828*^9}, {3.797042407239688*^9, 
   3.7970424093297243`*^9}, {3.798347482163151*^9, 3.798347511457033*^9}, {
   3.7983476373612967`*^9, 3.798347640388557*^9}, 3.798347751970323*^9},
 CellLabel->
  "In[167]:=",ExpressionUUID->"74d9dfcf-1843-49e2-b2cd-1e99a9e31561"],

Cell[BoxData[
 RowBox[{
  RowBox[{"interpolationDomain", "[", "itf_InterpolatingFunction", "]"}], ":=", 
  RowBox[{"Flatten", "[", 
   RowBox[{"itf", "[", "\"\<Domain\>\"", "]"}], "]"}]}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.7967977709926577`*^9, 3.796797789021618*^9}, {
   3.796797821993806*^9, 3.796797825753137*^9}, {3.79685180587654*^9, 
   3.796851806771229*^9}, {3.797041165828801*^9, 3.79704117133854*^9}, 
   3.797042205586026*^9, {3.797042239504097*^9, 3.797042268834337*^9}, {
   3.7970422998292513`*^9, 3.797042376950828*^9}, {3.797042407239688*^9, 
   3.7970424093297243`*^9}, {3.798347482163151*^9, 3.79834756652876*^9}},
 CellLabel->
  "In[168]:=",ExpressionUUID->"dfc514fb-3710-4e86-9f88-aa1e930eb953"],

Cell[BoxData[
 RowBox[{
  RowBox[{
  "interpolationSectionPoints", "[", "itf_InterpolatingFunction", "]"}], ":=", 
  RowBox[{"Flatten", "[", 
   RowBox[{"itf", "[", 
    RowBox[{"[", "3", "]"}], "]"}], "]"}]}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.7967977709926577`*^9, 3.796797789021618*^9}, {
   3.796797821993806*^9, 3.796797825753137*^9}, {3.79685180587654*^9, 
   3.796851806771229*^9}, {3.797041165828801*^9, 3.79704117133854*^9}, 
   3.797042205586026*^9, {3.797042239504097*^9, 3.797042268834337*^9}, {
   3.7970422998292513`*^9, 3.797042376950828*^9}, {3.797042407239688*^9, 
   3.7970424093297243`*^9}, {3.798347482163151*^9, 3.79834756652876*^9}},
 CellLabel->
  "In[169]:=",ExpressionUUID->"6aa071b2-9495-4aaa-8e6f-d4c59c1b9ce8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"thinOut", "[", 
   RowBox[{"lis_List", ",", "n_"}], "]"}], ":=", 
  RowBox[{"Map", "[", 
   RowBox[{"First", ",", 
    RowBox[{"Partition", "[", 
     RowBox[{"lis", ",", 
      RowBox[{"Round", "[", 
       RowBox[{
        RowBox[{"Length", "[", "lis", "]"}], "/", "n"}], "]"}]}], "]"}]}], 
   "]"}]}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797047648262306*^9, 3.7970477022404737`*^9}},
 CellLabel->
  "In[170]:=",ExpressionUUID->"14d7fded-47e6-4903-a451-3125500bea29"],

Cell[BoxData[
 RowBox[{
  RowBox[{"thinOutFromBothSide", "[", 
   RowBox[{"lis_List", ",", "n_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"subs", ",", "nhalf"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"nhalf", "=", 
      RowBox[{"Floor", "[", 
       RowBox[{"n", "/", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"subs", "=", 
      RowBox[{"Partition", "[", 
       RowBox[{"lis", ",", 
        RowBox[{"Floor", "[", 
         RowBox[{
          RowBox[{"Length", "[", "lis", "]"}], "/", "2"}], "]"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"Join", "[", 
      RowBox[{
       RowBox[{"thinOut", "[", 
        RowBox[{
         RowBox[{"subs", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", "nhalf"}], "]"}], ",", 
       RowBox[{"Reverse", "[", 
        RowBox[{"thinOut", "[", 
         RowBox[{
          RowBox[{"Reverse", "[", 
           RowBox[{"subs", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}], ",", "nhalf"}], "]"}], 
        "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797047364461285*^9, 3.797047429226329*^9}, {
  3.797047475557452*^9, 3.797047635975466*^9}, {3.797047716515862*^9, 
  3.797047757738214*^9}, {3.79713596625109*^9, 3.797135988073845*^9}, {
  3.7971361529195757`*^9, 3.797136153569312*^9}},
 CellLabel->
  "In[171]:=",ExpressionUUID->"0b1fed03-25a2-4521-abef-cc13aa950e84"]
}, Open  ]],

Cell[CellGroupData[{

Cell["for Graphics", "Subsection",
 InitializationCell->True,
 CellChangeTimes->{{3.800142121256865*^9, 
  3.8001421286566*^9}},ExpressionUUID->"20e81483-882e-46a9-a76f-8105837ef45b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"lineStyles", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"CapForm", "[", "\"\<Round\>\"", "]"}], ",", 
     RowBox[{"JoinForm", "[", "\"\<Round\>\"", "]"}], ",", "Black", ",", 
     RowBox[{"AbsoluteThickness", "[", "1.6", "]"}]}], "}"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.800143302869536*^9, 3.80014334606704*^9}, {
  3.800143688521908*^9, 3.800143688700569*^9}},
 CellLabel->
  "In[144]:=",ExpressionUUID->"62d1e35c-e6ed-4b02-b145-b61188f4dbbd"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"surfaceGraphics", "[", 
   RowBox[{"s_", "?", "surfaceQ"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"h", ",", "isec"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"isec", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"domain", "[", 
        RowBox[{"s", "[", "shape", "]"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ParametricPlot", "[", 
      RowBox[{
       RowBox[{"Evaluate", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"shapeFunctionToDraw", "[", 
           RowBox[{"s", "[", "shape", "]"}], "]"}], "[", "h", "]"}], "+", 
         RowBox[{"Reverse", "[", 
          RowBox[{"s", "[", "origin", "]"}], "]"}]}], "]"}], ",", 
       RowBox[{"Evaluate", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"{", "h", "}"}], ",", 
           RowBox[{"MinMax", "[", "isec", "]"}]}], "]"}], "]"}], "]"}], ",", 
       RowBox[{"PlotStyle", ":>", "lineStyles"}]}], "]"}]}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"surfaceGraphics", "[", 
   RowBox[{
    RowBox[{"s_", "?", "surfaceQ"}], ",", 
    RowBox[{"dom", ":", 
     RowBox[{"{", 
      RowBox[{"_", ",", "_"}], "}"}]}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"h", ",", "isec"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"isec", "=", 
      RowBox[{"IntervalIntersection", "[", 
       RowBox[{
        RowBox[{"Interval", "[", "dom", "]"}], ",", 
        RowBox[{"Interval", "[", 
         RowBox[{"domain", "[", 
          RowBox[{"s", "[", "shape", "]"}], "]"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ParametricPlot", "[", 
      RowBox[{
       RowBox[{"Evaluate", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"shapeFunctionToDraw", "[", 
           RowBox[{"s", "[", "shape", "]"}], "]"}], "[", "h", "]"}], "+", 
         RowBox[{"Reverse", "[", 
          RowBox[{"s", "[", "origin", "]"}], "]"}]}], "]"}], ",", 
       RowBox[{"Evaluate", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"{", "h", "}"}], ",", 
           RowBox[{"MinMax", "[", "isec", "]"}]}], "]"}], "]"}], "]"}], ",", 
       RowBox[{"PlotStyle", ":>", "lineStyles"}]}], "]"}]}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"surfaceGraphics", "[", 
   RowBox[{
    RowBox[{"s_", "?", "surfaceQ"}], ",", "___"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"Graphics", "[", "]"}], "/;", 
   RowBox[{"hiddenQ", "[", "s", "]"}]}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.800067082210053*^9, 3.800067093944124*^9}, {
   3.800067127222309*^9, 3.800067133140442*^9}, {3.800142926157702*^9, 
   3.800142958634466*^9}, {3.800143086936721*^9, 3.8001430945631523`*^9}, {
   3.800143125516356*^9, 3.800143167691577*^9}, {3.800143321902665*^9, 
   3.800143325884375*^9}, {3.8001433559458*^9, 3.800143365969562*^9}, {
   3.802654413264058*^9, 3.8026544376410513`*^9}, 
   3.802654497459498*^9},ExpressionUUID->"19c433ef-d7d0-42ec-949a-\
c924432c645e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"cornerPostion", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"x1_", ",", "y1_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"x2_", ",", "y2_"}], "}"}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"x2", ",", "y1"}], "}"}], "/;", 
   RowBox[{
    RowBox[{"Abs", "[", "y1", "]"}], ">=", 
    RowBox[{"Abs", "[", "y2", "]"}]}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"cornerPostion", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"x1_", ",", "y1_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"x2_", ",", "y2_"}], "}"}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"x1", ",", "y2"}], "}"}], "/;", 
   RowBox[{
    RowBox[{"Abs", "[", "y1", "]"}], "<", 
    RowBox[{"Abs", "[", "y2", "]"}]}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"edgeLine", "[", 
   RowBox[{
    RowBox[{"p1", ":", 
     RowBox[{"{", 
      RowBox[{"_", ",", "_"}], "}"}]}], ",", 
    RowBox[{"p2", ":", 
     RowBox[{"{", 
      RowBox[{"_", ",", "_"}], "}"}]}]}], "]"}], ":=", 
  RowBox[{"Line", "[", 
   RowBox[{"{", 
    RowBox[{"p1", ",", 
     RowBox[{"cornerPostion", "[", 
      RowBox[{"p1", ",", "p2"}], "]"}], ",", "p2"}], "}"}], "]"}]}]}], "Input",\

 InitializationCell->True,
 CellChangeTimes->{{3.800142264372405*^9, 3.800142264550205*^9}},
 CellLabel->
  "In[147]:=",ExpressionUUID->"1cb426fd-41e7-4107-b825-c946cb99ba2f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"marginalPosition", "[", 
   RowBox[{"s_", "?", "surfaceQ"}], "]"}], ":=", 
  RowBox[{"Map", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"#", "+", 
      RowBox[{"Reverse", "[", 
       RowBox[{"s", "[", "origin", "]"}], "]"}]}], "&"}], ",", 
    RowBox[{"marginalPosition", "[", 
     RowBox[{"s", "[", "shape", "]"}], "]"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8001423685637207`*^9, 3.800142375795575*^9}, {
  3.800142430584898*^9, 3.8001424420267897`*^9}, {3.800142658956789*^9, 
  3.800142697196957*^9}, {3.800142767669746*^9, 3.80014277124769*^9}},
 CellLabel->
  "In[150]:=",ExpressionUUID->"a61035c1-f2d9-46ba-8ecd-ab9c12221995"],

Cell[BoxData[
 RowBox[{
  RowBox[{"edgeConnectingLines", "[", 
   RowBox[{"s1_", ",", "s2_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"p1", ",", "p2"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"p1", "=", 
      RowBox[{"marginalPosition", "[", "s1", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"p2", "=", 
      RowBox[{"marginalPosition", "[", "s2", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"edgeLine", "[", 
        RowBox[{
         RowBox[{"p1", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", 
         RowBox[{"p2", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
       RowBox[{"edgeLine", "[", 
        RowBox[{
         RowBox[{"p1", "[", 
          RowBox[{"[", "2", "]"}], "]"}], ",", 
         RowBox[{"p2", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "}"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.800142297774295*^9, 3.800142347320406*^9}, {
  3.800142712454287*^9, 3.800142715422632*^9}},
 CellLabel->
  "In[151]:=",ExpressionUUID->"60d17f37-2eaf-4107-b91c-36fb51e6ddca"],

Cell[BoxData[
 RowBox[{
  RowBox[{"bulkLensGraphics", "[", 
   RowBox[{
    RowBox[{"s1_", "?", "surfaceQ"}], ",", 
    RowBox[{"s2_", "?", "surfaceQ"}]}], "]"}], ":=", 
  RowBox[{"Show", "[", 
   RowBox[{
    RowBox[{"Graphics", "[", 
     RowBox[{"Join", "[", 
      RowBox[{"lineStyles", ",", 
       RowBox[{"{", 
        RowBox[{"edgeConnectingLines", "[", 
         RowBox[{"s1", ",", "s2"}], "]"}], "}"}]}], "]"}], "]"}], ",", 
    RowBox[{"surfaceGraphics", "[", "s1", "]"}], ",", 
    RowBox[{"surfaceGraphics", "[", "s2", "]"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.80014216916187*^9, 3.800142193965885*^9}, {
   3.8001428094095907`*^9, 3.8001428466821203`*^9}, {3.80014288562262*^9, 
   3.800142892639407*^9}, {3.800142966309561*^9, 3.8001429752744637`*^9}, {
   3.800143042127489*^9, 3.8001430518452063`*^9}, {3.8001431452252827`*^9, 
   3.800143170572144*^9}, 3.800143330936144*^9, {3.800143551469406*^9, 
   3.8001436328541317`*^9}},
 CellLabel->
  "In[152]:=",ExpressionUUID->"bafad77a-ab1c-454f-9fd5-0c619096bd0a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"lensGraphics", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"s1_", "?", "surfaceQ"}], ",", 
      RowBox[{"s2_", "?", "surfaceQ"}]}], "}"}], ",", "atmosphere"}], "]"}], ":=", 
  RowBox[{"{", "}"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"lensGraphics", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"s1_", "?", "surfaceQ"}], ",", 
      RowBox[{"s2_", "?", "surfaceQ"}]}], "}"}], ",", "_"}], "]"}], ":=", 
  RowBox[{"bulkLensGraphics", "[", 
   RowBox[{"s1", ",", "s2"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"singleSurfaceGraphics", "[", 
   RowBox[{
    RowBox[{"s_", "?", "surfaceQ"}], ",", 
    RowBox[{"{", 
     RowBox[{"atmosphere", ",", "atmosphere"}], "}"}]}], "]"}], ":=", 
  RowBox[{"surfaceGraphics", "[", "s", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"singleSurfaceGraphics", "[", 
   RowBox[{
    RowBox[{"s_", "?", "surfaceQ"}], ",", 
    RowBox[{"{", 
     RowBox[{"_", ",", "_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"{", "}"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8001441611747427`*^9, 3.800144214690983*^9}, {
  3.800144254764518*^9, 3.800144295986513*^9}, {3.8001445790606937`*^9, 
  3.800144583243143*^9}, {3.800144716855563*^9, 3.8001448059685097`*^9}, {
  3.800427058047768*^9, 
  3.8004270580493393`*^9}},ExpressionUUID->"5c4e4005-1c58-44b2-a235-\
5ecb5721ca29"],

Cell[BoxData[
 RowBox[{
  RowBox[{"neighbouringPair", "[", "l_List", "]"}], ":=", 
  RowBox[{"Most", "[", 
   RowBox[{"Transpose", "[", 
    RowBox[{"{", 
     RowBox[{"l", ",", 
      RowBox[{"RotateLeft", "[", "l", "]"}]}], "}"}], "]"}], "]"}]}]], "Input",\

 InitializationCell->True,
 CellChangeTimes->{{3.800144827537303*^9, 3.800144850172215*^9}},
 CellLabel->
  "In[159]:=",ExpressionUUID->"49079f91-aab9-42a1-a58a-f9ed2a716e38"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"positionToDifferent", "[", "l_List", "]"}], ":=", 
  RowBox[{"Position", "[", 
   RowBox[{"l", ",", 
    RowBox[{"_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "=!=", 
        RowBox[{"#", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], "&"}], ")"}]}], ",", "1", ",", 
    RowBox[{"Heads", "\[Rule]", "False"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"removeUselessSurfaces", "[", 
   RowBox[{"surfs_", ",", "meds_"}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"poss", "=", 
      RowBox[{"positionToDifferent", "[", 
       RowBox[{"neighbouringPair", "[", "meds", "]"}], "]"}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Extract", "[", 
       RowBox[{"surfs", ",", "poss"}], "]"}], ",", 
      RowBox[{"Extract", "[", 
       RowBox[{"meds", ",", "poss"}], "]"}]}], "}"}]}], "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.800143740569964*^9, 3.800143766969578*^9}, {
   3.8001440415583973`*^9, 3.800144139548932*^9}, {3.8001443020385437`*^9, 
   3.800144318520767*^9}, {3.800144370466991*^9, 3.800144397502523*^9}, {
   3.800144602461545*^9, 3.8001446066997223`*^9}, {3.800144857485667*^9, 
   3.800144981678626*^9}, 3.800145028615396*^9, {3.800145064022992*^9, 
   3.800145170608634*^9}, {3.8001484314614763`*^9, 3.800148434832575*^9}, {
   3.800148477662992*^9, 3.80014849413231*^9}, {3.800162019762807*^9, 
   3.800162110168056*^9}, {3.8001621857262487`*^9, 3.800162298977837*^9}, {
   3.800162329300466*^9, 3.800162331739644*^9}, {3.800162361949987*^9, 
   3.800162415679212*^9}, {3.8001624800566587`*^9, 3.800162494524025*^9}, {
   3.800162567403583*^9, 3.80016259952276*^9}, {3.800162812948002*^9, 
   3.800162813147665*^9}, 3.8004270580615396`*^9, {3.8026548880665903`*^9, 
   3.80265489598627*^9}, {3.802655127750298*^9, 3.802655146378374*^9}, {
   3.8026551898736687`*^9, 3.802655198525259*^9}, {3.802655648531492*^9, 
   3.802655839661476*^9}, 
   3.802656134316279*^9},ExpressionUUID->"7df808c4-8631-47ec-9d7a-\
52e6358b6bb3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "opticsGraphics", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"removeLast", "\[Rule]", "False"}], ",", 
     RowBox[{"hideUselessSurface", "\[Rule]", "True"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"opticsGraphics", "[", 
   RowBox[{
    RowBox[{"opti_", "?", "opticsQ"}], ",", "opt___Rule"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "sus", ",", "osurfs", ",", "omeds", ",", "cnt", ",", "surs", ",", 
      "bulks", ",", "meds", ",", "mbet", ",", "mpir"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"sus", "=", 
      RowBox[{
       RowBox[{"hideUselessSurface", "/.", 
        RowBox[{"{", "opt", "}"}]}], "/.", 
       RowBox[{"Options", "[", "opticsGraphics", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"osurfs", ",", "omeds"}], "}"}], "=", 
      RowBox[{"If", "[", 
       RowBox[{"sus", ",", 
        RowBox[{"removeUselessSurfaces", "[", 
         RowBox[{
          RowBox[{"opti", "[", "surfaces", "]"}], ",", 
          RowBox[{"opti", "[", "mediums", "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"opti", "[", "surfaces", "]"}], ",", 
          RowBox[{"opti", "[", "mediums", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"cnt", "=", 
      RowBox[{
       RowBox[{"Length", "[", "osurfs", "]"}], "+", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"removeLast", "/.", 
             RowBox[{"{", "opt", "}"}]}], "/.", 
            RowBox[{"Options", "[", "opticsGraphics", "]"}]}], ")"}], "&&", 
          RowBox[{"(", 
           RowBox[{"!", " ", "sus"}], ")"}]}], ",", 
         RowBox[{"-", "1"}], ",", "0"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"surs", "=", 
      RowBox[{"Take", "[", 
       RowBox[{"osurfs", ",", "cnt"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"bulks", "=", 
      RowBox[{"neighbouringPair", "[", "surs", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"meds", "=", 
      RowBox[{"Append", "[", 
       RowBox[{"omeds", ",", "atmosphere"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"mbet", "=", 
      RowBox[{"Take", "[", 
       RowBox[{
        RowBox[{"Rest", "[", "meds", "]"}], ",", 
        RowBox[{"cnt", "-", "1"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"mpair", "=", 
      RowBox[{"Take", "[", 
       RowBox[{
        RowBox[{"neighbouringPair", "[", "meds", "]"}], ",", "cnt"}], "]"}]}],
      ";", "\[IndentingNewLine]", 
     RowBox[{"Show", "[", 
      RowBox[{
       RowBox[{"Thread", "[", 
        RowBox[{"lensGraphics", "[", 
         RowBox[{"bulks", ",", "mbet"}], "]"}], "]"}], ",", 
       RowBox[{"Thread", "[", 
        RowBox[{"singleSurfaceGraphics", "[", 
         RowBox[{"surs", ",", "mpair"}], "]"}], "]"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.800143740569964*^9, 3.800143766969578*^9}, {
   3.8001440415583973`*^9, 3.800144139548932*^9}, {3.8001443020385437`*^9, 
   3.800144318520767*^9}, {3.800144370466991*^9, 3.800144397502523*^9}, {
   3.800144602461545*^9, 3.8001446066997223`*^9}, {3.800144857485667*^9, 
   3.800144981678626*^9}, 3.800145028615396*^9, {3.800145064022992*^9, 
   3.800145170608634*^9}, {3.8001484314614763`*^9, 3.800148434832575*^9}, {
   3.800148477662992*^9, 3.80014849413231*^9}, {3.800162019762807*^9, 
   3.800162110168056*^9}, {3.8001621857262487`*^9, 3.800162298977837*^9}, {
   3.800162329300466*^9, 3.800162331739644*^9}, {3.800162361949987*^9, 
   3.800162415679212*^9}, {3.8001624800566587`*^9, 3.800162494524025*^9}, {
   3.800162567403583*^9, 3.80016259952276*^9}, {3.800162812948002*^9, 
   3.800162813147665*^9}, 3.8004270580615396`*^9, {3.8026548880665903`*^9, 
   3.80265489598627*^9}, {3.802655127750298*^9, 3.802655146378374*^9}, {
   3.802655853770907*^9, 3.802655998727784*^9}, {3.8026594258389473`*^9, 
   3.802659459453444*^9}, {3.8084425354920177`*^9, 3.808442558816053*^9}, {
   3.808443389585991*^9, 
   3.808443409970766*^9}},ExpressionUUID->"c1da2634-099c-4126-a692-\
845fc59f7ef0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"reflectedPointsToDraw", "[", "rs_raySequence", "]"}], ":=", 
  RowBox[{"Map", "[", 
   RowBox[{"Reverse", ",", 
    RowBox[{"Map", "[", 
     RowBox[{"origin", ",", 
      RowBox[{"sequenceOfRays", "[", "rs", "]"}]}], "]"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"rayLineToDraw", "[", "rs_raySequence", "]"}], ":=", 
  RowBox[{"Line", "[", 
   RowBox[{"reflectedPointsToDraw", "[", "rs", "]"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"rayLineToDraw", "[", 
   RowBox[{"rs_raySequence", ",", "count_"}], "]"}], ":=", 
  RowBox[{"Line", "[", 
   RowBox[{"Take", "[", 
    RowBox[{
     RowBox[{"reflectedPointsToDraw", "[", "rs", "]"}], ",", "count"}], "]"}],
    "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"rayLineToDraw", "[", 
   RowBox[{"rs_raySequence", ",", 
    RowBox[{"{", 
     RowBox[{"from_", ",", "upto_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"Line", "[", 
   RowBox[{"Take", "[", 
    RowBox[{
     RowBox[{"reflectedPointsToDraw", "[", "rs", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"from", ",", "upto"}], "}"}]}], "]"}], "]"}]}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.796856547759344*^9, 3.796856561116248*^9}, {
   3.7968585997370358`*^9, 3.796858692372059*^9}, {3.796953328266081*^9, 
   3.796953330964087*^9}, {3.796953515853327*^9, 3.796953524764027*^9}, 
   3.796953863356751*^9, 3.7969613492790403`*^9, {3.79696146355809*^9, 
   3.796961559490305*^9}, {3.7969616054367237`*^9, 3.796961617902678*^9}, {
   3.7969618894982853`*^9, 3.796962018721459*^9}, {3.797025300141307*^9, 
   3.797025311525181*^9}, {3.797025456343191*^9, 3.79702545734301*^9}, {
   3.7970255193913717`*^9, 3.797025524014585*^9}, 3.797025605525152*^9, {
   3.797025865380913*^9, 3.797025933646471*^9}, {3.797025990869837*^9, 
   3.7970260610706997`*^9}, {3.797026099389998*^9, 3.797026116096239*^9}, {
   3.7970262145053864`*^9, 3.797026251238398*^9}, {3.797026299484253*^9, 
   3.797026300785323*^9}, {3.797026358841145*^9, 3.797026360087324*^9}, {
   3.797059414749358*^9, 3.7970594492862577`*^9}, {3.7981459821234007`*^9, 
   3.7981460529097023`*^9}},
 CellLabel->"In[60]:=",ExpressionUUID->"86fc1289-a533-425e-9504-db5d07518ec9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "rayCongruenceGraphics", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "rayCongruenceGraphics", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"rayCount", "\[Rule]", "12"}], ",", 
     RowBox[{"removeLast", "\[Rule]", "False"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"rayCongruenceGraphics", "[", 
   RowBox[{
    RowBox[{"rss", ":", 
     RowBox[{"{", "__raySequence", "}"}]}], ",", "opt___Rule"}], "]"}], ":=", 
  
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"rc", ",", "cnt"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"rc", "=", 
      RowBox[{
       RowBox[{"raySegmentCount", "[", 
        RowBox[{"rss", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}], "+", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"removeLast", "/.", 
           RowBox[{"{", "opt", "}"}]}], "/.", 
          RowBox[{"Options", "[", "rayCongruenceGraphics", "]"}]}], ",", 
         RowBox[{"-", "1"}], ",", "0"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"cnt", "=", 
      RowBox[{
       RowBox[{"rayCount", "/.", 
        RowBox[{"{", "opt", "}"}]}], "/.", 
       RowBox[{"Options", "[", "rayCongruenceGraphics", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"cnt", ">", 
        RowBox[{"Length", "[", "rss", "]"}]}], ",", 
       RowBox[{"cnt", "=", 
        RowBox[{"Length", "[", "rss", "]"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Graphics", "[", 
      RowBox[{"{", 
       RowBox[{"Thin", ",", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"rayLineToDraw", "[", 
            RowBox[{"#", ",", "rc"}], "]"}], "&"}], ",", 
          RowBox[{"thinOutFromBothSide", "[", 
           RowBox[{"rss", ",", "cnt"}], "]"}]}], "]"}]}], "}"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.800163047409186*^9, 3.800163086600316*^9}, {
   3.800163135516988*^9, 3.800163169685947*^9}, {3.8001632024239407`*^9, 
   3.800163342706009*^9}, 3.800163386315937*^9, 3.800163441442314*^9, {
   3.800163492925456*^9, 3.800163494948409*^9}, {3.800163529960634*^9, 
   3.8001635484798*^9}, {3.800163661660067*^9, 3.800163719812766*^9}, {
   3.800163757795866*^9, 3.8001637582190237`*^9}, 
   3.8001644280555973`*^9},ExpressionUUID->"62c60a93-e0c1-4543-b3a5-\
329df36e300d"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["End of this package", "Section",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797739167479363*^9, 
  3.7977391750151367`*^9}},ExpressionUUID->"2237073c-66b9-419c-9689-\
223008628855"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"EndPackage", "[", "]"}], ";"}]}], "Input",
 AutoGeneratedPackage->Automatic,
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.797739178210627*^9, 
  3.797739185814768*^9}},ExpressionUUID->"fda9fba0-dfe6-4be3-b2f3-\
9ee4625d5821"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Examples", "Title",
 InitializationCell->True,
 CellChangeTimes->{{3.796953375585787*^9, 
  3.796953380151963*^9}},ExpressionUUID->"92d0aeac-0480-4163-a787-\
db2cd7f3f9fb"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"gaussIntensity", "[", "th_", "]"}], "[", "t_", "]"}], "=", 
   RowBox[{"2", "^", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"-", "4"}], 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"t", "/", "th"}], ")"}], "^", "2"}]}], ")"}]}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.8091178190663633`*^9, 3.809117835952713*^9}, {
  3.809117890662202*^9, 3.809117905636119*^9}},
 CellLabel->"In[53]:=",ExpressionUUID->"19272e40-8026-434d-b4a7-fbbc78693f1b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"heightAndIntensity", "[", 
   RowBox[{"ray", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"h_", ",", "_"}], "}"}], ",", "_", ",", "m_"}], "]"}], "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{"h", ",", "m"}], "}"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"heightAndIntensity", "[", 
   RowBox[{"raySequence", "[", 
    RowBox[{"_", ",", 
     RowBox[{"rays", ":", 
      RowBox[{"{", "__", "}"}]}]}], "]"}], "]"}], ":=", 
  RowBox[{"heightAndIntensity", "[", 
   RowBox[{"Last", "[", "rays", "]"}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.809118171702849*^9, 3.809118308808922*^9}, {
  3.809118417237759*^9, 3.809118420600852*^9}},
 CellLabel->"In[77]:=",ExpressionUUID->"103bb1c9-2f6d-42d2-baa8-18c384c0a016"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"gatherIntensity", "[", 
   RowBox[{
    RowBox[{"l", ":", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"_", ",", "_"}], "}"}], "..."}], "}"}]}], ",", "stp_"}], 
   "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{
     RowBox[{"Round", "[", 
      RowBox[{
       RowBox[{"l", "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "1"}], "]"}], "]"}], "/", "stp"}], "]"}], "stp"}], 
    ",", 
    RowBox[{"Total", "[", 
     RowBox[{"Map", "[", 
      RowBox[{"Last", ",", "l"}], "]"}], "]"}]}], 
   "}"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"binIntensity", "[", 
   RowBox[{
    RowBox[{"l", ":", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"_", ",", "_"}], "}"}], "..."}], "}"}]}], ",", "stp_"}], 
   "]"}], ":=", 
  RowBox[{"Map", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"gatherIntensity", "[", 
      RowBox[{"#", ",", "stp"}], "]"}], "&"}], ",", 
    RowBox[{"SplitBy", "[", 
     RowBox[{"l", ",", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Round", "[", 
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "/", "stp"}], "]"}], "stp"}], 
        ")"}], "&"}]}], "]"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.8091188825329523`*^9, 3.8091189343840446`*^9}, {
  3.8091189997473993`*^9, 3.8091191256927147`*^9}, {3.8091191605450287`*^9, 
  3.8091191632326717`*^9}, {3.809119205444525*^9, 3.809119207976722*^9}},
 CellLabel->"In[97]:=",ExpressionUUID->"cc014e24-ec50-41f6-bd06-b80df0e616a2"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"coupling", "[", "th_", "]"}], "[", "thc_", "]"}], "=", 
  RowBox[{
   RowBox[{"Integrate", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"gaussIntensity", "[", "th", "]"}], "[", "t", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"t", ",", "0", ",", "thc"}], "}"}]}], "]"}], "/", 
   RowBox[{"Integrate", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"gaussIntensity", "[", "th", "]"}], "[", "t", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"t", ",", "0", ",", "Infinity"}], "}"}]}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.809120423083692*^9, 3.809120482887018*^9}},
 CellLabel->
  "In[177]:=",ExpressionUUID->"30f3c34a-f44a-4459-a07b-3dadd44f526f"],

Cell[BoxData[
 RowBox[{"<<", "\"\<AplanaticSinglet`RayTrace2D`\>\""}]], "Input",
 CellChangeTimes->{{3.797739346786965*^9, 3.797739347258459*^9}, {
   3.798145562253295*^9, 3.798145562534182*^9}, {3.8000679166907043`*^9, 
   3.80006791896093*^9}, 3.8012811763005323`*^9, 
   3.818463044226136*^9},ExpressionUUID->"de924c27-f6bd-4d9e-8a3b-\
12aa425e617c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"createSurface", "[", 
   RowBox[{"s1", ",", 
    RowBox[{"sphericalShape", "[", "0.6", "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"0.", ",", "0"}], "}"}]}], "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.7978012108293743`*^9, 3.797801249854807*^9}, {
   3.7978012813244047`*^9, 3.797801282436225*^9}, {3.797802383900268*^9, 
   3.79780238788256*^9}, {3.797802419125902*^9, 3.7978024205301523`*^9}, 
   3.797802451358203*^9, {3.797804354453314*^9, 3.797804366377243*^9}, {
   3.797804420977396*^9, 3.797804421593853*^9}, 3.7978058619204197`*^9},
 CellLabel->"In[27]:=",ExpressionUUID->"6188975c-261c-48c7-b7d9-721c41c3114a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"createSurface", "[", 
   RowBox[{"q1", ",", 
    RowBox[{"quadraticShape", "[", 
     RowBox[{"0.6", ",", 
      RowBox[{"-", "2.5"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"0.", ",", "0"}], "}"}]}], "]"}], ";"}]], "Input",
 CellChangeTimes->{3.797805868445365*^9},
 CellLabel->"In[28]:=",ExpressionUUID->"85d07ca6-08a2-47f8-89e0-1306bea6ad75"],

Cell[BoxData[
 RowBox[{
  RowBox[{"createSurface", "[", 
   RowBox[{"s2", ",", 
    RowBox[{"sphericalShape", "[", 
     RowBox[{"-", "0.3"}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"0", ",", "0.5"}], "}"}]}], "]"}], ";"}]], "Input",
 CellChangeTimes->{3.7978058730016212`*^9},
 CellLabel->"In[29]:=",ExpressionUUID->"7e32049d-c4af-4443-ac0a-4bdd4dfeaef4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"createSurface", "[", 
   RowBox[{"s3", ",", 
    RowBox[{"planeShape", "[", "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"0", ",", "3"}], "}"}]}], "]"}], ";"}]], "Input",
 CellChangeTimes->{3.7978058767699947`*^9},
 CellLabel->"In[30]:=",ExpressionUUID->"0855c75e-9137-434b-bf8c-4fdaee1c6d67"],

Cell[BoxData[
 RowBox[{
  RowBox[{"createConstantMedium", "[", 
   RowBox[{"bk7", ",", "1.51768"}], "]"}], ";"}]], "Input",
 CellChangeTimes->{3.797805881056511*^9},
 CellLabel->"In[31]:=",ExpressionUUID->"cea77143-b00b-4e0b-a23f-96004ac92b07"],

Cell[BoxData[
 RowBox[{
  RowBox[{"createOptics", "[", 
   RowBox[{"op", ",", 
    RowBox[{"{", 
     RowBox[{
     "atmosphere", ",", "q1", ",", "bk7", ",", "s2", ",", "atmosphere", ",", 
      "s3"}], "}"}]}], "]"}], ";"}]], "Input",
 CellChangeTimes->{
  3.797805886198552*^9, {3.800427058071591*^9, 3.800427058072194*^9}},
 CellLabel->"In[32]:=",ExpressionUUID->"9e1cb3e6-8cc6-425a-aebc-17726e92b695"],

Cell[BoxData[
 RowBox[{
  RowBox[{"mrg", "=", "0.8"}], ";"}]], "Input",
 CellChangeTimes->{{3.800068453784951*^9, 3.800068455909195*^9}, {
  3.800078171666629*^9, 3.800078171968527*^9}},
 CellLabel->"In[33]:=",ExpressionUUID->"24cc4583-7526-4d4e-a5b1-ac971999be3e"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"traceRay", "[", "op", "]"}], "[", 
   RowBox[{
    RowBox[{"raySetAsDomainDefinedMarginal", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"mrg", ",", 
        RowBox[{"-", "0.3"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "1."}], "}"}]}], "]"}], ",", "0.00055"}], "]"}], 
  ";"}]], "Input",
 CellChangeTimes->{
  3.800068394033268*^9, {3.8000684487352552`*^9, 3.800068459871591*^9}},
 CellLabel->"In[34]:=",ExpressionUUID->"282f4bcd-513f-4865-9432-244f8149b5e5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"rinp", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"raySet", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"h", ",", 
         RowBox[{"-", "0.3"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Sin", "[", 
          RowBox[{"0", "Degree"}], "]"}], ",", 
         RowBox[{"Cos", "[", 
          RowBox[{"0", "Degree"}], "]"}]}], "}"}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"h", ",", 
       RowBox[{"-", "mrg"}], ",", "mrg", ",", "0.01"}], "}"}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.8000684629217854`*^9, 3.800068465911088*^9}},
 CellLabel->"In[35]:=",ExpressionUUID->"c7ac71f9-56aa-4d11-80b9-285cd89a8afc"],

Cell[BoxData[
 RowBox[{
  RowBox[{"rs", "=", 
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"traceRay", "[", "op", "]"}], "[", 
       RowBox[{"#", ",", "0.00055"}], "]"}], "&"}], ",", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"raySet", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"h", ",", 
           RowBox[{"-", "0.3"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "1"}], "}"}]}], "]"}], ",", 
       RowBox[{"Evaluate", "[", 
        RowBox[{"{", 
         RowBox[{"h", ",", 
          RowBox[{"-", "mrg"}], ",", "mrg", ",", 
          RowBox[{"mrg", "/", "128"}]}], "}"}], "]"}]}], "]"}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.8091175024815493`*^9, 
  3.8091175198493443`*^9}},ExpressionUUID->"fb2fbf19-ac6b-4b75-ba66-\
d9542bdf1f11"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Show", "[", 
  RowBox[{
   RowBox[{"rayCongruenceGraphics", "[", 
    RowBox[{"rs", ",", 
     RowBox[{"removeLast", "\[Rule]", "False"}], ",", 
     RowBox[{"rayCount", "\[Rule]", "16"}]}], "]"}], ",", 
   RowBox[{"opticsGraphics", "[", 
    RowBox[{"op", ",", 
     RowBox[{"hideUselessSurface", "\[Rule]", "False"}]}], "]"}], ",", 
   RowBox[{"Axes", "\[Rule]", "True"}], ",", 
   RowBox[{"ImageSize", "\[Rule]", "Medium"}]}], "]"}]], "Input",
 CellChangeTimes->{
  3.79814642295061*^9, {3.8000673876261673`*^9, 3.800067403624034*^9}, {
   3.8000683290104523`*^9, 3.800068329164366*^9}, {3.800068408447383*^9, 
   3.8000684108645773`*^9}, {3.800148516365593*^9, 3.800148521245674*^9}, 
   3.809117527444915*^9},ExpressionUUID->"d9af4dea-aa97-4b77-8a27-\
c2293a243640"],

Cell[BoxData[
 GraphicsBox[{{{
     {GrayLevel[0], AbsoluteThickness[1.6], CapForm["Round"], JoinForm[
      "Round"], 
      LineBox[{{0.17777777777777778`, -0.8}, {0.4103730236610099, -0.8}, {
       0.4103730236610099, -0.7677761266838121}}], 
      LineBox[{{0.17777777777777778`, 0.8}, {0.4103730236610099, 0.8}, {
       0.4103730236610099, 0.7677761266838121}}]}, {{{}, {}, 
       TagBox[
        {GrayLevel[0], AbsoluteThickness[1.6], Opacity[1.], CapForm["Round"], 
         JoinForm["Round"], FaceForm[Opacity[0.3]], LineBox[CompressedData["
1:eJxdWHc81f//VaESDRQyKsnISGRW76dEVpJsFYrsvbNXZsnKVtdK9rUv0QuX
ezOy+WREMi9CkoT49f33d/45f5w/zh/nj3Me59xjh3tP9lNRUTHuo6L6H7Pa
Np2ybSJBWsr/QEFGUYznWutI0PPIyS/hFQXpdcmvcVWSgPqiiunLWArq3cJR
Bt6SwLZuU+hZBAV1fPwlovqcBNdG9Rodn1JQbDCTgKEeCcY4Ts0pGVBQH2ku
+PhyK3Dh4q5ssFLQdTEHzjHOVsh6G9V9L3keFat2/fB6QoTvBb/3LALnULze
eJna5yZooipZ3vSZRZfcvJXsTRrhYOSH0lzfGdQjhi4n4hsghk7FpsRyGn0N
izxcv1YHOWOcM2LmUwgrU9w/xE6ArVxbA6Y731DATQUfWbcqaM46iTt2dRIp
HUv4osVRAcw/DuWGyX5FPu0faNIr8aBpt6RcozyOWN/b1YSJFkN02v0W3Rtj
qOR1UhS7Rj6UivpPCyuMIE/Rc1YFZrmgU5n4p579M/Is599wpsmCY6PyUTdZ
h1AYX6J81f0MuLP67UQQpR85320m4hyTwNlW6vpmSy9avtUfTxcYB1osN9o7
IruRZUnSKf+kKOgU2z7AItGBqt2P5M65R8G9RtLSHE8HMtFI5DXVjYJh9bhB
AnMHKvvESxt/MgpmLQXyDNfbUWhMnPpQQiRQvdFTfV3RjmJNhEsXEyPgypHK
mAti7ahytlNcLz8M0qdsOa9cakPZemFR9w+GgF3CuKSmABnp7HU/uEIJBssm
zQkyCxl9YNZ6e74jGB4vt4RhtGSkdTomV/FlMOgrF34WnCKheG5PuyTWYJDf
8fCizSChWsWXM86XgoDV7MSH98dJKPRGv/Ux+wAgiiso8m62oI1oq++EewHw
waTme/psC9LqVz7wVCoACC8uJjINtqADCqeXru0LgJK543NU5S2oW2w0Jk/Q
H5LTvoSP2rSgcIXBWp9QX7A/4NEZM0FEvNnStaxGXsDWn6+1TWpGPSrFhb+F
vUA1W76WWNWMuL4v3tu/+xR8XEa5nuc0o7//KbSmvn4KX5kYFjiCmtEgQ5zx
50lPeKftGIBdb0YZhxiTwxw9QHJIsjiwoglF9ykoohJX0Bom0h7CNaLdw0Km
LCGuEJL/wLYnuhFRz/gbpxm4QvXTX73Jvo0IT7q7yUvjCqdP82UI3G9Efk0R
nbeNXOCbYaS42qlGROu0SDfA6gxfCZmNHGwISanb/y576ADs6L2LwFo9Mp5v
V9FndQB8fnX14b56tOBKkVLrtweFhLI/lLJ65DvxcPmUqj3YW+X5FzjVI6O7
OuuKV+2gmSk+SvDHe3QIPz5xQMgGrC2ts4VX65AklX0xnZIFEE6w9V9eJqAb
fq5lSkcsQH2H6RRjFwElPrn8rLfbHL7NHjVYKyYgBrGuzA4Dc6Cvp54otyOg
zpd8wwZOT8DYfHVB/HsN8tAjhE6UmALte/J+yaVqxLbLUpRiagLaZu5isguV
6G9F3fB1YRPofdG4/oRciQSY5uifLhvDnRq6mticSiTFwEeOYzUGFbo3VylG
lciY978yebeHgOHJCsn9FajAyp456a4h8O2w6m3Ul6M7a40fRVcMIOeCKRt3
ajlKnZAo8o82AG6N4lF1j3JE1XuY/nq3PnBk3TDJvVyOPgkS/SQN9OC4srWV
9tsy5OYglcr7Uhu24t97l7/Eo8+Sv6KZZbTBo4EGG7fFoxUb1/GaKS1Yn9Wg
olPFozadqSSuq1qwIjMd8ogaj2T3oups1zThI2LjOLdWghSd779np9WANL16
uS8tRSjwTfrirP4tkA/bF6lj/Q6594ezBHxThDf2/LtqAu9QnaDKso6dIuzo
aDjLz+ehUqL7u5pQBajmyTC8ZJ6HQiPos7U+yoNAs7Tg4cdv0eoPgtlXBoDj
fx066w1yUJWDWU+BMgZ204lyFaw5qMCJvLj87Dq0dzRU5v+XjRKtfytOH7wG
IalHMhJ1stEm6SpjiIAMbErl2TlqZqE4WXbe9ClxmHAeP8qjgkOau3vtB26J
wzVDmuDTh3BoSV/UaqZADMSC9ZfPRb9BPnRJmad8LkPu2fUP2xGvUZpw4cRj
TxF4fl/QpDQwHaEeckqfmTDcuvhUOX0vDZUKFgdL6goB1R+SaIRvGgrM2tg/
qnQRXBMf7zN9mopGPZXtksx54X5vStYpp2RUJKlrlu91AZhxc5EHVpJQZStb
Y2k8D3TZS7is2iahskstDSkD3CBP33uz3TIRQe3CNOn8GbiodGjG1yQBmS32
PBJL44Tpk7qfrMfj0Y90x31hHBzwejq7Su9BPDJlT+lZvMYGJ4Ig9LJ+HEr7
Kl2ds84Em/XufDMaMci36sCEZRMjDKlO/UC4l+iPj1lrRdIJqGcfTqjKjEab
Iny975uOQlhDywgu+zn6Yn7dwiuPHmyj63wTc6LQiRznsls4OrhnjD/7PDcS
xYouvDrUQQtc+9LNPfLCEd2dPuXdHWqg7os9bPcuDB2luzC5T/4ALGSFFT3O
D0WdcYzLYjRUUK3gsqZeGIKonXaXG2n/YuknrV7dLApGMvrrZ6QFtrCgWSNp
meIgtM26weP9dR1TD1f14ykNQG7mf08rua1h5uUB8ldM/JGSOKvLJdFV7LK2
bfiZx76ojx95WHIvYTu/9LrozLwRsK3QFIrOYx+TbjJvPHmK3E9yFfBGTWMJ
MpcMJy08EHMP8h69PIkZj57GdVq5Iae092fjVcawi760szU2LiinReT3JHkI
2+BaE8y2c0KKD2++zh7vxYID309xTNgjUU8uGzx7B3a6Nc7h5zdrdDsur2yv
gIiVH7Lebps1Rwvzv/2th+owlds3wnALj1EhpPhkEfBY45nLvMtjD9Gj5NAr
Gn8ysZW3E9fTpnVQtXaWTg/TC+zqA47CmM9q6IXYiSPYzSeY6OBa5WC3FErj
NFc1ChPHRDjefl7kPgt0MTzPLiz5YqWenSSTPzchPyVVTfBSMiZQVaN24Jcm
EHb1zG9I5GPbwoev6H43ALqZ9a6bUVWYuZZw9MCaCTDumWwM2zdi3cd09+8u
m8GRg5OPNpXJmHSnnzvfouU/ff7vjlY3lhmet3B3zhbOyRp3/FQawJ5xW15q
cHIEvcP+m/f9hrHaAB9Kr4Mz2A59mpZUn8CWx2OyZ+1cgSbWU0J+5BvGfT33
4baNO/hQfxHlNpzFdNNqWY5be0JBDuOdq7wLWNSfT708ll4wQiOk+FzzB7Ze
taF4x8wP5CYsZZbzf2LMkTQBly8HgDG2GWbLv4GJ1B77clU0EO4TV9cakrYx
UxaepLsiwZBjZr4UE76L+d0SWTcUDgEX4vm/qJsKkt2kNZ8IPYO/v+z3DZ+h
hs7+20e8LobB7zpvK69pGpjdr2cZIhAO1yK5ywTqDwKV2KPWaP4I0GQ3Li3L
OQJXYtz8s3mjoMHjv10xYUbIuP36Zyf3SzAYO6o55MYEsvIshQ3sMZD3sJ1c
2sYMvEbGY8xvY0CRQ3WLOp4Fdl+tYMS6WPDxUlKUKuKEYprj1Gen48H0XufL
yDtnIPmcvoSHfQKcXU/uO+x3FkKu48y7NhPgZHqTn+k1bnjgJtrmw5AI7M82
3fR3LgD9zN3oYclk2B5BUfpbvLBJlYJEm5KB+Vy0xs+/fDDNMbkappYCP3nN
mzdPXoR6bSctSZNUYJDocZGPEAGblljW+Ih00BeOJJhhV2BG00qT1x4HXM2n
ZaQXrsCIMcOCZgUOPtCZt31OloAeu7Ig300csES7UwfuSkJ9xJ+KgaBMyHgw
c8duUQYSmiJOBSdlASdyOvf5ghwoXC4YnWjMAdOWg0wCcXIgC3dcj9DmQrrV
LaOve3Igqr5GL6WWCw+U0HrgxA3gsJLFogdzQVnzYUtM6U34iWvHXVt4C2+N
SyeH45Qg6/jikxSmfFhu99f9SK8MkpE7R3m188FFV6toOUwZ2g4cJZQn5MO6
hc7yt0AVWN0Qpes8WQAdJfJOViFqgH1xL9llKQSJR9Ehi0QNGM7f/9uUoxhG
GLSwQv67YHueGbf6oPhfz1a/3HG4C1QZF1R8M4qhTVeo0JlKE3hjlNMSuUrA
k5QVU8R/D1zdo6HtbCnQ29BY6CRqQ/g5BoWkODy8LVbQJs9qw73xV8lfyvHg
HUf4PSClAxxpXN/P9+NBmG5RnziqA6XMool4pjKY6tFVWbqoB0MHtebbEsrg
ZY7Eju2sAZxfTn6+k1gOQqVeBWx9xvChjmfwUVol5HpISIudMQGctFHBgw+V
EFpXMFWuYwKB1Un+epOV4PHNl4FENAGFcrqL6nxVsI9R2U885xG05a/6SVdU
wXRFup6AuykMJNfzH+uoBqNDQW6uRhaw4K7tU79FgDCGE+F7byygc/2FZg1n
LewlPsufmbSAYmcyb7lcLZzHS58gmluCo71sb15oLVDWp642u1rBrydneeMZ
68AW91SyJ9MGqHSWuq0uvocY3VvbDGcdgUU85DyLYQNkS05odCk6QqS1s5+9
TwMcUX34pM7GEXYzTYZbXzdA7lxh10mCI0wfv/7SdaoB+CqavYfvOQF++ddW
r+0HIC9oK8bHOINqgUXfc38E9rFY0EchN/gQkysX2NcIFj7hx37NecHqwYiV
jd/NsL1PdkX7pDfE+rFPbh0kgjizX+qIvDeI/Sru22UhQmairIbea29w/dZX
RStNhBW5+hOn9Hz+9SWHzylPInyRKPuT1+0Le074Q5KbRIgdw0dH/tvzR8f+
O+e22QJmImcOW1YGgxCeV/vnJglGxBc7OPuCwSDsRKgmHRlcrsalUFaCIdRo
p6aUnQxOffvuEQVDYIK+j90WI4N+jswZ/5wQiLPynZoOJkP3VpkFS+oz2OQe
cB46+hHafTGPlldh0PoqMLaWpw2S/lwaH+uKAiPvsS7/ux1AapXbElKPA0sq
q7ucRt2gFmOmXSSSBAP3b7XkFvaC4uhiSA97Bqwomy2G9PeDNYuJzK30TNiI
+/7KdmgQ+OjYaByu5YLncpBaOvVnMHwkdGt7/h3Mvg0OGWAYgUvhzfx05CJw
3OxmHaQfg4KhGqrGTDy43ecncEqNw9TrrumV0XKoYHC3k+L6Cvyn3sloWFeB
1cZD6hDJSaC549hNPk6A4sLFj5Uq3yDN870kQ34dWBy71G2lOgVuyyNKuakN
MOG9OdJsMg1yqTd6ta81wqdED36c2Qx8eiCqfKC8CZT90rMfmc5CUewP7xe6
RAiwV+Ihe8wBqKmfbFxqARGGd7P4p/NwvBjv8vNnC5j0u0SI+s1DappBP992
C8Sl/IsoaB5Kxn6+ij/cCr8u/OdUGjUPXRYxPB68rVCP0f4tzpgHjsJMFXuT
VlBxNGMqbJqHZpxgK/tgK5j1n5XLPUwB/kgDOoexVkhMWfrGc5QCpr4vbhOn
WuGjMeFZDiMFSlb8yfZrrSC4pNGRzU6B8vsj8b3HSLBG7a+bJUwBQ/pWS5Iq
CQIkv9i+0aSAVpaLvcA9EpTvvDt2RpcC84V0Di8MSDDd7Fr+2pACHxasTfQt
SaCkQb+ZYfrPn0+eausZCY5aXg1Od6NAh1HQsNkLEsiJHOTl8KJA5mB6UU8C
CZzW+z6m+VHgzbNhKMwmwUCA9dG0MArIKhL22ApJQKskWXb6OQX+3l0gRJST
QJphv3ZqDAVurqrbbNWSwLr/0wbbKwr8vz8E/g/mzHg6
          "]]},
        Annotation[#, "Charting`Private`Tag$73561#1"]& ]}, {}}, {{{}, {}, 
       TagBox[
        {GrayLevel[0], AbsoluteThickness[1.6], Opacity[1.], CapForm["Round"], 
         JoinForm["Round"], FaceForm[Opacity[0.3]], LineBox[CompressedData["
1:eJxd2Hc01t8fAHCbjJJKQkJUpBKSht7JLBmhiPQtZTRtUmRlj8gIlR2KPGbI
uEZmiFT44PkYxWMkREbG7/r399dzXuc553Pv5573uh8RM2s9cwY6Ojoeejq6
9V9uhRn5EGUCnI8YKSaE05Dbj7GX11QJyLo0F1UTQkPMxqaFsuoE9Ds/mxwJ
oKGJ5qKVrnMEaHxoTpD2oiFi5tHELj0C+EGJodqOhrIm2FQSrhFQriFZ/0Of
hiICTUdvuBHAeGVZV5KXhgwNelyZ3xPw1CvxZmHcCGK9wPcwW6oHIjW2v2N5
OoxqWm7ssozugVsWbQLbon6iLepW/HqLPVAdzk9hT/yBZs4lZ5j81wus8hE3
TkQPodM51KjMkl4QlNE+JRE/iLruysXL8/aBUPrR43rhAyjlSwol/04fpErk
GZsF9CPO3+k+We/7YJaVeua/PSTau3mIvomBCi7ZBTw23H2oaVVBnE6VCvFM
3If+7exBlyuEdMw8qfDJMSTS4Eg3EuvZEdZdToX2LsuTYrs7EWfegmrQNBWc
x+uk78t9Qx0ZNGZbMRL+/vayPCjYgcbSPHWOXSDBbdP1kTKudnS6sZ561YmE
s+V+lkGqraiPfXYhKRYbWH0CBJvQUxO7DwJxJLSaDejQczUhp8V9slHYBr6l
/C4rjahxo9I5vxckXG2xzrGiNqLrUpKbrF6RYGfS1aOe2IjykzRnBZJIiHN+
I8Mi1oikzbcf0sogYYyi2e+1vwGVbjju8a2QhEDhsBOux+uQvYxgsep7EuL3
uxWnS9ShnQey4gqx8+RvH+ngq0OBuZ3/RRaR0H1e5ZDkfC0SCb8zplVCwj6X
BdGu/FrEKrlEl1tGQl37NXa5A7UowOPY0aM1JDB6H+4e3/URsXh/qX2JzRsq
dGn7po/I4YrEGv1HEiRjOTrOrNagDy48dp+w9Sg/m2N7a9D1UNLIuI6E5J7Y
SvXYGiR6oUXSqpGE03IMGSk8NcguYfeQ8mcSXH9+cTJhrkZ/FG7tfoVtRb/B
4ttsFWrkC938F9tgJ1zU+VGFlNSc59PaSJC6mCmrXFOFDrt/GWX6QkLvR+8p
Sc8qNGrOdCv3KwknU+VuLy1XopuGDF+bu0lYqpUqlRlFaDBzqk2AIOHLSkzs
ngaEJC2bHt3GfnuE+QF/OkKH3JR6WHpIMH7dJ8dgjlDTmnrViV4SSp+EZrf3
V6CwCUbJaCrer/JUkk1XOTquFmbDNUTCSmW+f3Z9KYpgiQ7Xwm5TpnEQGaUo
K/TInRDs5DrBp8yBpej23zManD9IUGv2ibpyvhTp8sa/YflJQminYTJ7+wcU
pBi8YXKYBKHJf6UWRAmSjpoEvzF8XgIqv4V+FaGTIqkOFdg88Q/szrUWIeHJ
petz2D+E3805UopQxZ4QC7NxEvz38C432xahlg3nth+bIKH9MI3t0d/3aPt/
Btu7f5FgphEs2rlWiPSaeCKGpkh44vj14lOeAtQ02F+xbZoEh/qDiqLT+Yhj
W3u0OvaNHQFihZ/z0ftcPs232GfKFf8QwfmoQESz9s4MCfTM6WF7WPMRo/p9
OvIPCY8jXT6V/8tF+/IfTHLMknB/uCNPl8hFd4oy/BWwTRUOxg0V56KLxg+r
wrBP9g5abXDKRWfzRlUU50j4t/s8y8WpHKT1VizC9y8JUxaKXl2NFKRrlaic
jf2ZfUZ31ZeC8rtVEr9hZ2en7RJToaChp2xXd8+TcO/vpnLrimx0SNVj/AP2
mM/gPEv+O/TXylCbWMDnlep378jLTDQ891GOWML5MNhu9Ox+Ovp8Wc5tDjtL
cLvtXul0pL0Q7sr9jwSPS1cCyqbTENLnS1TF3tM0XDLskIZKHxo8zMJ2yP3H
f+LRa3RYNenR3WUSNnqI9w35paCrFDpZb+yBkttzD86moLYJnaRY7II/FK6N
HCnopmJFci22ieXxUwqhyehwRq8C/woJGdo6CcGRSahNRTavENv3+Ez17TMJ
6D1nXFc9tlS265/I2nhkMzdd2I3dIcIqhjTikaedY9QytvAGQZ8tOq9QIHvL
yKlVHL+dquplJi9QRFNFrTa2mWab8zA1DnHLJxtfxWZDxhncZnFITOfUG1fs
S2nWG8ytYpHd0ZbuQuwph9hPXI7P0TiDtnUNdjRt9/LRhWiUN11Z2oateCVb
yuxRNPK3dnMZww5Urgl57xmFzI30/PnXSBDn+aXzX2gEcsgy/yaO3ezj7BGw
OQKN+t/plsa2W6TPzY98hv6x6rCoYVf28/KwvQhHUmed/tzFLrzqmXFd5yka
WHT95Ijtq7/34CvjUFTwScv0MbaRRkt+l3kIUpvVyg7FXjq8A+m4BiERE7d7
0evr7UEqQX6B6AKj8/Ar7FcC5k11zwLQjFwjcxb2aebcb4pv/JB+s0hWHjbP
0iUTlwJfNFmpwlmCPTS53F+AfFAhMbr4cX39Lo2J/d+90VuOu35N6+u3TNpa
Dngh89zi1s/YEtWR88kTnqjaOjewe339zH4GfkYPRP/MdK0P+4QS1+ZMwcfo
9MmvBwaxqZKXBUVlXVGC3TbeYWzPra/3xp59iJYURIpHscVWp2S4rz1AI8/m
t/zCrh85ecrPyQkVecdITGHfbvc/uxrsgJw2Mi3OYHOVfjVwTLFDo0eOe81h
56QKX5sosUERy8dr57HTBLu/1yXeQ5SbLNWL2BO/bX4VtNxCMjYvH/zDlqlh
Y0pZMketwiu0ZWzn6ET+8L1maMp535ZV7IcdNmarGVdQmZPQ/LqZHyY+JRgu
oq1CZOQatohSosu9knMo8v7tiXXbCK6laxLyKMKqcmXdT8Q3hGxcFAJhzoGG
dcd2Kjnf2q8M7JebtdatpGob2nXiAnzT9gpef35hvNL15QEjqJ5g8FnB3rbM
xs+tcg0+H9Y+ur6/z/tsGUW334QcwZspS9gBF7snZMcsoTtTpXEBW9lL6btq
+R2w7/ud8Rd7NfsNMgyzBkuK+ZlZ7N5f/l8Lcm3BYFda1DT2MSbFRsUX9hAj
mZs8iR3NP11e98QRzrb63hrH/iP9Ok/nvjMosO4dG8HWVb+c3mXoAh8k6/n6
sdkdqsLGJN0gmqu+rgfbMtDRx36rO4BT+MFObLO2rYqrjz0gos5nf8t6vA83
HPaz8gLjVEplPfbktGiWpqk3SM6mbKrG3rniuodb7wmId4wThevnv+WwQOwJ
X1C5BIYU7AyhoChTaT+4IGsakoHdKfFzk6i4P+zun98Thy13OpYpc2MgjB3N
2PRw/fl36SfLBkJg9RAt1gZbek1KXW08FH699G23wLYPN0r8PPsUHqdTNfSw
lwlDiWnGcAiUWDJcz1+Ptewexu0RIOwopbUDO6lBxb/hRQTsaiv7zYldHU7I
hQhHguvD+ZN/cD1gFmMJ5ZWMgrK/X+ZL1+uDhulpCcXnALyzhu+wMzf/mfhV
9Rze19uZx2M3E/6xeWoxkBbn7++OvfFewcwJ3VgIYdj6WxE7IpzjtfaNF2BA
iVHMxPXuJVGywSEgAZ7PB9g/x6a27zURZE2E3tDOS97Y1u/tch+fTYSn5/3E
jbHD3NmuKrcmwoOr8kOM2F82yxU1dyaBvE0ZqY7rsaF80C1yLAWiBizGD2LT
+L8jpQOpMLN6J3Ub9oM1Yd5U61SoqPcRGsT1P67hfbXVbCoYKc/KOGP3Gg8K
zKy8BppcUm847ifX3I+1Mm3OgGq/6BpH7OWWP8S8dgZ0i4WbXcaOFcweGQvO
AN+mqIZd2F9KROnb2d5AQEi33JtFElRmOeRe0b2FnbrSodm4f+27RY09MpUJ
5YfuzoVgfyyKSdt3MAsq72RuvYd9nUU/X+BuFnjayz6SxI5LqW+mp2XBKIcF
LQn3Q05qzloL+Q46KuWVvXH/nNbzNrf4TAEfqRjJq9j1bUIlWSw50FS+1KiA
vW3hEaSJ58CNkmrpX7g/56nJn4+9kQMbycvxetjjQ2/N3ckcKFXzWty03t+F
ImM0O3NBP/F5tgGeF5QiLFaH6vLh66pjoSi23fgrYSdaPpSrlFlO4fkjWfnb
GTb2ApiLdm8NxGaaVfaT0ioA4RwitfQ3nkcNRLgdOwrglnKWA9ckCed5e0VY
+gvB8+1svC2ef4xiL6juWyyCWSMDniPYAdP+lh/4i6GOsuXwwigJH85WBpw/
WQxH5HJs3LAFlg622rgXw2S40YI3DceLMadhCXMJuIqKS3ji+eumYL3VOZ4P
wD8SvPHkIK5fCSeD7+4vg2/2rsf/DuB++G2g8fr5MqhZbN+ag23D6cdqeK8M
CrLffRXFtnVp91KilEHsdyFPpn78vvoWLryy5SBelBBc3IfnBdYwi8rjFXBS
uvbOUBcJZUW2wuzilaCnVSiv0koC2lW7ZCpXDXy+chunWkjwipKtL1OuBg32
5PgX2GocyREC+tVQm6w2Nt2M8+XvY6lu22p4Wpsl9eITCV0tClcNKNVwxi7J
tL8B7/dRVtU5yRo4l1997wie30W7IvyPCn+EDZmZMuz4PuATZsa7mbMOflgR
KS/wfeGDUIV0mWAd/JO5XCWFPZm1Q9PyQB009KvQa+P7xqXGNvdy7TpwhbrI
4Hwcjwwweiu8DrjSlzcsUUhoshcoq+athyuRHhLR+L7Cbfj1uoNIA/wM6t/Z
EYPjcafau075JtiVxyT7wxnnp6Zw5hv+VnDl6/kuqY/zQcQkyHquDaRthXov
7sHxsb9xdQtrB9AecKe0z1OBwzdP/NTcV9huvKCjUkmFl5On2Gc4O0HBweJj
mB8VgtPVkvfTd+O6Rxyz1qSCg6rUdPQ4AYuPHRYEmKngPV2wErTWC0h3sP1t
RR/M/CouZ5migpOb+trme32gskx5xezTD5ezf8683N4HHA4zRcIhA8AyL9/C
V9MLDJEzmY+9B4FuEy+vjFkvcJ34+DgpdAhyyztcaxh6QT1Qfz+r/w9gYKPt
80vsgZVPF/J9XH/CcwqfyTvpHqiPFOFv9BmGNdU2XYMaAqqYKcY6biNgePsU
3/UqAjzeHotL9ByBnbIq7vcQAad0PnZP+4xAYCeHlE8pAWUx3UaRofh/XaDL
ySegeD+TYXfCCJze8jXsTwoB2Rcu69+oHgFnF1eQeULAy1eM551ZadDsGz4r
40WAyZnQoAYOGqTJDGvIeuD7/gjfpx3cNKAeV/4s40pAjPTBc2V8NJArc9M7
4EBARI2RBr0kDSiD7tLcNwkIHH2nEnSeBv0PT3WxmxFwNlThSa8uDW6XbtrF
fI0ANtmamgMXaZA8QA1YMCHAx7XrTJspDez1+zsIffx+mxiVtlnToKjmh/2X
CwRAQYiHhT0Nenf/zGvUIWDViK+yyJkGxpqtXEWaBLgmHwBjD7y/K7kS784S
cEK9+HHmExrEzzz5kaxOwNL4mYplfxrwSKudilHF5xHWsqIVQoP/+x4C/wNQ
5TNL
          "]]},
        Annotation[#, "Charting`Private`Tag$73588#1"]& ]}, {}}}, {{{}, {}, 
      TagBox[
       {GrayLevel[0], AbsoluteThickness[1.6], Opacity[1.], CapForm["Round"], 
        JoinForm["Round"], FaceForm[Opacity[0.3]], LineBox[CompressedData["
1:eJxTTMoPSmViYGAwAWIQDQEcDpxWa+c+sji2H8b/Vbw5yuLkUTj/1dqd4n2R
CP7PiSvbCtKPwPk9t/Lj41oPw/m3HwhU715+CM6PCJ/a7b/9IJwfafSB9f21
A3A+/++YV13H98P5T3n6/cRe7YXzjzzPbduhswfO/7dIeMUJz11wvoN62tz3
bTvg/N9qeRJfz2yD8wXZbWsz3m6B8w027Nj6SXcznL/S8vf1Vx4b4Xzz2mf/
m26ug/P1JA2+xyauhvNvlbIfEpm3HM6fnmJh8lNqCZzPJfK9cqfPAjj/Xonj
tFyFmXD+qafu7YfVJ8H5zhsu2y0ybIXzr5Z8N7wQmAPnW2VseCDOnm0P41fz
zV834UgrnB9092py0OOJcP7vjQ4nl1TNhPMTzrzqtitfAOdvWnub+++HxXC+
3zm7Hfe3Lofzb8Z47J1itRrOL/zybFvP2nVw/qqn1XlXTDfC+cId19ee/rIJ
zlf0ymEOvbkFzld3Dmk9PncbnL/lQFtjdOQOOP9Z7KfJjVa74Hx+o42XJvze
DeffU12pbvRoL5xvPO/1ty/798P5+5c5VF7YdwDOt+DTaMrfcBDO1xW0VGSe
dAjOTw3Lr1XPPwznF2gfeiISfwTO/z7b7tE3u6NwPsPrr/vf7EbwofnFHgAL
CfMA
         "]]},
       Annotation[#, "Charting`Private`Tag$73615#1"]& ]}, {}}}, 
   {Thickness[Tiny], 
    LineBox[{{-0.3, -0.8}, {0.17777777777777798`, -0.8}, {
     0.41037302366101, -0.7677761266838121}, {3., 0.1736109990983581}}], 
    LineBox[{{-0.3, -0.67}, {0.12736963880034197`, -0.67}, {
     0.43951024180582887`, -0.6321440055726345}, {3., 0.14026841929913003`}}],
     LineBox[{{-0.3, -0.54}, {0.08428334313174163, -0.54}, {
     0.46204636036303914`, -0.5015812850223939}, {3., 0.11325175169316148`}}],
     LineBox[{{-0.3, -0.41000000000000003`}, {
     0.049334737647560745`, -0.41000000000000003`}, {
     0.47875852201325847`, -0.37571086337486215`}, {3., 
     0.08789724844292979}}], 
    LineBox[{{-0.3, -0.28}, {0.02327619836534567, -0.28}, {
     0.49031885376008016`, -0.2538646299512427}, {3., 0.06168891434189794}}], 
    LineBox[{{-0.3, -0.15000000000000002`}, {
     0.006729620493605537, -0.15000000000000002`}, {
     0.4972632949796801, -0.13504521680200265`}, {3., 0.03377501131688865}}], 
    LineBox[{{-0.3, 0.14}, {0.005864523314830394, 0.14}, {
     0.49761793571256424`, 0.12599505685793785`}, {
     3., -0.031562071951849124`}}], 
    LineBox[{{-0.3, 0.27}, {0.021658901395650243`, 0.27}, {0.4910111509776428,
      0.24463209262543484`}, {3., -0.05960371893303512}}], 
    LineBox[{{-0.3, 0.3999999999999999}, {0.04700570851514535, 
     0.3999999999999999}, {0.4798229213732998, 0.36620587517054665`}, {
     3., -0.08593156791584289}}], 
    LineBox[{{-0.3, 0.53}, {0.0812959367971251, 0.53}, {0.4635294088512824, 
     0.49173892494498195`}, {3., -0.11128613174171065`}}], 
    LineBox[{{-0.3, 0.6599999999999999}, {0.1237847959331092, 
     0.6599999999999999}, {0.4414676738429832, 0.6219240102360547}, {
     3., -0.13804056662932251`}}], 
    LineBox[{{-0.3, 0.79}, {0.1736591282317974, 0.79}, {0.41286791574102866`, 
     0.7571582143906004}, {3., -0.17066993425541976`}}]}},
  Axes->True,
  PlotRange->All]], "Output",
 CellChangeTimes->{
  3.800067339064988*^9, {3.8000673907956743`*^9, 3.800067404264859*^9}, 
   3.8000677238413486`*^9, 3.800067783833794*^9, {3.8000682700742407`*^9, 
   3.8000682756425247`*^9}, 3.800068329619916*^9, {3.800068403101495*^9, 
   3.8000684118025103`*^9}, 3.800068481412848*^9, {3.800078157931006*^9, 
   3.800078176357664*^9}, 3.800582281318087*^9},
 CellLabel->"Out[37]=",ExpressionUUID->"4514b757-fec1-4edb-bd35-318dbe020e5f"]
}, Open  ]]
}, Open  ]]
},
AutoGeneratedPackage->Automatic,
WindowSize->{808, 911},
WindowMargins->{{566, Automatic}, {Automatic, 82}},
TaggingRules->{"TryRealOnly" -> False},
FrontEndVersion->"12.3 for Mac OS X x86 (64-bit) (2021\:5e747\:67089\:65e5)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"08cc2ca2-ca27-4bf6-ba33-1810f2b0ab98"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 154, 3, 98, "Title",ExpressionUUID->"bd77d8b9-ddd6-4352-84b5-e011fe087a9e"],
Cell[737, 27, 335, 8, 83, "Author",ExpressionUUID->"4663285c-c5a1-4b3e-8f0e-e482112a9b72"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1109, 40, 245, 6, 98, "Title",ExpressionUUID->"c632e24e-bfbf-4861-addf-2a3ce16d7c98",
 InitializationCell->True,
 InitializationGroup->True],
Cell[1357, 48, 417, 9, 46, "Input",ExpressionUUID->"c4dad22a-e253-45c3-a9f6-f6357ff3ab9d",
 InitializationCell->True],
Cell[1777, 59, 672, 15, 68, "Input",ExpressionUUID->"e5ad6f70-fbf9-4ccb-8ca1-50d1ac2b0e77",
 InitializationCell->True,
 InitializationGroup->True],
Cell[2452, 76, 697, 15, 89, "Input",ExpressionUUID->"d9576c46-463c-492d-b034-3bcacbafe45f",
 InitializationCell->True,
 InitializationGroup->True],
Cell[3152, 93, 1159, 23, 278, "Input",ExpressionUUID->"4289103f-0ce8-4a3d-abdf-bc5006c7d7b1",
 InitializationCell->True,
 InitializationGroup->True],
Cell[CellGroupData[{
Cell[4336, 120, 248, 6, 67, "Section",ExpressionUUID->"749bde2e-b94f-47db-927e-e7866659b9ce",
 InitializationCell->True,
 InitializationGroup->True],
Cell[4587, 128, 492, 12, 46, "Input",ExpressionUUID->"7ed7ac50-c244-465e-bea1-6d337dd93afe",
 InitializationCell->True,
 InitializationGroup->True],
Cell[CellGroupData[{
Cell[5104, 144, 154, 3, 54, "Subsection",ExpressionUUID->"29e93e61-28e6-424d-9cac-d6669b0acbaa"],
Cell[5261, 149, 847, 19, 131, "Input",ExpressionUUID->"de006e79-6ee6-4893-bb29-2950294a7c3f",
 InitializationCell->True,
 InitializationGroup->True],
Cell[6111, 170, 479, 12, 68, "Input",ExpressionUUID->"ed56e84a-9522-4cd3-a682-b832b2b3ff1a",
 InitializationCell->True,
 InitializationGroup->True],
Cell[6593, 184, 450, 12, 68, "Input",ExpressionUUID->"afd1100e-db76-449d-9e2b-05d0a957ffc7",
 InitializationCell->True,
 InitializationGroup->True],
Cell[7046, 198, 449, 12, 68, "Input",ExpressionUUID->"182fa958-ac10-4d7b-b771-0408f5a15993",
 InitializationCell->True,
 InitializationGroup->True],
Cell[7498, 212, 516, 11, 89, "Input",ExpressionUUID->"1b58d1b7-7bfa-4c72-9aba-560c2525886e",
 InitializationCell->True,
 InitializationGroup->True],
Cell[8017, 225, 860, 17, 152, "Input",ExpressionUUID->"9fc6fcef-d93d-4100-b278-caf02a32383a",
 InitializationCell->True,
 InitializationGroup->True],
Cell[8880, 244, 820, 16, 131, "Input",ExpressionUUID->"fb179b2d-5116-47bb-8b4a-6ab16626c866",
 InitializationCell->True,
 InitializationGroup->True],
Cell[9703, 262, 820, 16, 131, "Input",ExpressionUUID->"98ca9263-8ef0-49a5-87cb-8868eb01fe45",
 InitializationCell->True,
 InitializationGroup->True],
Cell[10526, 280, 649, 14, 131, "Input",ExpressionUUID->"3fb01604-87bf-480b-babe-cc47d6424521",
 InitializationCell->True,
 InitializationGroup->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[11212, 299, 156, 3, 54, "Subsection",ExpressionUUID->"c69d0597-cfb7-4847-aec9-43e1ab6ff9ac"],
Cell[11371, 304, 447, 11, 46, "Input",ExpressionUUID->"96f18801-102b-4424-bd87-bc54036b20ae",
 InitializationCell->True,
 InitializationGroup->True],
Cell[11821, 317, 414, 10, 46, "Input",ExpressionUUID->"4a6a612c-7df6-4acf-b2cb-b4908d65cc43",
 InitializationCell->True,
 InitializationGroup->True],
Cell[12238, 329, 747, 16, 110, "Input",ExpressionUUID->"7e4c78bf-97d6-45f7-ba3e-334870141e92",
 InitializationCell->True,
 InitializationGroup->True],
Cell[12988, 347, 646, 14, 68, "Input",ExpressionUUID->"db02f791-25b7-4f76-888e-39ac40f10600",
 InitializationCell->True,
 InitializationGroup->True],
Cell[13637, 363, 662, 14, 110, "Input",ExpressionUUID->"fc264c2e-b98a-494e-91f8-fc951a454c46",
 InitializationCell->True,
 InitializationGroup->True],
Cell[14302, 379, 730, 15, 110, "Input",ExpressionUUID->"d2b01480-9537-4e08-bff0-d728977c4184",
 InitializationCell->True,
 InitializationGroup->True],
Cell[15035, 396, 1230, 32, 194, "Input",ExpressionUUID->"165e07b4-4c00-4df0-8afb-5c8c38b64208",
 InitializationCell->True,
 InitializationGroup->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[16302, 433, 161, 3, 54, "Subsection",ExpressionUUID->"e98d8979-8eee-4bdb-ab3b-bc5c9b8d9456"],
Cell[16466, 438, 609, 14, 131, "Input",ExpressionUUID->"53a847b4-8e1d-4216-91d1-dd862b5b5b63",
 InitializationCell->True,
 InitializationGroup->True],
Cell[17078, 454, 660, 16, 110, "Input",ExpressionUUID->"39fe73b2-507a-4b86-97ae-11d00f126200",
 InitializationCell->True,
 InitializationGroup->True],
Cell[17741, 472, 546, 12, 89, "Input",ExpressionUUID->"872ae007-0a80-4034-a3e9-ac7fc920c3ae",
 InitializationCell->True,
 InitializationGroup->True],
Cell[18290, 486, 662, 14, 110, "Input",ExpressionUUID->"2dd9ef8b-560f-4519-b437-1b67dbdaad80",
 InitializationCell->True,
 InitializationGroup->True],
Cell[18955, 502, 459, 12, 68, "Input",ExpressionUUID->"f784cd6c-7841-4478-b0f1-251f4b68bb37",
 InitializationCell->True,
 InitializationGroup->True],
Cell[19417, 516, 1045, 19, 194, "Input",ExpressionUUID->"b3e89b1b-bc61-40a8-9ce7-719599d88014",
 InitializationCell->True,
 InitializationGroup->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[20499, 540, 171, 3, 54, "Subsection",ExpressionUUID->"e5aad225-da8f-49f6-8c9d-9fe2de85d907"],
Cell[20673, 545, 511, 11, 110, "Input",ExpressionUUID->"093125e7-13da-4c61-863d-044d62c8cfa8",
 InitializationCell->True,
 InitializationGroup->True],
Cell[21187, 558, 924, 23, 89, "Input",ExpressionUUID->"79fa3684-ba6c-4a0d-a033-e0518e378172",
 InitializationCell->True,
 InitializationGroup->True],
Cell[22114, 583, 1028, 25, 110, "Input",ExpressionUUID->"b43507d1-1883-4d8d-bbb8-15f858e3c0fa",
 InitializationCell->True,
 InitializationGroup->True],
Cell[CellGroupData[{
Cell[23167, 612, 157, 3, 45, "Subsubsection",ExpressionUUID->"241440ec-7a7a-44dc-9eff-c7703d929456"],
Cell[23327, 617, 476, 12, 46, "Input",ExpressionUUID->"2e5d30e6-cbcf-4187-ae84-17088012ab61",
 InitializationCell->True,
 InitializationGroup->True],
Cell[23806, 631, 490, 12, 68, "Input",ExpressionUUID->"7a6878be-b83f-4ac6-9ed8-7ecbfff85e31",
 InitializationCell->True,
 InitializationGroup->True],
Cell[24299, 645, 493, 11, 89, "Input",ExpressionUUID->"cbe6f618-aade-4667-aaf8-3b9bb29d8ac0",
 InitializationCell->True,
 InitializationGroup->True],
Cell[24795, 658, 539, 13, 89, "Input",ExpressionUUID->"a12c7a7f-70ec-469c-a889-21281dbff1e9",
 InitializationCell->True,
 InitializationGroup->True],
Cell[25337, 673, 456, 12, 89, "Input",ExpressionUUID->"f31221cf-eab1-4ecb-a18a-2f5fac191af5",
 InitializationCell->True,
 InitializationGroup->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[25830, 690, 161, 3, 45, "Subsubsection",ExpressionUUID->"d4ef99d5-643c-40bc-87c5-810a2407d6b2"],
Cell[25994, 695, 801, 16, 131, "Input",ExpressionUUID->"2ef3d792-4fb7-4e36-9c01-9a75fc0a52ef",
 InitializationCell->True,
 InitializationGroup->True],
Cell[26798, 713, 608, 13, 89, "Input",ExpressionUUID->"bf3c9abe-d342-485b-94f6-69fdb4a99e6a",
 InitializationCell->True,
 InitializationGroup->True],
Cell[27409, 728, 1010, 18, 110, "Input",ExpressionUUID->"1ee19320-04b8-453d-9658-a783849441c4",
 InitializationCell->True,
 InitializationGroup->True],
Cell[28422, 748, 1253, 22, 110, "Input",ExpressionUUID->"39eff147-0192-45f7-8f0a-282883edd76c",
 InitializationCell->True,
 InitializationGroup->True],
Cell[29678, 772, 1153, 21, 68, "Input",ExpressionUUID->"063b85d7-f739-4bc1-a6bf-7890cb00a6bd",
 InitializationCell->True,
 InitializationGroup->True],
Cell[30834, 795, 550, 13, 68, "Input",ExpressionUUID->"bfe8fbfe-e3fa-4f82-99d8-0fa8cf27e626",
 InitializationCell->True,
 InitializationGroup->True],
Cell[31387, 810, 771, 16, 89, "Input",ExpressionUUID->"b2dd01b2-10c2-47d7-8101-590a80da98ad",
 InitializationCell->True,
 InitializationGroup->True],
Cell[32161, 828, 748, 16, 68, "Input",ExpressionUUID->"461cc410-9421-4244-ba80-fa5609fc3190",
 InitializationCell->True,
 InitializationGroup->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[32946, 849, 157, 3, 45, "Subsubsection",ExpressionUUID->"79d85e4e-1328-4f52-8687-3a0367557b99"],
Cell[33106, 854, 727, 15, 131, "Input",ExpressionUUID->"b5405154-d1c8-4187-874a-bf1ac0ae02c3",
 InitializationCell->True,
 InitializationGroup->True],
Cell[33836, 871, 539, 12, 89, "Input",ExpressionUUID->"cdae859d-a21d-4464-8f63-492d2d9130de",
 InitializationCell->True,
 InitializationGroup->True],
Cell[34378, 885, 484, 12, 46, "Input",ExpressionUUID->"4ce2fccc-f431-4c3e-a2fc-d5b7c97edcfd",
 InitializationCell->True,
 InitializationGroup->True]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[34911, 903, 170, 3, 54, "Subsection",ExpressionUUID->"ef06c41c-511b-46ba-bd8a-bc9fae8752bf"],
Cell[35084, 908, 467, 12, 89, "Input",ExpressionUUID->"f1a388a4-74d2-4b5f-9db7-d86e80c6c355",
 InitializationCell->True,
 InitializationGroup->True],
Cell[35554, 922, 539, 12, 89, "Input",ExpressionUUID->"86e0f0b6-b337-4ff6-af71-9432f5fdbf4b",
 InitializationCell->True,
 InitializationGroup->True],
Cell[36096, 936, 615, 13, 89, "Input",ExpressionUUID->"c8cccb90-4dcc-4934-bc14-97ab01ee932e",
 InitializationCell->True,
 InitializationGroup->True],
Cell[36714, 951, 431, 11, 89, "Input",ExpressionUUID->"4de1a616-382f-4146-9802-b2244bcdd741",
 InitializationCell->True,
 InitializationGroup->True],
Cell[37148, 964, 551, 12, 68, "Input",ExpressionUUID->"84356d43-2d2e-4006-a357-cb1590add8e2",
 InitializationCell->True],
Cell[37702, 978, 600, 12, 89, "Input",ExpressionUUID->"9dfc148a-3569-49e3-9737-4eb02f7e31fe",
 InitializationCell->True],
Cell[38305, 992, 922, 17, 110, "Input",ExpressionUUID->"c3669929-44c6-4c5d-afa5-9547a641bcb0",
 InitializationCell->True],
Cell[39230, 1011, 613, 12, 89, "Input",ExpressionUUID->"fcabd3b4-4dcd-4560-beb0-8cca6f9de9a7",
 InitializationCell->True],
Cell[39846, 1025, 778, 15, 110, "Input",ExpressionUUID->"a6d27493-7027-4eb0-9ca9-fac2e51d0a90",
 InitializationCell->True],
Cell[40627, 1042, 560, 12, 46, "Input",ExpressionUUID->"381ca392-deac-4e8b-b680-ce72c53b0743",
 InitializationCell->True]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[41236, 1060, 238, 5, 67, "Section",ExpressionUUID->"f869ae36-e476-44fd-b45e-9c7e5dd76568",
 InitializationCell->True],
Cell[41477, 1067, 355, 9, 46, "Input",ExpressionUUID->"18130e7a-b01b-415b-919b-cbad94e88a8c",
 InitializationCell->True,
 InitializationGroup->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[41869, 1081, 256, 6, 67, "Section",ExpressionUUID->"738493a8-e07c-45d1-972a-d6a6d6efabbd",
 InitializationCell->True,
 InitializationGroup->True],
Cell[42128, 1089, 1766, 32, 89, "Input",ExpressionUUID->"75c78a3c-99b5-4e7c-b041-5c4b52917af7",
 InitializationCell->True,
 InitializationGroup->True],
Cell[CellGroupData[{
Cell[43919, 1125, 247, 6, 54, "Subsection",ExpressionUUID->"a77599ee-3de3-4b58-bc3b-ed5d5877bc4f",
 InitializationCell->True,
 InitializationGroup->True],
Cell[44169, 1133, 7213, 171, 866, "Input",ExpressionUUID->"8eb44ccf-50bf-45d4-b335-0312751cfeb8",
 InitializationCell->True,
 InitializationGroup->True],
Cell[51385, 1306, 1649, 30, 68, "Input",ExpressionUUID->"4d84905a-5a08-41ac-8a15-de5b8b82ad19",
 InitializationCell->True,
 InitializationGroup->True],
Cell[53037, 1338, 489, 11, 46, "Input",ExpressionUUID->"119d8a14-786b-497e-9b8e-007fee6b550f",
 InitializationCell->True,
 InitializationGroup->True],
Cell[53529, 1351, 1297, 37, 89, "Input",ExpressionUUID->"789b8c34-9ea4-4d99-81cd-5d5d5a51b806",
 InitializationCell->True,
 InitializationGroup->True],
Cell[54829, 1390, 1264, 36, 89, "Input",ExpressionUUID->"db0886dc-19b0-466a-a17f-10c6696d1e36",
 InitializationCell->True,
 InitializationGroup->True],
Cell[56096, 1428, 882, 22, 68, "Input",ExpressionUUID->"f18df512-0bfa-41c7-84bb-049381804c05",
 InitializationCell->True,
 InitializationGroup->True],
Cell[56981, 1452, 1297, 33, 110, "Input",ExpressionUUID->"6575cb90-6863-4280-af11-06cfd9d2d1ee",
 InitializationCell->True,
 InitializationGroup->True],
Cell[58281, 1487, 1349, 33, 131, "Input",ExpressionUUID->"2053d5a7-1c3f-4553-8ea9-88562a2d912c",
 InitializationCell->True,
 InitializationGroup->True],
Cell[59633, 1522, 722, 15, 89, "Input",ExpressionUUID->"3e45eb02-c990-4c31-87e3-80bdb7678b99",
 InitializationCell->True,
 InitializationGroup->True],
Cell[60358, 1539, 957, 25, 131, "Input",ExpressionUUID->"7d1eb72b-9645-4de1-b2dc-27a39c9344c5",
 InitializationCell->True,
 InitializationGroup->True],
Cell[61318, 1566, 633, 13, 46, "Input",ExpressionUUID->"f57df671-ff22-467d-8d14-d8ca58e29207",
 InitializationCell->True,
 InitializationGroup->True],
Cell[61954, 1581, 1218, 32, 110, "Input",ExpressionUUID->"d3a2c92a-d903-4d56-9b69-a257abb694cc",
 InitializationCell->True,
 InitializationGroup->True],
Cell[63175, 1615, 2525, 64, 236, "Input",ExpressionUUID->"bf3be655-9617-4048-95ac-6fe87f3885d8",
 InitializationCell->True,
 InitializationGroup->True],
Cell[65703, 1681, 1229, 29, 110, "Input",ExpressionUUID->"0f6144c3-dc4f-4c9f-91d0-2389909f45a6",
 InitializationCell->True,
 InitializationGroup->True],
Cell[66935, 1712, 2728, 68, 299, "Input",ExpressionUUID->"d6fe9365-c81d-4431-807d-228f7d50d915",
 InitializationCell->True,
 InitializationGroup->True],
Cell[69666, 1782, 4259, 113, 320, "Input",ExpressionUUID->"09458643-a69d-4d2a-85cb-a524f0d8fbe5",
 InitializationCell->True,
 InitializationGroup->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[73962, 1900, 242, 6, 54, "Subsection",ExpressionUUID->"389ec9a6-9b9b-4a1e-95e2-00e0890a5b6d",
 InitializationCell->True,
 InitializationGroup->True],
Cell[74207, 1908, 1743, 44, 110, "Input",ExpressionUUID->"0a25a690-cfb4-48ad-89fe-1972742957a8",
 InitializationCell->True,
 InitializationGroup->True],
Cell[75953, 1954, 1029, 19, 46, "Input",ExpressionUUID->"233d4a49-01ef-49ad-b198-de33ca0b991c",
 InitializationCell->True,
 InitializationGroup->True],
Cell[76985, 1975, 1463, 40, 131, "Input",ExpressionUUID->"183ed3f3-fd60-4ddf-a8ef-3a5cbd2da61a",
 InitializationCell->True],
Cell[78451, 2017, 661, 12, 46, "Input",ExpressionUUID->"51bfd457-2e8a-4991-9024-9690078c2c6e",
 InitializationCell->True,
 InitializationGroup->True],
Cell[79115, 2031, 1803, 43, 131, "Input",ExpressionUUID->"a7d95f2f-93f7-48e4-a15d-935e4ba147de",
 InitializationCell->True,
 InitializationGroup->True],
Cell[80921, 2076, 1015, 31, 68, "Input",ExpressionUUID->"ea6d5175-72d2-49ff-a522-dce3dc3440ec",
 InitializationCell->True,
 InitializationGroup->True],
Cell[81939, 2109, 1872, 55, 152, "Input",ExpressionUUID->"be057dca-ff09-4a6e-8e01-8dfa060c7faa",
 InitializationCell->True,
 InitializationGroup->True],
Cell[83814, 2166, 666, 18, 68, "Input",ExpressionUUID->"096b78ce-e164-4781-ab1e-72508d99cf3c",
 InitializationCell->True,
 InitializationGroup->True],
Cell[84483, 2186, 1642, 48, 110, "Input",ExpressionUUID->"836824c6-c5a1-47d1-b475-d6319927ff08",
 InitializationCell->True,
 InitializationGroup->True],
Cell[86128, 2236, 1599, 47, 152, "Input",ExpressionUUID->"cbf5282f-a66f-4e17-91e5-94dffa3a8cfb",
 InitializationCell->True,
 InitializationGroup->True],
Cell[87730, 2285, 593, 14, 46, "Input",ExpressionUUID->"0981966b-9e20-4287-a0a7-ca3c67e7a172",
 InitializationCell->True,
 InitializationGroup->True],
Cell[88326, 2301, 1137, 34, 89, "Input",ExpressionUUID->"6defa6e0-352d-4839-8942-3f9ec39e4a75",
 InitializationCell->True,
 InitializationGroup->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[89500, 2340, 249, 6, 54, "Subsection",ExpressionUUID->"c48fb6b9-9563-4df0-958d-06cdd0474c58",
 InitializationCell->True,
 InitializationGroup->True],
Cell[89752, 2348, 582, 12, 46, "Input",ExpressionUUID->"94c69d41-c539-43be-9239-5ffc9b324374",
 InitializationCell->True,
 InitializationGroup->True],
Cell[90337, 2362, 1164, 33, 89, "Input",ExpressionUUID->"c4581d23-41f9-49a2-beb8-c0bb465a4896",
 InitializationCell->True,
 InitializationGroup->True],
Cell[91504, 2397, 1589, 37, 110, "Input",ExpressionUUID->"e4e960dd-0d66-45e2-afe6-41fd565f3fcc",
 InitializationCell->True,
 InitializationGroup->True],
Cell[93096, 2436, 7280, 178, 614, "Input",ExpressionUUID->"97469671-630a-49de-ad53-3666f7311a7f",
 InitializationCell->True,
 InitializationGroup->True],
Cell[100379, 2616, 6157, 148, 383, "Input",ExpressionUUID->"87a8bf67-462f-4749-9504-c45914e70343",
 InitializationCell->True,
 InitializationGroup->True],
Cell[106539, 2766, 2212, 52, 278, "Input",ExpressionUUID->"87e451a9-a622-4bf7-bc4c-a90c97384cb5",
 InitializationCell->True,
 InitializationGroup->True],
Cell[108754, 2820, 2107, 53, 173, "Input",ExpressionUUID->"accedfff-d77e-4cd9-ba58-9e6b136968d9",
 InitializationCell->True,
 InitializationGroup->True],
Cell[110864, 2875, 3458, 86, 362, "Input",ExpressionUUID->"18f303b1-7d92-463c-beed-5b1c8f150539",
 InitializationCell->True,
 InitializationGroup->True],
Cell[114325, 2963, 1912, 53, 110, "Input",ExpressionUUID->"eb5833fd-e6d9-452a-8b16-d2d86dd712b8",
 InitializationCell->True,
 InitializationGroup->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[116274, 3021, 315, 7, 54, "Subsection",ExpressionUUID->"c8f1572e-44c0-44c9-b021-e9de359f424d",
 InitializationCell->True,
 InitializationGroup->True],
Cell[116592, 3030, 491, 12, 104, "Text",ExpressionUUID->"c85d8ddf-d758-4844-a790-90a6ce7e6578",
 InitializationCell->True],
Cell[117086, 3044, 2999, 64, 173, "Input",ExpressionUUID->"85878c51-1c4a-4582-872c-114edf74e966",
 InitializationCell->True,
 InitializationGroup->True],
Cell[120088, 3110, 1955, 34, 68, "Input",ExpressionUUID->"bba909c5-dc2c-4423-9b02-72e5b81a9df2",
 InitializationCell->True,
 InitializationGroup->True],
Cell[122046, 3146, 2040, 38, 68, "Input",ExpressionUUID->"d1898dce-c5f5-43b2-a0e8-2c6fa61b8c36",
 InitializationCell->True,
 InitializationGroup->True],
Cell[124089, 3186, 2668, 58, 131, "Input",ExpressionUUID->"b36e6e42-ada1-4a7c-bd8d-388c977ec5d8",
 InitializationCell->True,
 InitializationGroup->True],
Cell[126760, 3246, 2651, 64, 110, "Input",ExpressionUUID->"638c01e5-7051-4f28-bd37-c0f2eec3f1bf",
 InitializationCell->True,
 InitializationGroup->True],
Cell[129414, 3312, 3161, 78, 152, "Input",ExpressionUUID->"d38f7d62-e082-45f2-bc4a-1b2c45283cd5",
 InitializationCell->True,
 InitializationGroup->True],
Cell[132578, 3392, 823, 20, 68, "Input",ExpressionUUID->"6aba6cde-c02c-46d8-86ed-058725e074af",
 InitializationCell->True,
 InitializationGroup->True],
Cell[133404, 3414, 3525, 85, 173, "Input",ExpressionUUID->"3538902b-7ad6-476b-9de8-2ce744b98608",
 InitializationCell->True,
 InitializationGroup->True],
Cell[136932, 3501, 1200, 30, 89, "Input",ExpressionUUID->"eef9ff16-c323-45a2-bf5c-e2cd41f138f4",
 InitializationCell->True,
 InitializationGroup->True],
Cell[138135, 3533, 2703, 63, 173, "Input",ExpressionUUID->"a66a2ea0-832a-4a2b-a38b-5c3b6a290bda",
 InitializationCell->True,
 InitializationGroup->True],
Cell[140841, 3598, 1665, 30, 68, "Input",ExpressionUUID->"d76219df-4b01-4bbc-abc9-6c369999666c",
 InitializationCell->True,
 InitializationGroup->True],
Cell[142509, 3630, 868, 22, 68, "Input",ExpressionUUID->"ee0442f9-9c72-4376-bc3b-03720857a7dc",
 InitializationCell->True,
 InitializationGroup->True],
Cell[143380, 3654, 1810, 47, 257, "Input",ExpressionUUID->"c38adddb-ab19-414d-b6e5-1305944fd27a",
 InitializationCell->True,
 InitializationGroup->True],
Cell[145193, 3703, 2303, 70, 173, "Input",ExpressionUUID->"94dabc3c-f60a-49c5-891a-78868e5fefa7",
 InitializationCell->True],
Cell[147499, 3775, 485, 12, 46, "Input",ExpressionUUID->"99c36184-dc47-4b0f-9b56-6630980df05f",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[148021, 3792, 251, 6, 54, "Subsection",ExpressionUUID->"18bd7eea-e157-43bd-b4db-a69276fee8b7",
 InitializationCell->True,
 InitializationGroup->True],
Cell[148275, 3800, 329, 8, 46, "Input",ExpressionUUID->"0ba624f1-4daa-469b-a452-e9ee90b9c008",
 InitializationCell->True,
 InitializationGroup->True],
Cell[148607, 3810, 855, 18, 46, "Input",ExpressionUUID->"40f8667c-7b1d-46fb-90cc-5b69d3cef9d8",
 InitializationCell->True,
 InitializationGroup->True],
Cell[149465, 3830, 869, 18, 46, "Input",ExpressionUUID->"24bfe539-fbf2-4e77-b911-48f28eeb729d",
 InitializationCell->True,
 InitializationGroup->True],
Cell[150337, 3850, 2492, 60, 173, "Input",ExpressionUUID->"f2d7dd3e-4f11-4347-98bd-ec4e88b5c3ae",
 InitializationCell->True,
 InitializationGroup->True],
Cell[152832, 3912, 2770, 68, 194, "Input",ExpressionUUID->"c7d03e22-8bb4-4e27-b76f-2ad2e2c01e03",
 InitializationCell->True,
 InitializationGroup->True],
Cell[155605, 3982, 1912, 45, 131, "Input",ExpressionUUID->"6b268ef5-5e52-41a9-81ec-f06f66eee47f",
 InitializationCell->True,
 InitializationGroup->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[157554, 4032, 252, 6, 54, "Subsection",ExpressionUUID->"cdf9e1a4-bbc9-4ae0-bc09-4d1355af72fa",
 InitializationCell->True,
 InitializationGroup->True],
Cell[157809, 4040, 332, 8, 46, "Input",ExpressionUUID->"55ed7401-4262-4825-9b43-40b96d5e0914",
 InitializationCell->True,
 InitializationGroup->True],
Cell[158144, 4050, 1484, 37, 68, "Input",ExpressionUUID->"001077e6-850e-481b-908c-9b47064fb687",
 InitializationCell->True,
 InitializationGroup->True],
Cell[159631, 4089, 2164, 50, 68, "Input",ExpressionUUID->"a02c4a82-f922-4d17-ad6b-beb0ad8a9bb8",
 InitializationCell->True,
 InitializationGroup->True],
Cell[161798, 4141, 6097, 153, 614, "Input",ExpressionUUID->"20e96ea9-a574-4e58-9412-fac169492627",
 InitializationCell->True,
 InitializationGroup->True]
}, Closed]],
Cell[CellGroupData[{
Cell[167932, 4299, 251, 6, 38, "Subsection",ExpressionUUID->"827b80d6-d4a2-4625-8ae8-d5f2cf890e0e",
 InitializationCell->True,
 InitializationGroup->True],
Cell[168186, 4307, 1503, 40, 131, "Input",ExpressionUUID->"26da69f1-9626-42f0-9e13-8eb3fc677782",
 InitializationCell->True,
 InitializationGroup->True],
Cell[169692, 4349, 983, 24, 68, "Input",ExpressionUUID->"ab8d125b-b8bc-4254-beaf-b86989a1defb",
 InitializationCell->True,
 InitializationGroup->True],
Cell[170678, 4375, 2895, 82, 215, "Input",ExpressionUUID->"abb8510d-98da-430f-97fd-56d0743095e5",
 InitializationCell->True,
 InitializationGroup->True],
Cell[173576, 4459, 3307, 93, 257, "Input",ExpressionUUID->"38965917-5080-4013-8eb1-7fbe12610b3a",
 InitializationCell->True,
 InitializationGroup->True],
Cell[176886, 4554, 1129, 32, 89, "Input",ExpressionUUID->"da2c1d62-f5ef-432a-a232-b7365a4846b8",
 InitializationCell->True,
 InitializationGroup->True],
Cell[178018, 4588, 3089, 75, 194, "Input",ExpressionUUID->"3ff47b13-4417-4ec1-8447-9af4290da74a",
 InitializationCell->True,
 InitializationGroup->True]
}, Closed]],
Cell[CellGroupData[{
Cell[181144, 4668, 244, 6, 38, "Subsection",ExpressionUUID->"8f69ebda-f290-4106-b4e7-983f56162377",
 InitializationCell->True,
 InitializationGroup->True],
Cell[181391, 4676, 3955, 97, 383, "Input",ExpressionUUID->"bfc46232-f5a4-4cf9-8b04-379c2df039cd",
 InitializationCell->True,
 InitializationGroup->True],
Cell[185349, 4775, 1177, 21, 46, "Input",ExpressionUUID->"d1b1b267-03bd-480e-95c3-6f1e9ab1f869",
 InitializationCell->True,
 InitializationGroup->True],
Cell[186529, 4798, 1475, 28, 46, "Input",ExpressionUUID->"9fccfb43-4e04-4437-aff9-92173b55911c",
 InitializationCell->True,
 InitializationGroup->True],
Cell[188007, 4828, 1740, 35, 68, "Input",ExpressionUUID->"c806e19f-ea8d-4c3d-8645-97568c782b57",
 InitializationCell->True,
 InitializationGroup->True],
Cell[189750, 4865, 1278, 23, 46, "Input",ExpressionUUID->"ca0b8550-03c4-4ca1-878a-971a96713cde",
 InitializationCell->True,
 InitializationGroup->True],
Cell[191031, 4890, 1524, 28, 68, "Input",ExpressionUUID->"de00c433-744e-45b3-9a26-0b5ef92da8de",
 InitializationCell->True,
 InitializationGroup->True],
Cell[192558, 4920, 2882, 63, 152, "Input",ExpressionUUID->"6dee9e34-21fa-48b8-9d2a-0b6beadc7857",
 InitializationCell->True,
 InitializationGroup->True],
Cell[195443, 4985, 3521, 78, 236, "Input",ExpressionUUID->"67a9a4ff-27fc-4c51-8a74-39a692904b86",
 InitializationCell->True,
 InitializationGroup->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[199001, 5068, 241, 6, 54, "Subsection",ExpressionUUID->"bfd577de-bfb1-41d2-90ab-95efb2992172",
 InitializationCell->True,
 InitializationGroup->True],
Cell[199245, 5076, 2108, 54, 236, "Input",ExpressionUUID->"02a2439b-8ab9-4334-8f24-150cc65360c7",
 InitializationCell->True,
 InitializationGroup->True],
Cell[201356, 5132, 1028, 24, 68, "Input",ExpressionUUID->"0188595a-1a6b-4b12-9cb8-3e53a42fb876",
 InitializationCell->True,
 InitializationGroup->True],
Cell[202387, 5158, 2522, 64, 215, "Input",ExpressionUUID->"976dc6ae-57c1-42de-b32d-c7dec2900eaa",
 InitializationCell->True,
 InitializationGroup->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[204946, 5227, 245, 6, 54, "Subsection",ExpressionUUID->"df78e49c-d4c8-422a-848a-85c6fb6759a1",
 InitializationCell->True,
 InitializationGroup->True],
Cell[205194, 5235, 2053, 55, 215, "Input",ExpressionUUID->"fcb3d799-7294-43a0-9c54-77de7463d1db",
 InitializationCell->True,
 InitializationGroup->True],
Cell[207250, 5292, 989, 24, 68, "Input",ExpressionUUID->"4454b879-bd0a-4c2d-ab28-d1bf17bf8831",
 InitializationCell->True,
 InitializationGroup->True],
Cell[208242, 5318, 2739, 65, 215, "Input",ExpressionUUID->"41a7bdac-d90e-4efe-9e4e-5bba2d9e9b3c",
 InitializationCell->True,
 InitializationGroup->True],
Cell[210984, 5385, 1725, 29, 362, "Input",ExpressionUUID->"0c36398e-c180-4691-a7eb-956ca37a44ad",
 InitializationCell->True,
 InitializationGroup->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[212746, 5419, 246, 6, 54, "Subsection",ExpressionUUID->"008edd48-df0f-423a-9995-9cd723f5ec60",
 InitializationCell->True,
 InitializationGroup->True],
Cell[212995, 5427, 1631, 39, 131, "Input",ExpressionUUID->"74d9dfcf-1843-49e2-b2cd-1e99a9e31561",
 InitializationCell->True,
 InitializationGroup->True],
Cell[214629, 5468, 803, 15, 46, "Input",ExpressionUUID->"dfc514fb-3710-4e86-9f88-aa1e930eb953",
 InitializationCell->True,
 InitializationGroup->True],
Cell[215435, 5485, 825, 17, 46, "Input",ExpressionUUID->"6aa071b2-9495-4aaa-8e6f-d4c59c1b9ce8",
 InitializationCell->True,
 InitializationGroup->True],
Cell[216263, 5504, 589, 17, 46, "Input",ExpressionUUID->"14d7fded-47e6-4903-a451-3125500bea29",
 InitializationCell->True,
 InitializationGroup->True],
Cell[216855, 5523, 1551, 40, 131, "Input",ExpressionUUID->"0b1fed03-25a2-4521-abef-cc13aa950e84",
 InitializationCell->True,
 InitializationGroup->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[218443, 5568, 183, 3, 54, "Subsection",ExpressionUUID->"20e81483-882e-46a9-a76f-8105837ef45b",
 InitializationCell->True],
Cell[218629, 5573, 524, 13, 46, "Input",ExpressionUUID->"62d1e35c-e6ed-4b02-b145-b61188f4dbbd",
 InitializationCell->True],
Cell[219156, 5588, 3186, 83, 215, "Input",ExpressionUUID->"19c433ef-d7d0-42ec-949a-c924432c645e",
 InitializationCell->True],
Cell[222345, 5673, 1392, 45, 89, "Input",ExpressionUUID->"1cb426fd-41e7-4107-b825-c946cb99ba2f",
 InitializationCell->True],
Cell[223740, 5720, 704, 17, 68, "Input",ExpressionUUID->"a61035c1-f2d9-46ba-8ecd-ab9c12221995",
 InitializationCell->True],
Cell[224447, 5739, 1211, 34, 131, "Input",ExpressionUUID->"60d17f37-2eaf-4107-b91c-36fb51e6ddca",
 InitializationCell->True],
Cell[225661, 5775, 1063, 24, 89, "Input",ExpressionUUID->"bafad77a-ab1c-454f-9fd5-0c619096bd0a",
 InitializationCell->True],
Cell[226727, 5801, 1417, 38, 110, "Input",ExpressionUUID->"5c4e4005-1c58-44b2-a235-5ecb5721ca29",
 InitializationCell->True],
Cell[228147, 5841, 436, 12, 46, "Input",ExpressionUUID->"49079f91-aab9-42a1-a58a-f9ed2a716e38",
 InitializationCell->True],
Cell[228586, 5855, 2183, 47, 110, "Input",ExpressionUUID->"7df808c4-8631-47ec-9d7a-52e6358b6bb3",
 InitializationCell->True],
Cell[230772, 5904, 4328, 103, 362, "Input",ExpressionUUID->"c1da2634-099c-4126-a692-845fc59f7ef0",
 InitializationCell->True],
Cell[235103, 6009, 2294, 50, 173, "Input",ExpressionUUID->"86fc1289-a533-425e-9504-db5d07518ec9",
 InitializationCell->True,
 InitializationGroup->True],
Cell[237400, 6061, 2551, 68, 215, "Input",ExpressionUUID->"62c60a93-e0c1-4543-b3a5-329df36e300d",
 InitializationCell->True]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[240000, 6135, 255, 6, 67, "Section",ExpressionUUID->"2237073c-66b9-419c-9689-223008628855",
 InitializationCell->True,
 InitializationGroup->True],
Cell[240258, 6143, 363, 10, 68, "Input",ExpressionUUID->"fda9fba0-dfe6-4be3-b2f3-9ee4625d5821",
 InitializationCell->True,
 InitializationGroup->True]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[240670, 6159, 178, 4, 98, "Title",ExpressionUUID->"92d0aeac-0480-4163-a787-db2cd7f3f9fb",
 InitializationCell->True],
Cell[240851, 6165, 518, 15, 30, "Input",ExpressionUUID->"19272e40-8026-434d-b4a7-fbbc78693f1b"],
Cell[241372, 6182, 756, 19, 52, "Input",ExpressionUUID->"103bb1c9-2f6d-42d2-baa8-18c384c0a016"],
Cell[242131, 6203, 1579, 50, 73, "Input",ExpressionUUID->"cc014e24-ec50-41f6-bd06-b80df0e616a2"],
Cell[243713, 6255, 703, 19, 52, "Input",ExpressionUUID->"30f3c34a-f44a-4459-a07b-3dadd44f526f"],
Cell[244419, 6276, 354, 6, 30, "Input",ExpressionUUID->"de924c27-f6bd-4d9e-8a3b-12aa425e617c"],
Cell[244776, 6284, 658, 12, 30, "Input",ExpressionUUID->"6188975c-261c-48c7-b7d9-721c41c3114a"],
Cell[245437, 6298, 476, 13, 30, "Input",ExpressionUUID->"85d07ca6-08a2-47f8-89e0-1306bea6ad75"],
Cell[245916, 6313, 361, 9, 30, "Input",ExpressionUUID->"7e32049d-c4af-4443-ac0a-4bdd4dfeaef4"],
Cell[246280, 6324, 327, 8, 30, "Input",ExpressionUUID->"0855c75e-9137-434b-bf8c-4fdaee1c6d67"],
Cell[246610, 6334, 244, 5, 30, "Input",ExpressionUUID->"cea77143-b00b-4e0b-a23f-96004ac92b07"],
Cell[246857, 6341, 405, 10, 30, "Input",ExpressionUUID->"9e1cb3e6-8cc6-425a-aebc-17726e92b695"],
Cell[247265, 6353, 265, 5, 30, "Input",ExpressionUUID->"24cc4583-7526-4d4e-a5b1-ac971999be3e"],
Cell[247533, 6360, 537, 15, 30, "Input",ExpressionUUID->"282f4bcd-513f-4865-9432-244f8149b5e5"],
Cell[248073, 6377, 721, 21, 30, "Input",ExpressionUUID->"c7ac71f9-56aa-4d11-80b9-285cd89a8afc"],
Cell[248797, 6400, 849, 26, 52, "Input",ExpressionUUID->"fb2fbf19-ac6b-4b75-ba66-d9542bdf1f11"],
Cell[CellGroupData[{
Cell[249671, 6430, 795, 17, 52, "Input",ExpressionUUID->"d9af4dea-aa97-4b77-8a27-c2293a243640"],
Cell[250469, 6449, 15440, 260, 199, "Output",ExpressionUUID->"4514b757-fec1-4edb-bd35-318dbe020e5f"]
}, Open  ]]
}, Open  ]]
}
]
*)

